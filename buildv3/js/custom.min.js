var ragh=ragh?ragh:{};ragh.eventMapper=(function(){return{eventsAndListeners:{},addEventListener:function(b,c,d){if(!b){throw"raaagh.EventMapper: .addEventListener(): first parameter must be type from EmberMapper.createEvent()"}if(!c){throw"raaagh.EventMapper: .addEventListener(): second parameter must be listener"}if(!d){console.log("raaagh.EventMapper:",b,c._debugContainerKey,d);throw"raaagh.EventMapper: .addEventListener(): third parameter must be callback "+b+", "+c}if(!this.eventsAndListeners.hasOwnProperty(b)){this.eventsAndListeners[b]=[]}var a=this.eventsAndListeners[b].filter(function(e){return(e.listener==c)});if(a.length==0){this.eventsAndListeners[b].push({listener:c,callback:d})}return b},removeEventListener:function(a,b){assert(this.eventsAndListeners[a],"raaagh.EventMapper: this.eventsAndListeners["+a+"] is undefined");if(this.eventsAndListeners[a]){this.eventsAndListeners[a]=this.eventsAndListeners[a].filter(function(c){return(c.listener!=b)})}},triggerEvent:function(a){if(!this.eventsAndListeners.hasOwnProperty(a.type)){this.eventsAndListeners[a.type]=[]}this.eventsAndListeners[a.type].filter(function(b){b.callback.call(b.listener,a.type,a.data);return true})}}}());ragh.MappedEvent=ragh.MEvt={type:null,data:null,create:function(a,b){if(!a){throw"ragh.MappedEvent.create() expects first parameter to be a String describing event type"}if(typeof a!="string"){throw"ragh.MappedEvent.create() expects first parameter to be String describing event type. Currently "+(typeof a)}this.type=a;this.data=b;return this}};if(!this.assert){"use strict";this.assert=function(c,b,a){if(!c){console.info(b)}else{if(a){console.info(a)}}}}if(!Array.prototype.filter){Array.prototype.filter=function(b){var a=this.length>>>0;if(typeof b!="function"){throw new TypeError()}var e=[];var d=arguments[1];for(var c=0;c<a;c++){if(c in this){var f=this[c];if(b.call(d,f,c,this)){e.push(f)}}}return e}};if(typeof Object.createFromPrototype!=="function"){Object.createFromPrototype=function(d,b){function c(){}c.prototype=new d();var a=new c();if(a.init){a.init(b)}return a}}var CubeGroup=function(){this.isMerge=false;this.rollOver=null;this.SIZE=30;this.materialsDict={};this.group=null};CubeGroup.prototype={init:function(a){this.group=this.createFromMap(a.imgMap);this.group.position.x=a.x||0;this.label=a.label},tryAddHere:function(a){},show:function(b){var a=this.getFacePoint(b,this.SIZE);this.rollOverMesh.position.copy(a)},getFacePoint:function(b,c){var a=new THREE.Vector3(),d=new THREE.Vector3();a.copy(b.object.position);d.copy(b.face.centroid).normalize();d.multiplyScalar(c);a.add(d);return a},createFromMap:function(i){if(!i){throw'CubeGroup.createFromMap() passed "amap" parameter is falsey'}var h=this.SIZE,b=0,a=0,n=0,j=new THREE.Object3D(),c=(i?i:this.defaultMap),l,f,m,d;if(this.isMerge){l=[];f=new THREE.Geometry()}for(var e=0;e<c.length;e++){if(!c[e]){c[e]=[]}for(var k=0;k<c[e].length;k++){if(!c[e][k]){c[e][k]=[]}for(var g=0;g<c[e][k].length;g++){if(c[e][k][g]){b=Math.max(b,e);a=Math.max(a,k);n=Math.max(n,g);this.createCube(this.SIZE,e*h,-k*h,g*h,c[e][k][g],this.materialsDict,j,f,l,this.isMerge)}}}}if(this.isMerge){m=new THREE.Mesh(this.geo,new THREE.MeshFaceMaterial(this.materials));m.matrixAutoUpdate=false;m.updateMatrix();m.overdraw=false;m.name="cubeGroup";j.add(m)}j.position.set(h*(0.5),h*(-0.5),0);j.updateMatrix();j.add(this.rollOverMesh=this.createRollOver());this.group=j;return j},createRollOver:function(){if(!this.isMerge){var c=new THREE.CubeGeometry(this.SIZE,this.SIZE,this.SIZE,1,1,1),a=new THREE.Mesh(c,new THREE.MeshLambertMaterial({color:255,opacity:0.25,transparent:true})),b=new THREE.PointLight(3355545);a.matrixAutoUpdate=true;a.add(b);b.intensity=2;return a}var b=new THREE.PointLight(3355545);b.intensity=2;return b},createCube:function(h,p,o,l,g,r,j,c,n,a){var k=h,d=r[g.color],q,f=new THREE.CubeGeometry(k,k,k,1,1,1);if(!this.materialsDict[g.color]){this.materialsDict[g.color]=d=new THREE.MeshLambertMaterial({color:g.color})}if(!a){THREE.GeometryUtils.merge(f,new THREE.Geometry());q=new THREE.Mesh(f,d);q.position=new THREE.Vector3(p,o,l);j.add(q)}else{for(var e=0;e<f.vertices.length;e++){f.vertices[e].add(new THREE.Vector3(p,o,l))}THREE.GeometryUtils.merge(c,f,n.length);for(var m=0;m<6;m++){n.push(d)}}return q},getMap:function(){var d=[[[]]],b,e=this.group,a,h,f;for(var g=0;g<e.children.length;g++,b=e.children[g-1]){if(b&&b!=this.rollOverMesh){a=Math.round(b.position.x/this.SIZE);h=Math.round(b.position.y/this.SIZE);f=Math.round(b.position.z/this.SIZE);if(!d[a]){d[a]=[]}if(!d[a][h]){d[a][h]=[]}d[a][h][f]={name:g}}}},cleanUp:function(){this.materials=null;this.geo=null;this.mesh=null;this.rollOverMesh=null;this.group=null;this.materials=null;this.geo=null;this.mesh=null;this.rollOverMesh=null;this.group=null;this.materialsDict=null}};THREE.TrackballControls=function(z,y){var p=this;var q={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5};this.object=z;this.domElement=(y!==undefined)?y:document;this.enabled=true;this.screen={width:0,height:0,offsetLeft:0,offsetTop:0};this.radius=(this.screen.width+this.screen.height)/4;this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=0.3;this.noRotate=false;this.noZoom=false;this.noPan=false;this.staticMoving=false;this.dynamicDampingFactor=0.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3();var i=new THREE.Vector3();var r=q.NONE,k=q.NONE,a=new THREE.Vector3(),n=new THREE.Vector3(),h=new THREE.Vector3(),j=new THREE.Vector2(),u=new THREE.Vector2(),g=0,b=0,c=new THREE.Vector2(),t=new THREE.Vector2();this.target0=this.target.clone();this.position0=this.object.position.clone();this.up0=this.object.up.clone();var x={type:"change"};this.handleResize=function(){this.screen.width=window.innerWidth;this.screen.height=window.innerHeight;this.screen.offsetLeft=0;this.screen.offsetTop=0;this.radius=(this.screen.width+this.screen.height)/4};this.handleEvent=function(A){if(typeof this[A.type]=="function"){this[A.type](A)}};this.getMouseOnScreen=function(B,A){return new THREE.Vector2((B-p.screen.offsetLeft)/p.radius*0.5,(A-p.screen.offsetTop)/p.radius*0.5)};this.getMouseProjectionOnBall=function(E,C){var B=new THREE.Vector3((E-p.screen.width*0.5-p.screen.offsetLeft)/p.radius,(p.screen.height*0.5+p.screen.offsetTop-C)/p.radius,0);var D=B.length();if(D>1){B.normalize()}else{B.z=Math.sqrt(1-D*D)}a.copy(p.object.position).sub(p.target);var A=p.object.up.clone().setLength(B.y);A.add(p.object.up.clone().cross(a).setLength(B.x));A.add(a.setLength(B.z));return A};this.rotateCamera=function(){var C=Math.acos(n.dot(h)/n.length()/h.length());if(C){var A=(new THREE.Vector3()).crossVectors(n,h).normalize(),B=new THREE.Quaternion();C*=p.rotateSpeed;B.setFromAxisAngle(A,-C);a.applyQuaternion(B);p.object.up.applyQuaternion(B);h.applyQuaternion(B);if(p.staticMoving){n.copy(h)}else{B.setFromAxisAngle(A,C*(p.dynamicDampingFactor-1));n.applyQuaternion(B)}}};this.zoomCamera=function(){if(r===q.TOUCH_ZOOM){var A=g/b;g=b;a.multiplyScalar(A)}else{var A=1+(u.y-j.y)*p.zoomSpeed;if(A!==1&&A>0){a.multiplyScalar(A);if(p.staticMoving){j.copy(u)}else{j.y+=(u.y-j.y)*this.dynamicDampingFactor}}}};this.panCamera=function(){var A=t.clone().sub(c);if(A.lengthSq()){A.multiplyScalar(a.length()*p.panSpeed);var B=a.clone().cross(p.object.up).setLength(A.x);B.add(p.object.up.clone().setLength(A.y));p.object.position.add(B);p.target.add(B);if(p.staticMoving){c=t}else{c.add(A.subVectors(t,c).multiplyScalar(p.dynamicDampingFactor))}}};this.checkDistances=function(){if(!p.noZoom||!p.noPan){if(p.object.position.lengthSq()>p.maxDistance*p.maxDistance){p.object.position.setLength(p.maxDistance)}if(a.lengthSq()<p.minDistance*p.minDistance){p.object.position.addVectors(p.target,a.setLength(p.minDistance))}}};this.update=function(){a.subVectors(p.object.position,p.target);if(!p.noRotate){p.rotateCamera()}if(!p.noZoom){p.zoomCamera()}if(!p.noPan){p.panCamera()}p.object.position.addVectors(p.target,a);p.checkDistances();p.object.lookAt(p.target);if(i.distanceToSquared(p.object.position)>0){p.dispatchEvent(x);i.copy(p.object.position)}};this.reset=function(){r=q.NONE;k=q.NONE;p.target.copy(p.target0);p.object.position.copy(p.position0);p.object.up.copy(p.up0);a.subVectors(p.object.position,p.target);p.object.lookAt(p.target);p.dispatchEvent(x);i.copy(p.object.position)};function f(A){if(p.enabled===false){return}window.removeEventListener("keydown",f);k=r;if(r!==q.NONE){return}else{if(A.keyCode===p.keys[q.ROTATE]&&!p.noRotate){r=q.ROTATE}else{if(A.keyCode===p.keys[q.ZOOM]&&!p.noZoom){r=q.ZOOM}else{if(A.keyCode===p.keys[q.PAN]&&!p.noPan){r=q.PAN}}}}}function d(A){if(p.enabled===false){return}r=k;window.addEventListener("keydown",f,false)}function m(A){if(p.enabled===false){return}A.preventDefault();A.stopPropagation();if(r===q.NONE){r=A.button}if(r===q.ROTATE&&!p.noRotate){n=h=p.getMouseProjectionOnBall(A.clientX,A.clientY)}else{if(r===q.ZOOM&&!p.noZoom){j=u=p.getMouseOnScreen(A.clientX,A.clientY)}else{if(r===q.PAN&&!p.noPan){c=t=p.getMouseOnScreen(A.clientX,A.clientY)}}}document.addEventListener("mousemove",v,false);document.addEventListener("mouseup",o,false)}function v(A){if(p.enabled===false){return}A.preventDefault();A.stopPropagation();if(r===q.ROTATE&&!p.noRotate){h=p.getMouseProjectionOnBall(A.clientX,A.clientY)}else{if(r===q.ZOOM&&!p.noZoom){u=p.getMouseOnScreen(A.clientX,A.clientY)}else{if(r===q.PAN&&!p.noPan){t=p.getMouseOnScreen(A.clientX,A.clientY)}}}}function o(A){if(p.enabled===false){return}A.preventDefault();A.stopPropagation();r=q.NONE;document.removeEventListener("mousemove",v);document.removeEventListener("mouseup",o)}function l(A){if(p.enabled===false){return}A.preventDefault();A.stopPropagation();var B=0;if(A.wheelDelta){B=A.wheelDelta/40}else{if(A.detail){B=-A.detail/3}}j.y+=B*0.01}function s(C){if(p.enabled===false){return}switch(C.touches.length){case 1:r=q.TOUCH_ROTATE;n=h=p.getMouseProjectionOnBall(C.touches[0].pageX,C.touches[0].pageY);break;case 2:r=q.TOUCH_ZOOM;var B=C.touches[0].pageX-C.touches[1].pageX;var A=C.touches[0].pageY-C.touches[1].pageY;b=g=Math.sqrt(B*B+A*A);break;case 3:r=q.TOUCH_PAN;c=t=p.getMouseOnScreen(C.touches[0].pageX,C.touches[0].pageY);break;default:r=q.NONE}}function e(C){if(p.enabled===false){return}C.preventDefault();C.stopPropagation();switch(C.touches.length){case 1:h=p.getMouseProjectionOnBall(C.touches[0].pageX,C.touches[0].pageY);break;case 2:var B=C.touches[0].pageX-C.touches[1].pageX;var A=C.touches[0].pageY-C.touches[1].pageY;b=Math.sqrt(B*B+A*A);break;case 3:t=p.getMouseOnScreen(C.touches[0].pageX,C.touches[0].pageY);break;default:r=q.NONE}}function w(A){if(p.enabled===false){return}switch(A.touches.length){case 1:n=h=p.getMouseProjectionOnBall(A.touches[0].pageX,A.touches[0].pageY);break;case 2:g=b=0;break;case 3:c=t=p.getMouseOnScreen(A.touches[0].pageX,A.touches[0].pageY);break}r=q.NONE}this.domElement.addEventListener("contextmenu",function(A){A.preventDefault()},false);this.domElement.addEventListener("mousedown",m,false);this.domElement.addEventListener("mousewheel",l,false);this.domElement.addEventListener("DOMMouseScroll",l,false);this.domElement.addEventListener("touchstart",s,false);this.domElement.addEventListener("touchend",w,false);this.domElement.addEventListener("touchmove",e,false);window.addEventListener("keydown",f,false);window.addEventListener("keyup",d,false);this.handleResize()};THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);var ragh=ragh?ragh:{};ragh.chooseOne=ragh.one=function(a){return a[Math.round(a.length*Math.random()-0.5)]};if(typeof Object.createFromPrototype!=="function"){Object.createFromPrototype=function(d,b){function c(){}c.prototype=new d();var a=new c();if(a.init){a.init(b)}return a}}if(!ragh.THREE){ragh.THREE={}}ragh.THREE.Dragger=function(){this.targetRotation=0;this.targetRotationOnMouseDown=0;this.mouseX=0;this.mouseXOnMouseDown=0;this.windowHalfX=window.innerWidth/2;this.windowHalfY=window.innerHeight/2};ragh.THREE.Dragger.prototype={init:function(a){this.camera=a.camera;this.dragged=a.dragged;this.el=a.el;console.log("Dragged, init",a);this.onWindowResize=function(b){return function(){b.windowHalfX=window.innerWidth/2;b.windowHalfY=window.innerHeight/2;b.camera.updateProjectionMatrix()}}(this);this.onDocumentMouseDown=function(b){return function(c){c.preventDefault();b.el.addEventListener("mousemove",b.onDocumentMouseMove,false);b.el.addEventListener("mouseup",b.onDocumentMouseUp,false);b.el.addEventListener("mouseout",b.onDocumentMouseOut,false);b.mouseXOnMouseDown=c.clientX-b.windowHalfX;b.targetRotationOnMouseDown=b.targetRotation}}(this);this.onDocumentMouseMove=function(b){return function(c){b.mouseX=c.clientX-b.windowHalfX;b.targetRotation=b.targetRotationOnMouseDown+(b.mouseX-b.mouseXOnMouseDown)*0.02}}(this);this.onDocumentMouseUp=function(b){return function(c){b.el.removeEventListener("mousemove",b.onDocumentMouseMove,false);b.el.removeEventListener("mouseup",b.onDocumentMouseUp,false);b.el.removeEventListener("mouseout",b.onDocumentMouseOut,false)}}(this);this.onDocumentMouseOut=function(b){return function(c){b.el.removeEventListener("mousemove",b.onDocumentMouseMove,false);b.el.removeEventListener("mouseup",b.onDocumentMouseUp,false);b.el.removeEventListener("mouseout",b.onDocumentMouseOut,false)}}(this);this.onDocumentTouchStart=function(b){return function(c){if(c.touches.length===1){c.preventDefault();b.mouseXOnMouseDown=c.touches[0].pageX-b.windowHalfX;b.targetRotationOnMouseDown=b.targetRotation}}}(this);this.onDocumentTouchMove=function(b){return function(c){if(c.touches.length===1){c.preventDefault();b.mouseX=c.touches[0].pageX-b.windowHalfX;b.targetRotation=b.targetRotationOnMouseDown+(b.mouseX-b.mouseXOnMouseDown)*0.05}}}(this);this.el.addEventListener("mousedown",this.onDocumentMouseDown,false);this.el.addEventListener("touchstart",this.onDocumentTouchStart,false);this.el.addEventListener("touchmove",this.onDocumentTouchMove,false);window.addEventListener("resize",this.onWindowResize,false)},animate:function(){this.dragged.rotation.y+=(this.targetRotation-this.dragged.rotation.y)*0.05},destroy:function(){this.el.removeEventListener("mousemove",this.onDocumentMouseMove,false);this.el.removeEventListener("mouseup",this.onDocumentMouseUp,false);this.el.removeEventListener("mouseout",this.onDocumentMouseOut,false);this.el.removeEventListener("mousedown",this.onDocumentMouseDown,false);this.el.removeEventListener("touchstart",this.onDocumentTouchStart,false);this.el.removeEventListener("touchmove",this.onDocumentTouchMove,false);window.removeEventListener("resize",this.onWindowResize,false)}};Ember.Handlebars.registerHelper("controlWithVars",function(p,j,q){if(arguments.length===2){q=j;j=undefined}var g;if(j){g=Ember.Handlebars.get(this,j,q)}var h=q.data.keywords.controller,o=q.data.keywords.view,b=Em.get(h,"_childContainers"),e=q.hash.controlID,a,n;if(b.hasOwnProperty(e)){n=b[e]}else{a=h.get("container"),n=a.child();b[e]=n}var c=p.replace(/\//g,".");var i=n.lookup("view:"+c)||n.lookup("view:default"),f=n.lookup("controller:"+c),m=n.lookup("template:"+p);if(!window.controller){window.controller=0}for(var d in q.hash){f[d]=q.hash[d]}Ember.assert("Could not find controller for path: "+c,f);Ember.assert("Could not find view for path: "+c,i);Em.set(f,"target",h);Em.set(f,"model",g);q.hash.template=m;q.hash.controller=f;function l(){var k=Ember.Handlebars.get(this,j,q);set(f,"model",k);i.rerender()}Ember.addObserver(this,j,l);i.one("willDestroyElement",this,function(){Ember.removeObserver(this,j,l)});Ember.Handlebars.helpers.view.call(this,i,q)});Ember.Handlebars.registerHelper("controlWithVarsold",function(p,l,q){var h,b,o,i,f,a,n,c;var d=p.replace(/\//g,".");console.log("controlWithVars",p);console.log(">path",p);console.log(">contextString",l);console.log(">options",q);console.log(">container",q.data.keywords.controller.container);console.log("keywords>",q.data.keywords);if(arguments.length===2){q=l;l=undefined}a=q.data.keywords.controller.container;if(typeof l==="string"){f=q.contexts[1];b=Ember.Handlebars.get(f,l,q);console.log(">(contextString is string) context",b)}else{if(l){b=Ember.Handlebars.get(this,l,q)}}if(i=q.hash.controller){}else{i=Ember.controllerFor(a,d,b)}o=q.data.keywords.view;c=Em.get(i,"_childContainers"),controlID=q.hash.controlID;if(c.hasOwnProperty(controlID)){n=c[controlID]}else{a=Em.get(i,"container"),n=a.child();c[controlID]=n}var j=n.lookup("view:"+d)||n.lookup("view:default"),g=n.lookup("controller:"+d),m=n.lookup("template:"+p);for(var e in q.hash){g.set(e,q.hash[e])}console.log("view?",o);console.log("childView?",j);console.log("childController?",g);Ember.assert("Could not find controller for path: "+d,g);Ember.assert("Could not find view for path: "+d,j);Em.set(g,"target",i);Em.set(g,"context",b);q.hash.template=m;q.hash.controller=i;console.log("adding via view:",j);Ember.Handlebars.helpers.view.call(this,j,q)});Ember.Handlebars.registerHelper("renderWithVars",function(a,e,i){Ember.assert("You must pass a template to render",arguments.length>=2);var b,h,d,g,c;if(arguments.length===2){i=e;e=undefined}if(typeof e==="string"){c=Ember.Handlebars.get(i.contexts[1],e,i)}a=a.replace(/\//g,".");b=i.data.keywords.controller.container;h=b.lookup("router:main");Ember.assert("This view is already rendered",!h||!h._lookupActiveView(a));g=b.lookup("view:"+a)||b.lookup("view:default");$.extend(i.hash.controller,i.hash);if(d=i.hash.controller){d=b.lookup("controller:"+d);console.log("controller")}else{d=Ember.controllerFor(b,a,c)}$.extend(d,i.hash);if(d&&c){d.set("model",c)}var f=i.contexts[1];if(f){g.registerObserver(f,e,function(){d.set("model",Ember.Handlebars.get(f,e,i))})}i.hash.viewName=Ember.String.camelize(a);i.hash.template=b.lookup("template:"+a);i.hash.controller=d;if(h){h._connectActiveView(a,g)}Ember.Handlebars.helpers.view.call(this,g,i)});createjs.CSSPlugin.install();App=Ember.Application.create({DEBUG:false,PRELOADER:{},scriptModel:null,rootElement:$(".app")[0],ready:function(){App.scriptModel=App.ScriptModel.create({});App.Router.map(function(){this.route("index",{path:"/"});this.route("dimension1",{path:"/d1"});this.route("dimension2",{path:"/d2"});this.route("dimension3",{path:"/d3"})})},readyAndLoaded:function(){console.log("readyAndLoaded")},eventMapper:ragh.eventMapper,colors:["#FF0000","#993366","#3399CC","#0099FF","#00CC33","#00FF00"]});App.BREAKPOINT={WIDTH_2:1280,HEIGHT_2:576,WIDTH_1:768,HEIGHT_1:576,WIDTH_0:448,HEIGHT_0:320};App.dictionary=Em.Object.create({copy:{},isReady:false,init:function(){App.eventMapper.addEventListener("preloaderIsLoaded",this,function(a){return function(c,d){var b=d.target.getResult("copy").split("=\n");b=b.splice(1,b.length-1);var e=b.forEach(function(i,h,g){var f=i.split("\n");var j=f.splice(0,1);a.copy[j[0]]=f.join("\n")});a.isReady=true;App.eventMapper.triggerEvent(ragh.MEvt.create("isDictionaryReady"))}}(this))}});Em.Object.reopenClass({create:function(a){return this._super().setProperties(a)}});App.KnobController=Em.ObjectController.extend({callDynamicController:function(){console.log(".callDynamicController()")}});App.KnobView=Em.View.extend({templateName:"knob"});if(App.DEBUG){var stats=new Stats();stats.setMode(1);stats.domElement.style.position="absolute";stats.domElement.style.left="0px";stats.domElement.style.top="0px";document.body.appendChild(stats.domElement);setInterval(function(){stats.begin();stats.end()},1000/60)};App.ApplicationController=Em.Controller.extend({className:"App.ApplicationController",currentRoute:null,notifyChange:function(){previousPath:undefined,Ember.run.schedule("afterRender",this,function(){App.eventMapper.triggerEvent(ragh.MEvt.create("doRoute",{routePath:this.get("currentPath")}))});if(App.transitionView){switch(this.get("previousPath")+">"+this.get("currentPath")){case"dimension2>dimension3":App.transitionView.show();break;default:App.transitionView.hide();break}}this.set("previousPath",this.get("currentPath"))}.observes("currentPath")});App.Dimension1Controller=Em.ObjectController.extend({className:"Dimension1Controller",wpm:0});App.Dimension2Controller=Em.ObjectController.extend({className:"Dimension2Controller"});App.Dimension3Controller=Em.ObjectController.extend({className:"Dimension3Controller",isSubtitle:true,doRemoveSubtitle:function(){this.set("isSubtitle",false)}});App.IndexController=Em.Controller.extend({className:"IndexController",test:"testVariable"});App.NavListController=Em.Controller.extend({className:"NavListController",doIndex:function(){window.location.hash=""},doDimension0:function(){window.location.hash=""},doDimension1:function(){window.location.hash="d1"},doDimension2:function(){window.location.hash="d2"},doDimension3:function(){window.location.hash="d3"}});App.register("controller:nav-list",App.NavListController,{singleton:false});App.NavTabsController=Em.Controller.extend({className:"NavTabsController",doIndex:function(){window.location.hash=""},doDimension1:function(){window.location.hash="d1"},doDimension2:function(){window.location.hash="d2"},doDimension3:function(){window.location.hash="d3"}});App.register("controller:nav-tabs",App.NavTabsController,{singleton:false});App.SmartController=Em.ObjectController.extend({label:"App.SmartController",className:"SmartController",autoMappedEvents:[],isViewInserted:false,view_didSetController:function(){},view_didInsertElement:function(a){if(!a){throw"SmartController.view_didInsertElement() did not recieve aview parameter"}var b,c;this.set("view",a);this.set("isViewInserted",true);for(c=0;c<this.autoMappedEvents.length;c++){b=this.autoMappedEvents[c];App.eventMapper.addEventListener(b.type,b.listener,b.callback)}this.send("SmartController_didInsertElement",this,this.label)},view_willDestroyElement:function(){for(var a=0;a<this.autoMappedEvents.length;a++){App.eventMapper.removeEventListener(this.autoMappedEvents[a].type,this.autoMappedEvents[a].listener)}},addAutoMappedEvent:function(a,b,c){Ember.assert('addAutoMappedEvents: "type" not string',(typeof a=="string"));Ember.assert('addAutoMappedEvents: "listener" not string',(typeof b=="object"));Ember.assert('addAutoMappedEvents: "callback" not string',(typeof c=="function"));this.autoMappedEvents.push({type:a,listener:b,callback:c})}});App.register("controller:smart-controller",App.SmartController,{singleton:false});App.Dimension1Model=Em.Object.extend({title:"The first dimension"});App.Dimension2Model=Em.Object.extend({title:"The second dimension"});App.Dimension3Model=Em.Object.extend({title:"The third dimension"});App.HashBtnModel=Em.Object.extend({urlhash:"Model set",label:"Model"});App.ScriptModel=Em.Object.extend({init:function(){var a=function(b){return function(c,d){b.scriptIndex=App.dictionary.copy.INDEX;b.scriptD1=App.dictionary.copy.D1;b.scriptD2=App.dictionary.copy.D2;b.scriptD3=App.dictionary.copy.D3}}(this);if(App.dictionary.isLoaded){a()}else{App.eventMapper.addEventListener("isDictionaryReady",this,a)}return this._super()},scriptIndex:"",scriptD1:"",wpm:false&&999||280,editDelay:false&&120||600,newLineDelay:false&&80||800,progress:0,subtitleText:function(){console.log("computer prop subtitleText");var a=this.get("script").split(" ");return a[Math.round(a.length*this.get("progress"))]}.property("script"),cpms:function(){var a=this.get("wpm")*7;var c=a/60;var b=c/1000;return b}.property("wpm")});App.AppRoute=Em.Route.extend({});App.Dimension1Route=Em.Route.extend({subtitleController1:null,subtitleController2:null,dimension1NavController:null,init:function(){this._super();this.isStarted=false},deactivate:function(){this._super();App.eventMapper.removeEventListener("dim1Nav_start",this);App.eventMapper.removeEventListener("dim1Nav_end",this);App.eventMapper.removeEventListener("sub_finishedReading",this);this.subtitleController1=null;this.subtitleController2=null;this.subtitleController3=null;this.isStarted=null;this.heartbeatController=null;this.scalarController=null},doStart:function(a,b){this.subtitleController1.set("content",App.scriptModel);this.subtitleController2.set("content",App.scriptModel);this.subtitleController3.set("content",App.scriptModel);this.subtitleController1.setup();this.subtitleController2.setup();this.subtitleController3.setup();this.subtitleController1.startReading()},model:function(){return(App.dimension1Model)?App.dimension1Model:App.Dimension1Model.create()},setupController:function(a,b){a.set("content",b)},renderTemplate:function(){if((App.PRELOADER)?(App.PRELOADER.isLoaded):false){this.render("dimension1");this.render("nav-list",{outlet:"nav-list"})}else{App.eventMapper.addEventListener("preloaderIsLoaded",this,function(a){return function(){a.renderTemplate()}}(this))}},events:{SubtitleView_InsertViewDone:function(b,a){},SmartController_didInsertElement:function(a,b){switch(b){case"SubtitleController":switch(a.get("orderRead")){case"1":this.subtitleController1=a;break;case"2":this.subtitleController2=a;break;case"3":this.subtitleController3=a;break}break;case"Dimension1NavController":this.dimension1NavController=a;break;case"HeartbeatController":this.heartbeatController=a;break;case"ScalarController":this.scalarController=a;break}this.tryStart()},SubtitleController_didInsertElement:function(a,b){},doGotoDimension2:function(){window.location.hash="d2"},doSubtitle2:function(){this.subtitleController1.set("isCursor",false);this.subtitleController2.startReading()},doSubtitle3:function(){this.subtitleController3.startReading()}},tryStart:function(){if(!this.isStarted&&this.subtitleController1&&this.subtitleController2&&this.subtitleController3){this.isStarted=true;this.doStart()}}});App.Dimension2Route=Em.Route.extend({questionMarkController:null,model:function(){return(App.dimension2Model)?App.dimension2Model:App.Dimension2Model.create()},activate:function(){},deactivate:function(){this._super();this.questionMarkController=null;this.world2dController=null;this.isStart=null},renderTemplate:function(){if(App.PRELOADER.isLoaded){this.render("dimension2");this.render("nav-list",{outlet:"nav-list"})}else{App.eventMapper.addEventListener("preloaderIsLoaded",this,function(a){return function(){a.renderTemplate()}}(this))}},events:{SmartController_didInsertElement:function(a,b){switch(b){case"World2dController":this.world2dController=a;break;case"QuestionMarkController":this.questionMarkController=a;break;case"SubtitleController":switch(a.get("orderRead")){case"1":this.subtitleController1=a;break;case"2":this.subtitleController2=a;break}break;case"Dimension2NavController":this.dimension2NavController=a;default:break}this.tryStart()},SubtitleController_didInsertElement:function(){},doGotoDimension3:function(){window.location.hash="d3"},doShowQuestion:function(){this.questionMarkController.setVisible()},doSubtitle2:function(){this.subtitleController1.set("isCursor",false);this.subtitleController2.startReading()},doMosaicFinished:function(){}},tryStart:function(){if(!this.isStart&&this.questionMarkController&&this.world2dController&&this.subtitleController1&&this.subtitleController2){this.isStart=true;this.doStart()}},doStart:function(a,b){this.subtitleController1.set("content",App.scriptModel);this.subtitleController1.setup();this.subtitleController1.startReading()}});App.Dimension3Route=Em.Route.extend({init:function(){this._super();this.isStarted=false},model:function(){return(App.dimension3Model)?App.dimension3Model:App.Dimension3Model.create()},activate:function(){},deactivate:function(){this.world3dController=null;this.subtitle1Controller=null},renderTemplate:function(){if(App.PRELOADER.isLoaded){this.render("dimension3");this.render("nav-list",{outlet:"nav-list"})}else{App.eventMapper.addEventListener("preloaderIsLoaded",this,function(a){return function(){a.renderTemplate()}}(this))}},events:{SmartController_didInsertElement:function(a,b){switch(b){case"World3dController":this.world3dController=a;break;case"SubtitleController":switch(a.get("orderRead")){case"1":this.subtitle1Controller=a;break;case"2":this.subtitle2Controller=a;break}break;default:break}this.tryStart()},SubtitleController_didInsertElement:function(a,b){},doRotateQuestionMarkHint:function(){console.log("ROTATE TIME HINT");this.world3dController.doRotateQuestionMarkHint()},doRotateQuestionMark:function(){console.log("ROTATE TIME");this.world3dController.doQuestionMarkRotate()},doQuestionMarkRotateDone:function(){this.subtitle1Controller.doRemoveClicked();this.subtitle2Controller.startReading()}},tryStart:function(){if(this.subtitle1Controller&&this.subtitle2Controller){this.doStart()}},doStart:function(a,b){this.subtitle1Controller.startReading()}});App.IndexRoute=Em.Route.extend({indexNavController:null,subtitleController:null,init:function(){this._super();this.isStarted=false;return this},deactivate:function(){App.eventMapper.removeEventListener("indNav_end",this);this.subtitleController1=null;this.subtitleController2=null;this.isStarted=null},doStart:function(a,b){this.subtitleController1.startReading()},doEnd:function(a,b){if(this.indexNavController){this.indexNavController.set("isShowEnd",false);window.location.hash="d1"}},renderTemplate:function(){if(App.PRELOADER?App.PRELOADER.isLoaded:false){this.render("index");this.render("nav-list",{outlet:"nav-list"})}else{App.eventMapper.addEventListener("preloaderIsLoaded",this,function(a){return function(){a.renderTemplate()}}(this))}},events:{SubtitleController_didInsertElement:function(a,b){if(a.get("readOrder")=="1"){this.subtitleController1=a}if(a.get("readOrder")=="2"){this.subtitleController2=a}this.tryStart()},IndexNavController_didInsertElement:function(a,b){this.indexNavController=a;this.tryStart()},SmartController_didInsertElement:function(a,b){},doGotoDimension1:function(){window.location.hash="d1"},doSecondSubtitle:function(){this.subtitleController1.set("isCursor",false);this.subtitleController2.startReading()}},tryStart:function(){if(this.subtitleController1&&this.subtitleController2){this.doStart()}}});App.ApplicationView=Ember.View.extend({templateName:"application",el:null,$el:null,didInsertElement:function(){this._super();this.set("el",this.get("element"));this.set("$el",$(this.el))},willDestroyElement:function(){this._super();$(window).unbind("resize.ApplicationView")}});App.Dimension1View=Ember.View.extend({tagName:"div",name:"dimension1"});App.Dimension2View=Ember.View.extend({tagName:"div",templateName:"dimension2",name:"dimension2"});App.IndexView=Ember.View.extend({tagName:"div",didInsertElement:function(){this._super()}});App.NavListView=Em.View.extend({templateName:"nav-list",selectedBinding:"controller.selected",NavListItemView:Ember.View.extend({tagName:"li",classNameBindings:"isActive:active".w(),isActive:function(){return this.get("item")===this.get("parentView.selected")}.property("item","parentView.selected").cacheable()}),didInsertElement:function(){this._super();Foundation.libs.topbar.init()}});App.NavTabsView=Em.View.extend({templateName:"nav-tabs",selectedBinding:"controller.selected",NavItemView:Ember.View.extend({tagName:"li",classNameBindings:"isActive:active".w(),isActive:function(){return this.get("item")===this.get("parentView.selected")}.property("item","parentView.selected").cacheable()})});App.SmartContainerView=Ember.ContainerView.extend({className:"App.SmartContainerView",mappedEvents:[],smartViewObj:null,el:null,$el:null,init:function(){smartViewObj=this;return this._super()},didInsertElement:function(a){if(!a){a=this}this._super(a);this.set("el",this.get("element"));this.set("$el",$(this.el));a.$().addClass(a.templateName);a.get("controller").send("view_didInsertElement",this)},willDestroyElement:function(){this.get("controller").send("view_willDestroyElement",this)}});App.SmartView=Ember.View.extend({className:"App.SmartView",mappedEvents:[],smartViewObj:null,el:null,$el:null,controllerAdded:function(){this.get("controller").send("view_didSetController",this)}.observes("controller"),init:function(){smartViewObj=this;this._super();return this},didInsertElement:function(a){this._super();if(!a){a=this}this.set("el",this.get("element"));this.set("$el",$(this.get("el")));a.$().addClass(a.templateName);a.get("controller").send("view_didInsertElement",this)},willDestroyElement:function(){this._super();this.get("controller").send("view_willDestroyElement",this);this.destroy()},addEventListener:function(b,c){if(this._listeners===undefined){this._listeners={}}var a=this._listeners;if(a[b]===undefined){a[b]=[]}if(a[b].indexOf(c)===-1){a[b].push(c)}},hasEventListener:function(b,c){if(this._listeners===undefined){return false}var a=this._listeners;if(a[b]!==undefined&&a[b].indexOf(c)!==-1){return true}return false},removeEventListener:function(c,d){if(this._listeners===undefined){return}var b=this._listeners;var a=b[c].indexOf(d);if(a!==-1){b[c].splice(a,1)}},dispatchEvent:function(e){if(this._listeners===undefined){return}var d=this._listeners;var a=d[e.type];if(a!==undefined){e.target=this;for(var c=0,b=a.length;c<b;c++){a[c].call(this,e)}}}});App.AudioController=App.SmartController.extend({content:undefined,init:function(){this._super()}});App.Dimension1NavController=App.SmartController.extend({isShowStart:true,isShowEnd:false,label:"Dimension1NavController",view_didInsertElement:function(a){this._super(a);App.eventMapper.addEventListener("sub_isFinish",this,function(b){return function(){b.isShowStart=false;b.isShowEnd=true}}(this))},view_willDestroyElement:function(){App.eventMapper.removeEventListener("sub_isFinish",this)},doStart:function(){App.eventMapper.triggerEvent(ragh.MEvt.create("dim1Nav_start"))}});App.register("controller:dimension1-nav",App.Dimension1NavController,{singleton:false});App.Dimension2NavController=App.SmartController.extend({isShowStart:false,isShowEnd:false,label:"Dimension2NavController",doEnd:function(){App.eventMapper.triggerEvent(ragh.MEvt.create("dim1Nav_end"))}});App.register("controller:dimension2-nav",App.Dimension2NavController,{singleton:false});App.EslEntityContainerController=App.SmartController.extend({view_didInsertElement:function(a){if(!this.get("view")){this._super(a);App.static_eslEntityContainerView=a}else{}},view_eslEntityCreated:function(a){console.log(" view_eslEntityCreated",a);App.eventMapper.triggerEvent(ragh.MEvt.create("eslViewAddedEsl",{label:a.label,view:a.get("view"),parentEslObj:a.get("view").parentEslObj}))}});App.EslEntityController=App.SmartController.extend({label:"esl-entity",className:"EslEntityController",view_eslEntityCreated:function(a){App.eventMapper.addEventListener("w2dE_GetPlans",a,a.override_doGetPlans);App.eventMapper.triggerEvent(ragh.MEvt.create("eslViewAddedEsl",{label:a.label,view:a.get("view"),parentEslObj:a.get("view").parentEslObj}))},view_willDestroyElement:function(){},override_doGetPlans:function(){throw"EslEntityController.override_doGetPlans() is an abstract stub function. Must be overridden without a this._super() call"}});App.register("esl-entity",App.EslEntityController,{singleton:false});App.EslStageController=App.SmartController.extend({pendingEE:[],className:"EslStageController",init:function(){return this._super()},view_didInsertElement:function(a){this.pendingEE=[];App.eventMapper.addEventListener("eslViewAddedEsl",this,this.doEslViewAddedEsl);App.eventMapper.addEventListener("viewRemovedEsl",this,this.doViewRemovedEsl);this._super(a);this.tryProcessPendingEE()},view_willDestroyElement:function(){this._super();App.eventMapper.removeEventListener("eslViewAddedEsl",this);App.eventMapper.removeEventListener("viewRemovedEsl",this);this.pendingEE=[]},doEslViewAddedEsl:function(a,b){this.pendingEE.push(b);this.tryProcessPendingEE()},doViewRemovedEsl:function(a,b){this.pendingEE.filter(function(c){return(b.view!=c.view)})},tryProcessPendingEE:function(){if(this.view){if(!this.view.addEslEnt){throw"EslStageController._processQ() the view ( subclass ) does not implememnt addEslEnt()"}this.pendingEE.forEach(function(a){return function(b,c,d){a.view.addEslEnt(b.label,b.view,b.parentEslObj)}}(this));this.pendingEE=[]}else{throw"tryProcessPendingEE() view not set"}}});App.register("controller:esl-stage",App.EslStageController,{singleton:false});App.Entity3dController=App.SmartController.extend({label:"entity-3d",className:"Entity3dController",view_didInsertElement:function(){}});App.HashBtnController=App.SmartController.extend({className:"HashBtnController",label:undefined,urlhash:undefined,routePath:undefined,view_didInsertElement:function(a){this._super(a);Em.assert('Variable "label" needs to be set on HashBtnController \ne.g. via Handlebars helper:\n\n\t{{controlWithVars \'hash-btn\' hashBtn urlhash="d1" label="Dimension 1" routePath="dimension1"}}',this.label);Em.assert('Variable "urlhash" needs to be set on HashBtnController \ne.g. via Handlebars helper:\n\n\t{{controlWithVars \'hash-btn\' hashBtn urlhash="d1" label="Dimension 1" routePath="dimension1"}}',this.urlhash);Em.assert('Variable "routePath" needs to be set on HashBtnController \ne.g. via Handlebars helper:\n\n\t{{controlWithVars \'hash-btn\' hashBtn urlhash="d1" label="Dimension 1" routePath="dimension1"}}',this.routePath);this.set("label",this.label);this.set("urlhash",this.urlhash);App.eventMapper.addEventListener("doRoute",this,this.doRoute)},doRoute:function(a,b){if(this.routePath==b.routePath){this.get("view").doHide()}else{this.get("view").doShow()}},doNavigate:function(){this.set("label",this.label);this.set("urlhash",this.urlhash);window.location.hash=this.urlhash},view_willDestroyElement:function(){this._super();App.eventMapper.removeEventListener("doRoute",this)}});App.register("controller:hash-btn",App.HashBtnController,{singleton:false});(function(){App.HeartbeatController=App.SmartController.extend({label:"HeartbeatController",timeout:null,totalHeartbeats:0,MAX_HEARTBEATS:20,myView:null,speedFactors:[],createHeartbeat:function(){var e=1000,a=3000,f=0,g=1,d=1000,c=this.speedFactors;App.eventMapper.triggerEvent(ragh.MEvt.create("heartbeat",{target:this}));for(f=0;f<c.length;f++){var b=c[f]();Ember.assert("App.HeartbeatController.createHeartbeat() speedFactor function does not return 0 - 1:"+b,(0<=b&&1>=b))}g=(c.length==0)?1:totalHeartbeats/c.length;d=e+(g*(a-e));if(this.totalHeartbeats<this.MAX_HEARTBEATS){this.totalHeartbeats++;this.timeout=setTimeout(function(h){return function(){h.createHeartbeat(h)}}(this),d)}},view_didInsertElement:function(a){this._super(a);this.myView=a},view_willDestroyElement:function(){if(typeof this.timeout=="number"){clearTimeout(this.timeout)}}})}());App.HeartbeatFlashController=App.SmartController.extend({label:"HeartbeatFlashController",content:undefined,init:function(){this.autoMappedEvents.push({type:"heartbeat",listener:this,callback:this.doHeartbeat});return this._super()},doHeartbeat:function(a,b){this.get("view").doHeartbeat()}});App.IndexNavController=App.SmartController.extend({isShowStart:true,isShowEnd:false,label:"IndexNavController",view_didInsertElement:function(a){this._super(a);console.log("view IndexNavController_didInsertElement");this.send("IndexNavController_didInsertElement",this)},doStart:function(){App.eventMapper.triggerEvent(ragh.MEvt.create("indNav_start",{target:this}))},doEnd:function(){App.eventMapper.triggerEvent(ragh.MEvt.create("indNav_end",{target:this}))}});App.register("controller:index-nav",App.IndexNavController,{singleton:false});App.InteractiveGridController=App.SmartController.extend({plotText:"",plotNumber:"",positionText:"",isPlotX:false,testColour:"red"});App.NavigationController=App.SmartController.extend({className:"NavigationController",view_willDestroyElement:function(a){this._super(a)}});App.register("controller:navigation",App.NavigationController,{singleton:false});App.PreloaderContentController=App.SmartController.extend({isLoaded:false,templateName:"preloader-content",isLoadedList:[],queue:{},view_didInsertElement:function(a){App.PRELOADER=this;this._super(a);this.queue=new createjs.LoadQueue();this.queue.installPlugin(createjs.Sound);this.queue.addEventListener("complete",(function(b){return function(f,e,h,g){b.isLoadedList.push("All done.");b.set("infoHtml",b.isLoadedList.join(" loaded<br/>"));b.isLoaded=true;App.eventMapper.triggerEvent(ragh.MEvt.create("preloaderIsLoaded",{target:b.queue}))}}(this)));this.queue.addEventListener("fileload",(function(b){return function(e){var d=e.item;var c=d.type;b.isLoadedList.push(d.src);b.set("infoHtml",b.isLoadedList.join(" loaded<br/>"));if(c==createjs.LoadQueue.IMAGE){}}}(this)));this.queue.loadManifest([{id:"test",src:"img/test.png"},{id:"copy",src:"txt/copy.txt"+(App.DEBUG?"?"+Math.random():"")},{id:"face-ash-pixel",src:"img//face-ash-pixel.png"},{id:"question-pixel",src:"img//question-pixel.png"},{id:"face-ash",src:"img//face-ash.png"},{id:"brain",src:"img//brain.png"},{id:"cog",src:"img/cog.png"}])},infoHtml:"1st",isLoadedListObserved:function(){console.log("infoHtmlSet");infoHtml=this.isLoadedList.join(", ")}.observes("isLoadedList")});(function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,e){var d=new Date().getTime();var f=Math.max(0,16-(d-b));var g=window.setTimeout(function(){h(d+f)},f);b=d+f;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());App.SubtitleController=App.SmartController.extend({controllerName:"Script Subtitle Controller",label:"SubtitleController",text:"",cursorChar:"&#0178;",atLine:0,atChar:0,atPrintedLine:0,srcLines:[],editList:[],printedLines:[""],isFreezeOnHover:true,counter:0,isHover:false,tagStart:"<p><span>",tagMid:"</span></p><p><span>",tagEnd:"</span></p>",tagCursor:'<img src="img/cursor.gif"/>',isForceFinish:false,isCursor:true,isLooping:false,isInstant:false,tagPositions:[],pendingClosingTags:[],actionTimeouts:[],lastPrinted:null,lastEdit:null,isCursorObserver:function(){if(this.get("isCursor")){this.set("tagCursor",'<img src="img/cursor.gif"/>')}else{this.set("tagCursor","")}var a=this.get("printedLines");if(a){this.setText(this.get("printedLines"),null);this.printText()}}.observes("isCursor"),lines:[],isEnded:false,isRemoved:false,hasRemoveButton:false,thescript:"",isRemoveButton:false,raf:null,lastRequestAnimationFrame:0,durSinceReadChar:0,setup:function(g){if(this.get("thescript")){g=this.get("thescript")}g=g.replace(/(\r\n|\n|\r)/gm,"\n");g=g.split("\r\n").join("\n");g=window.unescape(g);var h=[""],e=g.split("\n"),a=0,b=0,j=0,c=[];for(var f=0;f<e.length;f++){var i;if(i=e[f].indexOf("@edits=")!=-1){var n=e[f].split("@edits="),m=n[1].split(" "),d=m.reverse().pop();m.reverse();e[f]=n[0].concat(m);d=d.split(",");for(var k in d){k=k.split("")}c.push({linePosition:f,charPosition:n[0].length,currentVal:0,atChar:0,currentDirection:1,editVals:d,printed:"",editPause:false,loops:true});f--}}this.set("tagPositions",[]);this.set("editList",c);for(var f=0;f<e.length;f++){e[f]=e[f].split("");if(e[f].length==0){e[f][0]="&nbsp;"}}this.setText([""]);this.set("atLine",a);this.set("atChar",b);this.set("atPrintedLine",j);this.set("printedLines",h);this.set("srcLines",e)},view_didInsertElement:function(a){this._super(a);this.send("SubtitleController_didInsertElement",this);this.set("content",App.scriptModel);this.setup()},view_willDestroyElement:function(){console.log("SubtitleController.deactivate()...");var b=this.get("actionTimeouts");for(var a in b){window.clearTimeout(a.id)}this.set("actionTimeouts",[]);this.set("isLooping",false);this.set("isEnded",true);this.doForceFinish();this.setText([""]);this.set("atLine",0);this.set("atChar",0);this.set("atPrintedLine",0);this.set("printedLines",[""]);this.set("srcLines",[])},readChar:function(dur,me,isEvents){if(Math.random()*5000<1){console.log("******")}var me=me||this,isEvents=(typeof(isEvents)!="undefined")?isEvents:true,srcLines=me.get("srcLines"),editList=me.get("editList"),printedLines=me.get("printedLines"),atLine=me.get("atLine"),atChar=me.get("atChar"),atPrintedLine=me.get("atPrintedLine"),delayChar=1/me.get("content").get("cpms"),delayLine=me.get("content").get("newLineDelay"),delayEditLine=me.get("content").get("editDelay"),isNewLine=false,delay=delayChar,currentEdit,isLastCharBeforeDisplay=false;for(var e=0;e<editList.length;e++){if(editList[e].linePosition==atLine&&editList[e].charPosition==atChar){currentEdit=editList[e]}}if(atLine<srcLines.length){if(currentEdit){if(currentEdit.editPause){delay=delayEditLine}}else{if(atChar>=srcLines[atLine].length){delay=delayLine}}if(dur>delay){dur-=delay;if(atChar==0&&atLine==0){isNewLine=true}else{if(atChar>=srcLines[atLine].length&&!currentEdit){isNewLine=true;atChar=0;atLine++;atPrintedLine++}}if(currentEdit){with(currentEdit){editPause=false;if(currentDirection==1){printed+=editVals[currentVal][atChar];atChar++;if((atChar+1)>editVals[currentVal].length){currentDirection=-1;editPause=true}}else{printed=printed.substring(0,printed.length-1);if(printed.length==0){currentDirection=1;atChar=0;currentVal++;editPause=true;if(currentVal>=editVals.length){currentVal=0}}}}me.set("editList",editList);me.setText(this.get("printedLines"),currentEdit.printed)}else{if(!isNewLine){printedLines[atPrintedLine]+=srcLines[atLine][atChar];me.setText(printedLines,null,"char");atChar++}else{if(isNewLine){while(isEvents&&srcLines[atLine]&&srcLines[atLine][0]&&srcLines[atLine][0]=="@"){var line=srcLines[atLine].join("");if(line.indexOf("@=")==0){console.log("found tag",line);this.doTagRead(line,atPrintedLine)}else{if(line.indexOf("@actionOnRead=")==0){var words=line.split(" ");var action=words[0].split("=")[1];var delay=(words[1]&&!isNaN(parseFloat(words[1]))&&isFinite(words[1]))?parseFloat(words[1]):0;console.log("@action="+action,delay);var actionFunc=function(my,myAction,pos){return function(){var actionTOObjs=my.get("actionTimeouts");console.log(pos,actionTOObjs[pos]+"");window.clearTimeout(actionTOObjs[pos].to);actionTOObjs[pos].to=null;my.send(myAction)}}(this,action,this.get("actionTimeouts").length);var to=setTimeout(actionFunc,delay);this.get("actionTimeouts").push({func:actionFunc,to:to})}else{App.eventMapper.triggerEvent(ragh.MEvt.create(line.split(" ")[1]))}}atLine++}if(atLine<srcLines.length&&srcLines[atLine].length>0){printedLines[atPrintedLine]="";printedLines[atPrintedLine]+=srcLines[atLine][atChar];me.setText(printedLines,null,"newline");atChar++}}}}}else{}}else{me.set("isEnded",true);window.cancelAnimationFrame(me.get("raf"));if(me.get("hasRemoveButton")){me.set("isRemoveButton",true)}App.eventMapper.triggerEvent(ragh.MEvt.create("sub_finishedReading",{target:this}))}me.set("srcLines",srcLines);me.set("printedLines",printedLines);me.set("atLine",atLine);me.set("atChar",atChar);me.set("atPrintedLine",atPrintedLine);return dur},doEdit:function(b,a){},getTagCodeFromLine:function(a){var b=unescape(a).split("@=");b.splice(0,1);return b[0]},getClosedVersionOfTag:function(b){var a=(b.split(" ")[0]+">").split("");a=a.replace("\t","");a.splice(1,0,"/");return a.join("").replace(">>",">")},getMostRecentOpenTag:function(b){b.reverse();for(var a=0;a<b.length;a++){if(!b[a].isClosed){b.reverse();return b.length-a-1}}b.reverse();return -1},doTagRead:function(a,b){var g=this.get("pendingClosingTags"),f=this.get("tagPositions"),e=this.getTagCodeFromLine(a);if(e.charAt(1)!="/"){var c=f.length;f.push({lineOpened:b,code:e,expectedClosed:this.getClosedVersionOfTag(e),isClosed:false});g.push(f[c].expectedClosed)}else{var d=this.getMostRecentOpenTag(f);f[d].isClosed=true;f[d].lineClosed=b-1;g.pop()}this.set("pendingClosingTags",g);this.set("tagPositions",f)},createTaggedLines:function(f,i,a){if(f+""=="NaN"){console.log(f,a)}var e=this.get("tagPositions"),i=i||"",c=this.get("pendingClosingTags"),j=f.slice(0),h=j.length-1;for(var d=0;d<j.length;d++){if(d==j.length-1){j[d]=this.tagStart+j[d]+"<i>"+i+"</i>"+this.tagCursor+this.tagEnd}else{j[d]=this.tagStart+j[d]+this.tagEnd}}e.reverse();for(var k=0;k<e.length;k++){var m=e[k],b=Math.min(m.lineOpened,h);if(m.lineOpened<=h){j[b]=m.code+j[b]}else{j[b]=j[b]+m.code}if(m.isClosed){var g=Math.min(m.lineClosed,h);j[g]=j[g]+m.expectedClosed}}e.reverse();j[h]=j[h]+c.join("");this.set("tagPositions",e);this.set("pendingClosingTags",c);return j.join("")},doRemoveClicked:function(){window.cancelAnimationFrame(this.get("raf"));this.set("isEnded",true);this.set("isRemoved",true);this.setText("")},setText:function(b,a){this.set("lastPrinted",b);this.set("lastEdit",a)},printText:function(){if($(".text",$(this.get("view").get("element")))[0]){$(".text",$(this.get("view").get("element")))[0].innerHTML=this.createTaggedLines(this.get("lastPrinted"),this.get("lastEdit"))}},startReading:function(){if(this.get("isInstant")){this.doForceFinish()}else{var a=function(c){var b=function(f){var e=c.get("lastRequestAnimationFrame"),d=c.get("durSinceReadChar");d+=(e?f-e:0);c.set("lastRequestAnimationFrame",f);if(!c.get("isHover")){d=c.reDraw(d,c)}c.set("durSinceReadChar",d);if(!c.get("isEnded")||c.get("isLooping")){c.set("raf",window.requestAnimationFrame(b))}};return b}(this);this.set("raf",window.requestAnimationFrame(a))}},getActionEvent:function(){console.log("getActionEvent",this.get("actionEvent"));this.send(this.get("actionEvent"))},doClicked:function(){if(this.get("actionEvent")){this.send(this.get("actionEvent"))}this.doForceFinish()},reDraw:function(a,b){var c=a;while(c!=(a=b.readChar(a,b))){c=a}this.printText();return a},doForceFinish:function(){console.log("doForceFinish");this.set("editList",[]);window.cancelAnimationFrame(this.get("raf"));while(!this.get("isEnded")){this.readChar(99999,this,true)}this.printText()}});App.register("controller:subtitle",App.SubtitleController,{singleton:false});App.TransitionController=App.SmartController.extend({});App.TransitionsHolderController=App.SmartController.extend({init:function(){App.eventMapper.addEventListener("doTransition",this,function(a){return function(b,c){a.doTransition(c.$canvas)}}(this));return this._super()},doTransition:function(a){this.view.doTransition(a)}});App.World2dEditorController=App.SmartController.extend({addCog:function(){App.eventMapper.triggerEvent(ragh.MEvt.create("w2dE_AddCog"))},addPixel:function(){App.eventMapper.triggerEvent(ragh.MEvt.create("W2dE_addPixel"))},getAddedStaticPlans:function(){App.eventMapper.triggerEvent(ragh.MEvt.create("w2dE_GetPlans"))}});App.World3dController=App.SmartController.extend({className:"World3dController",label:"World3dController",isQuestionMarkRotating:false,isQuestionMarkRotatingHint:false,doQuestionMarkRotate:function(){console.log("controller knows it is rotate time");this.set("isQuestionMarkRotating",true)},doRotateQuestionMarkHint:function(){console.log("doQuestionMarkRotateHint");this.set("isQuestionMarkRotatingHint",true)},view_doQuestionMarkRotateDone:function(){this.set("isQuestionMarkRotating",false);this.send("doQuestionMarkRotateDone")}});App.register("controller:world-3d",App.World3dController,{singleton:false});App.AudioView=App.SmartView.extend({tagName:"audio",className:"audio-view",attributeBindings:["src"],autoplay:false,preload:false,src:undefined,isSrcObservedPending:false,didInsertElement:function(){var a=this.get("element");a.addEventListener("canplaythrough",function(){a.removeEventListener("canplaythrough");a.audioLoaded=true},false);if(isSrcObservedPending){this.srcObserved()}},srcObserved:function(){isSrcObservedPending=false;var a=this.get("element");if(a){a.play();setTimeout(function(){a.pause()},0)}else{isSrcObservedPending=true}}.observes("src"),play:function(){this.get("element").play()}});App.Dimension1NavView=App.SmartView.extend({templateName:"dimension1-nav"});App.Dimension2NavView=App.SmartView.extend({templateName:"dimension2-nav"});App.EslEntityContainerView=App.SmartContainerView.extend({templateName:"esl-entity-container"});App.EslEntityView=App.SmartView.extend({eslObj:null,tag:"span",className:"EslEntityView",parentEslObj:null,eslObjSettings:{x:0,y:0,fromController:["x","y"]},override_createEsl:function(){throw"EslEntityView.override_createEsl() is a stub function. Must be overridden without a this._super() call";return null},override_draw:function(a){throw"EslEntityView.override_draw() is a stub function. Must be overridden without a this._super() call"},override_update:function(){throw"EslEntityView.override_update() is a stub function. Must be overridden without a this._super() call"},didInsertElement:function(){this._super();this.eslObj=this.override_createEsl();if(this.get("parentView").eslObj){this.parentEslObj=this.get("parentView").eslObj}this.initialDraw();this.get("controller").send("view_eslEntityCreated",this.get("controller"));this.dispatchEvent($.extend(new Event("eslObjCreated"),{view:this,eslObj:this.eslObj,parentEslObj:this.parentEslObj}))},initialDraw:function(){var d={},f=this.get("eslObjSettings"),a=this.get("controller"),e=f.fromController;for(var b=0,c=e[b];b<e.length;b++){c=e[b];if(typeof a[c]!="undefined"){d[c]=a[c]}}this.override_draw($.extend({},f,d))},willDestroyElement:function(){},snap:function(a){return Math.round(a/5)*5}});App.EslStageView=App.SmartView.extend({tagName:"div",className:"EslStageView",test:["t0"],testgs:["gs0"],eslEntities:[],canvas:null,$canvas:null,stage:null,init:function(){this.eslEntities.splice(0,this.eslEntities.length);return this._super()},didInsertElement:function(scope){this.eslEntities=[];with(this){_super();canvas=$el.append('<canvas class="esl-stage-canvas">');$canvas=$(".esl-stage-canvas",$el);stage=new createjs.Stage($canvas[0]);stage.x=0.5;stage.y=0}},addEslEnt:function(b,c,a){if(!a){a=this.stage}this.eslEntities.push(c);a.addChild(c.get("eslObj"))},willDestroyElement:function(){this._super();this.stage.removeAllChildren();this.stage.removeAllEventListeners();this.eslEntities.splice(0,this.eslEntities.length)}});App.Entity3dView=App.SmartView.extend({templateName:"entity-3d",didInsertElement:function(){this._super();this.override_3dCreate()},override_3dCreate:function(){var y=["__XXXXXX","_XXX____","_XX_____","X_______"];for(var m=0;m<y.length;m++){y[m]=y[m].split("")}for(var l=0;l<y.length;l++){}var k=30,z=rows=12,o=k,c=[],A=this.data={},a=App.world3d,h=this.grp=new THREE.Object3D(),q=a.textures.face,w=a.textures.brain=THREE.ImageUtils.loadTexture("img/brain.png"),s=a.materials.brain=new THREE.MeshBasicMaterial({map:w}),e=new THREE.MeshLambertMaterial({map:w,transparent:true}),j;for(var x=0;x<5;x++){c.push(s)}for(var t=0;t<(z*z);t++){var q=THREE.ImageUtils.loadTexture("img/face-ash.png");q.offset.x=(t%z)/(z);q.offset.y=(t-(t%z))/(z*z);q.repeat.x=q.repeat.y=1/z;j=new THREE.MeshLambertMaterial({map:q,transparent:true});var n=c.slice();n.splice(4,0,j);var v=new THREE.CubeGeometry(k,k,k,1,1,1);var u=A["cubeBrain"+t]=new THREE.Mesh(v,new THREE.MeshFaceMaterial(n));u.overdraw=false;var g=Math.floor(t/z);u.position.set((o*(t%z))-(o*(z-1)/2),o*(g-(rows-1)/2),0);h.add(u)}var d=new THREE.PointLight(16777215);var f=100;d.position.set(0,0,f);createjs.Tween.get(h.rotation).to({y:Math.PI},1500).wait(1500).to({y:0},1500);h.position.set(k*z/2,k*-z/2,0)},override_3dUpdate:function(){},willDestroyElement:function(){this._super();window.cancelAnimationFrame(this.get("raf"))}});App.HashBtnView=App.SmartView.extend({name:"HashBtn",templateName:"hash-btn",doHide:function(){$("button",this.get("$el")).attr("disabled",true)},doShow:function(){$("button",this.get("$el")).attr("disabled",false)}});App.HeartbeatFlashView=App.SmartView.extend({className:"HeartbeatFlashView",templateName:"heartbeat-flash",doHeartbeat:function(){this.$().removeClass("heartbeat-off");this.$().addClass("heartbeat-on");var a=this;(function(){setTimeout((function(){a.$().removeClass("heartbeat-on");a.$().addClass("heartbeat-off")}),1000)}())}});App.HeartbeatView=App.SmartView.extend({className:"HeartbeatView",templateName:"heartbeat",didInsertElement:function(){this.get("controller").send("view_didInsertElement",this)},doStart:function(){this.$().find(".nav-btn").css("display","none")}});App.IndexNavView=App.SmartView.extend({templateName:"index-nav",init:function(){return this._super()}});App.IGVC={LEGEND:[{colour:"#99CC99",fill:"#669966",className:"graph-plot-tech-portfolio",label:"About this website specifically"},{colour:"#CC9999",fill:"#996666",className:"graph-plot-tech-general",label:"About my general tech. knowledge"},{colour:"#9999CC",fill:"#666699",className:"graph-plot-general",label:"About me generally"}],TECH_PORTFOLIO:0,TECH_GENERAL:1,GENERAL:2};App.InteractiveGridView=App.SmartView.extend({PLOT_HEAD_0:'<h3 class="graph-plot-heading">',PLOT_HEAD_1:"</h3>",PLOT_ITEMS_0:"<ul><li>",PLOT_ITEMS_X:"</li><li>",PLOT_ITEMS_1:"</li></ul>",name:"InteractiveGridView",templateName:"interactive-grid",tagName:"div",grid:[[]],testColor:"#99CC99",LEGEND:[{colour:"#99CC99",fill:"#669966",className:"graph-plot-tech-portfolio",label:"About this website specifically"},{colour:"#CC9999",fill:"#996666",className:"graph-plot-tech-general",label:"About my general tech. knowledge"},{colour:"#9999CC",fill:"#666699",className:"graph-plot-general",label:"About me generally"}],isDrawGrid:false,plots:[{x:32,text:"years breathing",type:App.IGVC.LEGEND[App.IGVC.TECH_PORTFOLIO]},{x:9,text:"years as a developer",type:App.IGVC.LEGEND[App.IGVC.GENERAL]},{x:4,text:"years of study",type:App.IGVC.LEGEND[App.IGVC.GENERAL]},{text:"applications I know well",xList:["Adobe Photoshop","Adobe After Effects","Adobe Premiere","Adobe Media Encoder","Adobe Fireworks","Adobe Flex","Adobe Flash","Audacity (Sound)","Aperture (RAW photo manip)","SourceTree (SVN)"],type:App.IGVC.LEGEND[App.IGVC.TECH_GENERAL]},{text:"frontend technologies I know",xList:["Javascript","Actionscript 3.0","Actionscript 2.0","HTML inc HTML5","CSS inc CSS3","CSS","SVG","Sass","Less"],type:App.IGVC.LEGEND[App.IGVC.TECH_GENERAL]},{text:"backend technologies I know",xList:["node.js","PHP","mySQL","PostGRES","MAMP, WIMP, XAMPP <i>etc</i>"],type:App.IGVC.LEGEND[App.IGVC.TECH_GENERAL]},{text:"JS libraries I used in this site",xList:["JQuery","Emberjs","Handlebars (inc. custom helpers)","Underscorejs","Createjs: <ul><li>Preloadjs</li><li>Easeljs</li><li>Tweenjs</li></ul>","Raphaeljs"],type:App.IGVC.LEGEND[App.IGVC.TECH_PORTFOLIO]},{x:50,text:"Ember Views written for this site",type:App.IGVC.LEGEND[App.IGVC.TECH_PORTFOLIO]},{text:"Frameworks I used in this site",xList:["Emberjs","Foundation 4"],type:App.IGVC.LEGEND[App.IGVC.TECH_PORTFOLIO]},{text:"GIT commits I made for this site",x:44,type:App.IGVC.LEGEND[App.IGVC.TECH_PORTFOLIO]},{text:"javascript features I used in the website",xList:["closures","request animation frame","prototype inheritance"],type:App.IGVC.LEGEND[App.IGVC.TECH_PORTFOLIO]}],pixW:0,pixH:0,shownPlotIndex:null,didInsertElement:function(){this._super();var c,o=1200,C=2000,A=this.get("controller").get("pixW")||C,d=this.get("controller").get("pixH")||o,g=20,f=20,n,l,b=this.get("grid"),v=this.get("plots"),z=[{fill:"#CCCCCC","stroke-width":2,stroke:"#595959",opacity:0.5},{fill:"#EEEEEE","stroke-width":2,stroke:"#595959",opacity:0.5}],a=[{fill:"#444444","stroke-width":1,stroke:"#999999",opacity:1},{fill:"#666666","stroke-width":1,stroke:"#999999",opacity:1}],t=["#669966","#99CC99"],G=Raphael.animation({}),k,q=$(".position-text",this.get("$el")).css({position:"absolute"}),s=$(".plot-text",this.get("$el")).css({position:"absolute"}),m=this.set("$svgRaphaeljs",$("#svg-raphaeljs",this.get("$el"))),F=function(p,h){if(p.x<h.x){return -1}if(p.x>h.x){return 1}return 0};this.set("$legend",$(".graph-legend",this.get("$el")));this.set("$graphPosition",$(".graph-position",this.get("$el")));this.set("plots",this.get("plots").sort(F));this.set("raphaeljs",c=new Raphael("svg-raphaeljs","100%","100%"));$("svg",this.get("$el")).attr({"text-antialiasing":true,width:"100%",xmlns:"http: //www.w3.org/2000/svg",version:"1.1"});c.setViewBox(0,0,o,C,false);var B=function(w,p,h){h=Math.abs(h);if(w<=(p+h)&&w>=(p-h)){return true}return false};if(this.get("isDrawGrid")){for(n=0;n<o/A;n++){var e=(n)%2;if(!b[0]){b[0]=[]}if(e==1){b[0][l]=c.path("M"+(n*A)+" 0L"+(n*A)+" "+C);b[0][l].attr(z[e])}}for(l=0;l<C/d;l++){var e=(l)%2;if(!b[1]){b[1]=[]}if(e==1){b[1][l]=c.path("M0 "+(l*d)+"L"+o+" "+l*d);b[1][l].attr(z[e])}}}for(var u=0;u<v.length;u++){if(v[u].xList){v[u].x=v[u].xList.length}v[u].plotShape=c.rect(0,(v[u].y*f||0),v[u].x*g,(v[u].y*f)||C).attr({fill:v[u].type.fill||t[0],"stroke-width":0,opacity:0})}var j=c.rect(0,0,3,C).attr({fill:"#595959","stroke-width":0});var i=c.rect(0,0,o,C).attr({"stroke-width":0,fill:"#001133",opacity:0});$(i.node).addClass("grid-zone");this.set("$mouseZone",$(i.node));var E=$("svg",this.get("$el"))[0].createSVGPoint();var D=function(w,h){var p=h.get("$mouseZone");var x=p.parent().offset();E.x=w.pageX-x.left;E.y=w.pageY-x.top;if(!p.parent()[0].getScreenCTM){return E}return E.matrixTransform(p.parent()[0].getScreenCTM().inverse())};$(this.get("$el"),i).mousedown(function(h){return function(p){console.log("click",p,p.target)}}(this));var r=function(w,h,p,x,y){return function(ah){w.get("$el").css({opacity:1});createjs.Tween.get(w.get("$el")[0],{override:true}).wait(500).to({opacity:0.25},3000);var J=D(ah,w),Z=J.x,Y=J.y,R=Math.floor(Z/A),P=Math.floor(Y/d),T=(R+P)%2,S,Q,ai=w.get("prevPlotArea")||[[],[]];w.set("prevPlotArea",ai);if(w.get("controller").get("isPlotX")){var N=Math.round(Z/g),L=Math.round(Y/f),X=N,aj="",W="Anything",ak,M,ac,ag,af,K,H,I=w.get("shownPlotIndex"),aa=o;for(var ab=0;ab<v.length;ab++){ak=Math.abs(v[ab].x-N);testNearEnough=(!v[ab].x||B(v[ab].x,N,10/g))&&(!v[ab].y||B(v[ab].y,P,10/f));testNearest=!M||M>ak;if(testNearEnough&&testNearest){ac=ab;M=ak;W=v[ab].x}}if(I!=ac){if(typeof(I)!="undefined"&&I!=null){v[I].plotShape.animate({opacity:0},120)}}if(typeof(ac)!="undefined"){var O=v[ac],ae=(O.xList)?w.PLOT_ITEMS_0+O.xList.join(w.PLOT_ITEMS_X)+w.PLOT_ITEMS_1:"",ad=w.PLOT_HEAD_0+O.text+w.PLOT_HEAD_1,V='<span class="'+O.type.className+'">',U="</span>";O.plotShape.attr({opacity:1});w.set("shownPlotIndex",ac);w.get("controller").set("plotText",V+ad+ae+U);w.get("controller").set("plotNumber",V+O.x+U);aa=O.x*g}else{w.set("shownPlotIndex",null);w.get("controller").set("plotText","");w.get("controller").set("plotNumber","")}w.get("controller").set("positionText",X);h.stop();h.attr({x:Z-h.attr("width")});w.set("positionText",X)}}};$(document).bind("mousemove.InteractiveGridView",r(this,j,a,z,t));r(this,j,a,z,t);this.doResize()},willDestroyElement:function(){this._super();$(document).unbind("mousemove.InteractiveGridView");$(window).unbind("resize.InteractiveGridView")},doResize:function(g){var c=1200;var f=2000;var b=this.get("$svgRaphaeljs").width();var a=d(f,c,b);this.get("$svgRaphaeljs").height(a);function d(i,h,e){return(i/h*e)}}});App.NavigationView=App.SmartView.extend({templateName:"navigation"});App.PreloaderContentView=App.SmartView.extend({templateName:"preloader-content"});App.SubtitleView=App.SmartView.extend({name:"Subtitle",templateName:"subtitle",subtitleText:"Lorum ipsum",tagName:"div",didInsertElement:function(e,d,f){this._super();$(".text",this.get("$el")).hover(function(a){return function(){a.get("controller").set("isHover",true)}}(this),function(a){return function(){a.get("controller").set("isHover",false)}}(this));$(".text",this.get("$el")).on("click","span",function(a){return function(){a.get("controller").send("doClicked")}}(this));return this._super()}});App.TransitionView=App.SmartView.extend({className:"TransitionView",templateName:"transition",tagName:"div",$dst:undefined,didInsertElement:function(){this._super();this.$dst=$("canvas.transition-canvas",this.get("$el"));$(window).bind("resize.TransitionView",function(a){return function(){a.doResize()}}(this));this.get("$el").bind("click.TransitionView",function(a){return function(){a.doClick()}}(this));App.transitionView=this;this.doResize()},draw:function(a){var b=this.$dst;var c={width:a.css("width"),height:a.css("height")};b.css(c).attr(c);b[0].getContext("2d").clearRect(0,0,b[0].width,b[0].height);b[0].getContext("2d").drawImage(a[0],0,0)},show:function(){this.get("$el").fadeIn(0)},hide:function(){this.get("$el").fadeOut(1400)},clear:function(){this.$dst[0].getContext("2d").clearRect(0,0,this.$dst[0].width,this.$dst[0].height)},willDestroyElement:function(){this._super();$(window).unbind("resize.TransitionView")},doClick:function(b){var a=this.get("parentView");a.removeObject(this)},doResize:function(f){var a,c,d,b=$(window).width();if(b>App.BREAKPOINT.WIDTH_2){a=App.BREAKPOINT.WIDTH_2;c=App.BREAKPOINT.HEIGHT_2;d="rgba(0, 255, 200, 0.2)"}else{if(b>App.BREAKPOINT.WIDTH_1){a=App.BREAKPOINT.WIDTH_1;c=App.BREAKPOINT.HEIGHT_1;d="rgba(0, 200, 255, 0.2)"}else{a=App.BREAKPOINT.WIDTH_0;c=App.BREAKPOINT.HEIGHT_0;d="rgba(0, 200, 200, 0.2)"}}$(".transition-canvas",this.get("$el")).css({width:a+"px",height:c+"px"})},redraw:function(){}});App.TransitionsHolderView=App.SmartContainerView.extend({className:"TransitionsHolderView",templateName:"transitions-holder",tagName:"div",didInsertElement:function(){this._super()},doTransition:function(a){console.log("doTransition",a);this.pushObject(App.TransitionView.create({controller:App.TransitionController.create(),$canvasSrc:a}))}});App.World2dEditorView=App.SmartView.extend({tagName:"div",didInsertElement:function(){with(this){_super()}}});App.World3dView=App.SmartView.extend({templateName:"world-3d",className:"World3dView",label:"world-3d-view",tag:"canvas",materials:{},textures:{},VS:10,FACE_ASH:"face-ash",QUESTION_MARK:"question-mark",isQuestionMarkRotate:false,instanceVarNameArr:["renderer","camera","isControls","controls","cursor3D","mouse2D","pickProjector","ray","rayCaster","scene","lastRequestAnimationFrame","voxelPosition","tmpVec","normalMatrix","tcanvas","ignoreList","pixelObjectList"],instanceVarObj:{},init:function(){this._super();console.log("init");this.set("isControls",false);this.set("scene",null);this.set("renderer",null);this.set("rendererStats",null);this.set("camera",null);this.set("controls",null);this.set("cursor3D",null);this.set("mouse2D",null);this.set("pickProjector",null);this.set("voxelPosition",null);this.set("normalMatrix",null);this.set("tmpVec",null);this.set("ignoreList",[]);this.set("pixelObjectList",{});var b=this.get("instanceVarNameArr"),a=this.get("instanceVarObj");for(var c=0;c<b.length;c++){a[b[c]]=this.get(b[c])}this.set("instanceVarObj",a);return this},observingIsQuestionMarkRotateHint:function(){if(this.get("controller.isQuestionMarkRotatingHint")){var a=this.get("instanceVarObj"),c=a.pixelObjectList,b=a.camera,d=c[this.QUESTION_MARK].group.rotation;createjs.Tween.get(d).to({y:Math.PI*0.125},600)}}.observes("controller.isQuestionMarkRotatingHint"),observingIsQuestionMarkRotate:function(){var d=this.get("controller.isQuestionMarkRotating"),a=this.get("instanceVarObj"),c=a.pixelObjectList,b=a.camera;if(d&&!this.isQuestionMarkRotate&&b&&c[this.QUESTION_MARK]&&this.el){console.log("OBSERVED",d,this.el);this.isQuestionMarkRotate=Object.createFromPrototype(ragh.THREE.Dragger,{camera:b,dragged:c[this.QUESTION_MARK].group,el:this.el})}else{if(!d&&this.isQuestionMarkRotate){this.isQuestionMarkRotate.destroy();this.isQuestionMarkRotate=false}}}.observes("controller.isQuestionMarkRotating"),didInsertElement:function(){this._super();var instanceVarObj=this.get("instanceVarObj");WIDTH=400,HEIGHT=300,VIEW_ANGLE=45,ASPECT=WIDTH/HEIGHT,NEAR=0.1,FAR=10000;App.world3d=this;with(instanceVarObj){this._super();scene=new THREE.Scene();renderer=new THREE.WebGLRenderer({antialias:true,preserveDrawingBuffer:true});this.get("$el").append(renderer.domElement);$(renderer.domElement).addClass("world-3d-renderer");camera=new THREE.OrthographicCamera(WIDTH/-2,WIDTH/2,HEIGHT/2,HEIGHT/-2,1,5000);camera.position.set(WIDTH/2,0,1000);scene.add(camera);scene.add(new THREE.AmbientLight(3355443).position.copy(new THREE.Vector3(0,0,50)));var directionalLight=new THREE.DirectionalLight(16777215,1);directionalLight.position.set(0,0,1);scene.add(directionalLight);cursor3D=new THREE.Object3D();cursor3D.overdraw=true;scene.add(cursor3D);mouse2D=new THREE.Vector3(0,10000,0.5);pickProjector=new THREE.Projector();voxelPosition=new THREE.Vector3();normalMatrix=new THREE.Matrix3();tmpVec=new THREE.Vector3()}setTimeout(function(me,ainstanceVarObj){return function(){var plans=[{imgMap:me.createFromImage(App.PRELOADER.queue.getResult("face-ash-pixel")),x:50,label:me.FACE_ASH},{imgMap:me.createFromImage(App.PRELOADER.queue.getResult("question-pixel")),x:450,label:me.QUESTION_MARK}];for(var p=0;p<plans.length;p++){var pixelatedObj=Object.createFromPrototype(CubeGroup,plans[p]),pixelatedObjGroup=pixelatedObj.group;console.log("pixelatedObj",plans[p].label,pixelatedObj);ainstanceVarObj.ignoreList.push(pixelatedObj.rollOverMesh);ainstanceVarObj.scene.add(pixelatedObjGroup);ainstanceVarObj.pixelObjectList[plans[p].label]=pixelatedObj}console.log("pushed voxel groups",ainstanceVarObj);me.tryStart(ainstanceVarObj)}}(this,instanceVarObj),0);this.resize()},tryCreateRenderStats:function(){if(!App.DEBUG){return null}var a=new THREEx.RendererStats();a.domElement.style.position="absolute";a.domElement.style.left="0px";a.domElement.style.bottom="0px";document.body.appendChild(a.domElement);return a},createControls:function(b){var a=new THREE.TrackballControls(b);a.target.set(0,0,0);a.rotateSpeed=1;a.zoomSpeed=1.2;a.panSpeed=0.8;a.noZoom=false;a.noPan=false;a.staticMoving=true;a.dynamicDampingFactor=0;a.keys=[65,83,68];a.addEventListener("change.world3d",function(c){return function(){this.redraw}}(this));return a},tryStart:function(b){console.log("tryStart",b.pixelObjectList[this.FACE_ASH],b.pixelObjectList[this.QUESTION_MARK],b.pixelObjectList);if(b.pixelObjectList[this.FACE_ASH]&&b.pixelObjectList[this.QUESTION_MARK]){var a=function(d){var c=function(f){var e=(this.lastRequestAnimationFrame)?f-this.lastRequestAnimationFrame:0;this.lastRequestAnimationFrame=f;d.redraw(e);d.set("raf",window.requestAnimationFrame(c))};return c}(this);this.set("raf",window.requestAnimationFrame(a));this.get("$el").mousemove(function(c){return function(d){c.onDocumentMouseMove(d)}}(this),false);$(window).bind("resize.world3d",function(c){return function(){c.resize()}}(this));this.resize();$(".world-3d-renderer",this.get("$el")).css("background-image","none")}},createFromImage:function(u,j,d,l){var b=new THREE.Object3D(),n=this.get("instanceVarObj");this.get("$el").append('<canvas class="temp">');this.$tcanvas=$("canvas.temp",this.get("$el")).css("display","none");this.tcanvas=this.$tcanvas[0];if(!this.tcanvas.getContext){setTimeout(function(c){return function(){c.createFromImage(u)}}(this),1000)}else{var s=[[[]]],g=12,p=12,a,r=this.tcanvas,m=r.getContext("2d"),q,k;console.log(u);m.drawImage(u,0,0);q=m.getImageData(0,0,g,p);k=q.data;for(var o=0;o<k.length;o+=4){a=o/4;if(k[o+3]==255){var f=a%g;var e=Math.floor(a/g);if(!s[f]){s[f]=[]}if(!s[f][e]){s[f][e]=[]}var t=(65536*k[o+0]+256*k[o+1]+k[o+2]).toString(16);s[f][e][0]={color:"#"+t}}}this.$tcanvas=this.tcanvas=null;$("canvas",this.get("$el")).remove(".temp");return s}},onDocumentMouseMove:function(c){c.preventDefault();var a=this.get("instanceVarObj");var b=(c.clientX/window.innerWidth);if(!window.evented){window.evented=true}a.mouse2D.x=(c.layerX/this.w)*2-1;a.mouse2D.y=-(c.layerY/this.h)*2+1},onDocumentMouseDown:function(event){with(this){event.preventDefault();var intersects=ray.intersectObjects(questionGroup.children,true);console.log("intersects",intersects);if(intersects.length>0){intersector=testIsIgnored(intersects);if(false){if(intersector.object!=plane){scene.remove(intersector.object)}}else{intersector=testIsIgnored(intersects);if(intersector){this.questionVoxelGroup.tryAddHere(intersector)}}}}},resize:function(){var w,h,trails=0,tmpbgColor,renderer=this.renderer,camera=this.camera,tmpwinWidth=this.tmpwinWidth=$(window).width();if(tmpwinWidth>App.BREAKPOINT.WIDTH_2){w=App.BREAKPOINT.WIDTH_2;h=App.BREAKPOINT.HEIGHT_2;tmpbgColor="rgba(200, 255, 200, "+(trails?1/trails:1)+")"}else{if(tmpwinWidth>App.BREAKPOINT.WIDTH_1){w=App.BREAKPOINT.WIDTH_1;h=App.BREAKPOINT.HEIGHT_1;tmpbgColor="rgba(200, 200, 255, "+(trails?1/trails:1)+")"}else{w=App.BREAKPOINT.WIDTH_0;h=App.BREAKPOINT.HEIGHT_0;tmpbgColor="rgba(255, 200, 200, "+(trails?1/trails:1)+")"}}var instanceVarObj=this.get("instanceVarObj");with(instanceVarObj){$(renderer.domElement).attr({width:w+"px",height:h+"px"});renderer.setSize(w,h);camera.left=-w/2;camera.right=w/2;camera.top=h/2;camera.bottom=-h/2;camera.position.set(200,-h/2,1000);camera.updateProjectionMatrix();if(isControls){controls.handleResize()}}this.w=w;this.h=h},redraw:function(dur){var instanceVarObj=this.get("instanceVarObj");if(this.isQuestionMarkRotate&&this.isQuestionMarkRotate.dragged&&this.isQuestionMarkRotate.dragged.rotation){var a180=1*Math.PI,a360=2*Math.PI,tolerance=0.01,targetRot=2*Math.PI*0.75,targetDif=this.isQuestionMarkRotate.dragged.rotation.y-targetRot;while(targetDif<-a180){targetDif+=a360}while(targetDif>a180){targetDif-=a360}targetDif=Math.round(1000*targetDif)/1000;if(Math.min(tolerance,targetDif)==tolerance){this.isQuestionMarkRotate.animate()}else{this.isQuestionMarkRotate.dragged.rotation.y=targetRot;this.get("controller").send("view_doQuestionMarkRotateDone")}}with(instanceVarObj){var rayTouches,touched,pixelGroup;ray=pickProjector.pickingRay(mouse2D.clone(),camera);for(var i in pixelObjectList){pixelGroup=pixelObjectList[i];rayTouches=ray.intersectObjects(pixelGroup.group.children,true);if(touched=this.testIsIgnored(rayTouches)){if(i==0){cursor3D.position=this.setVoxelPosition(instanceVarObj,touched)}pixelGroup.show(touched)}}renderer.render(scene,camera);if(isControls){controls.update()}if(App.DEBUG){rendererStats.update(renderer)}}},testIsIgnored:function(c){var b=false,a;for(var d=0;d<c.length;d++){a=c[d];if(this.ignoreList.indexOf(a.object)==-1){return a}}return null},setVoxelPosition:function(ime,aintersector){with(ime){normalMatrix.getNormalMatrix(aintersector.object.matrixWorld);tmpVec.copy(aintersector.face.normal);tmpVec.applyMatrix3(normalMatrix).normalize();voxelPosition.addVectors(aintersector.point,tmpVec);voxelPosition.x=Math.floor(voxelPosition.x/this.VS)*this.VS+this.VS/2;voxelPosition.y=Math.floor(voxelPosition.y/this.VS)*this.VS+this.VS/2;voxelPosition.z=Math.floor(voxelPosition.z/this.VS)*this.VS+this.VS/2;return voxelPosition}},addE3d:function(a){this.scene.add(a)},willDestroyElement:function(){console.log("willDestroyElement 1",this.get("instanceVarObj"));var instanceVarObj=this.get("instanceVarObj");App.world3d=null;console.log("willDestroyElement 2");with(instanceVarObj){console.log("scene",scene);for(var pg=0;pg<pixelObjectList.length;pg++){pixelObjectList[pg].cleanUp();scene.remove(pixelObjectList[pg].group)}for(var sc=0;sc<scene.__objects.length;sc++){var obj=scene.__objects.length;scene.remove(obj);if(obj.geometry){obj.geometry.dispose()}if(obj.material){if(obj.material instanceof THREE.MeshFaceMaterial){$.each(obj.material.materials,function(idx,obj){obj.dispose()})}else{obj.material.dispose()}}if(obj.dispose){obj.dispose()}}}for(var i=0;i<instanceVarObj.length;i++){this.set(instanceVarObj[i],null)}this.set("instanceVarObj",null);window.cancelAnimationFrame(this.get("raf"));this.set("raf",null);this.get("$el").unbind("mousemove");$(window).unbind("resize.world3d")}});App.HeartbeatSoundController=App.AudioController.extend({label:"HeartbeatSoundController",content:undefined,init:function(){this._super();this.addAutoMappedEvent("heartbeat",this,this.doHeartbeat)},destroy:function(){App.eventMapper.removeEventListener("heartbeat",this);return this._super().destroy()},view_didInsertElement:function(a){this.set("view",a)},doHeartbeat:function(a,b){this.get("view").doHeartbeat()}});App.CogController=App.EslEntityController.extend({label:"cog",className:"CogController",view_didInsertElement:function(a){this._super(a);App.eventMapper.addEventListener("w2dE_GetPlans",this,this.doGetPlans)},doGetPlans:function(){console.log('{{ renderWithVars "'+this.label+'" "'+this.label.camelize()+'" x="'+this.get("view").eslObj.x+'" y="'+this.get("view").eslObj.y+'"}}')}});App.PersonController=App.EslEntityController.extend({className:"PersonController"});App.PixelController=App.EslEntityController.extend({label:"pixel",className:"PixelController",override_doGetPlans:function(){var a=this.get("view").handle;var b=this.get("view").shp;console.log('{{ controlWithVars "'+this.label+'" '+this.label.split("-").join("")+" x="+a.x+" y="+a.y+" width="+b.width+" height="+b.height+"}}")}});App.register("controller:pixel",App.PixelController,{singleton:false});App.QuestionMarkController=App.EslEntityController.extend({className:"QuestionMarkController",label:"QuestionMarkController",view_eslEntityCreated:function(a){this._super(a)},setVisible:function(a){this.get("view").doShowPixelInChildren()}});App.register("controller:question-mark",App.QuestionMarkController,{singleton:false});App.ScalarController=App.EslEntityController.extend({label:"ScalarController",className:"ScalarController",startDrawing:function(){this.view.startDrawing()}});App.register("controller:scalar",App.ScalarController,{singleton:false});App.ActiveEslStageController=App.EslStageController.extend({className:"ActiveEslStageController",view_willDestroyElement:function(){this._super()}});App.register("controller:active-esl-stage",App.ActiveEslStageController,{singleton:false});App.HeartbeatSoundView=App.AudioView.extend({name:"Heartbeat Sound View",templateName:"heartbeat-sound",src:"sound/heartbeat.wav",didInsertElement:function(){this.get("controller").set("view",this)},doHeartbeat:function(){this.play()}});App.CogView=App.EslEntityView.extend({templateName:"cog",className:"CogView",cog:null,dragger:null,override_createEsl:function(){this.cog=new createjs.Bitmap("img/cog.png");this.cog.image.onload=(function(a){return function(){a.cog.isImgLoaded=true;a.override_draw()}}(this));this.dragger=new createjs.Container();this.dragger.addChild(this.cog);this.dragger.addEventListener("mousedown",(function(a){return function(b){var c={x:b.target.x-b.stageX,y:b.target.y-b.stageY};b.addEventListener("mousemove",function(d){d.target.x=a.snap(d.stageX+c.x);d.target.y=a.snap(d.stageY+c.y)})}}(this)));return this.dragger},override_draw:function(b){var a=b?b:this.eslObj;Em.assert("CogView.override_draw(): function called before eslObj was created ",this.eslObj);if(this.cog.isImgLoaded){this.cog.regX=this.cog.image.width/2;this.cog.regY=this.cog.image.height/2}this.cog.scaleX=this.cog.scaleY=0.08;if(a.x){this.dragger.x=Number(a.x)}if(a.y){this.dragger.y=Number(a.y)}return this.dragger},override_reDraw:function(){},willDestroyElement:function(){this._super();this.cog=this.dragger=null}});App.PersonView=App.EslEntityView.extend({});App.PixelView=App.EslEntityView.extend({label:"pixel",shp:null,handle:null,eslObjSettings:{width:30,height:30,x:0,y:0,fromController:["x","y","width","height"]},override_createEsl:function(){this.shp=new createjs.Shape();this.handle=new createjs.Container();this.handle.addChild(this.shp);this.handle.addEventListener("mousedown",(function(a){return function(b){var c={x:b.target.x-b.stageX,y:b.target.y-b.stageY};b.addEventListener("mousemove",function(d){d.target.x=a.snap(d.stageX+c.x);d.target.y=a.snap(d.stageY+c.y)})}}(this)));return this.handle},override_draw:function(b){Em.assert("App.PixelView.draw(): method can't run without eslObj being created. eslObj = "+this.eslObj,this.eslObj);Em.assert("App.PixelView.draw(): method can't run without handle being created. handle = "+this.handle,this.handle);Em.assert("App.PixelView.draw(): method can't run without shp being created. shp = "+this.shp,this.shp);var a=b?b:this.eslObj,d=this.shp,c=this.handle;a.x=Number(a.x);a.y=Number(a.y);Em.assert('App.PixelView.draw(): value of x in eslObj is not of type "number"',!isNaN(a.x));Em.assert('App.PixelView.draw(): value of y in eslObj is not of type "number"',!isNaN(a.y));Em.assert('App.PixelView.draw(): value of width in eslObj is not of type "number" '+a.width,!isNaN(a.width));Em.assert('App.PixelView.draw(): value of height in eslObj is not of type "number" '+a.height,!isNaN(a.height));d.regX=a.width/2;d.regY=a.height/2;d.width=a.width;d.height=a.height;d.graphics.clear();d.graphics.beginFill("#FFFFFF");d.graphics.drawRect(0,0,d.width,d.height);c.x=Number(a.x);c.y=Number(a.y);this.handle=c;this.shp=d},override_reDraw:function(){}});App.QuestionMarkView=App.EslEntityView.extend({templateName:"question-mark",className:"QuestionMarkView",label:"question-mark",shp:null,handle:null,eslObjSettings:{width:30,height:30,x:0,y:0,fromController:["x","y","width","height","visible"]},doShowPixelInChildren:function(){this.handle.visible=true;var b,a;for(a=0;a<this.handle.children.length;a++){b=this.handle.children[a];b.visible=false;setTimeout(function(d,c){return function(){c.visible=true}}(this,b),Math.random(4000))}},override_createEsl:function(){this.shp=new createjs.Shape();this.handle=new createjs.Container();this.handle.addChild(this.shp);this.handle.addEventListener("mousedown",(function(a){return function(b){var c={x:b.target.x-b.stageX,y:b.target.y-b.stageY};b.addEventListener("mousemove",function(d){d.target.x=a.snap(d.stageX+c.x);d.target.y=a.snap(d.stageY+c.y)})}}(this)));return this.handle},override_draw:function(b){Em.assert("App.PixelView.draw(): method can't run without eslObj being created. eslObj = "+this.eslObj,this.eslObj);Em.assert("App.PixelView.draw(): method can't run without handle being created. handle = "+this.handle,this.handle);Em.assert("App.PixelView.draw(): method can't run without shp being created. shp = "+this.shp,this.shp);var a=b?b:this.eslObj,d=this.shp,c=this.handle;a.x=Number(a.x);a.y=Number(a.y);Em.assert('App.PixelView.draw(): value of x in eslObj is not of type "number"',!isNaN(a.x));Em.assert('App.PixelView.draw(): value of y in eslObj is not of type "number"',!isNaN(a.y));Em.assert('App.PixelView.draw(): value of width in eslObj is not of type "number" '+a.width,!isNaN(a.width));Em.assert('App.PixelView.draw(): value of height in eslObj is not of type "number" '+a.height,!isNaN(a.height));d.regX=a.width/2;d.regY=a.height/2;d.width=a.width;d.height=a.height;d.graphics.clear();if(App.DEBUG){d.graphics.beginFill("#FF0000");d.graphics.drawRect(0,0,d.width,d.height)}c.x=Number(a.x);c.y=Number(a.y);c.visible=a.visible;this.handle=c;this.shp=d},override_reDraw:function(){}});App.ScalarView=App.EslEntityView.extend({tagName:"span",templateName:"scalar",eslObjSettings:null,drawInstructions:null,eslObjSettings:{},drawInstructions:{},init:function(){this.set("drawInstructions",{isMirrored:true,axis:{step:10,count:0},smallMarks:{step:5,unit:5,count:0,markHeights:[1,1,2,2,3,3,4]},bigMarks:{step:5,unit:50,count:0,markHeights:[5,6,8,10]}});this.set("eslObjSettings",{width:2400,height:320,x:0,y:0,fromController:["x","y","width","height"]});this.set("value",Number(this.get("eslObjSettings").width)/2);return this._super()},startDrawing:function(){},override_createEsl:function(){this.set("container",this.container=new createjs.Container());this.set("shp",this.shp=new createjs.Shape());this.container.addChild(this.shp);return this.container},resize:function(){},override_draw:function(c){var b=c?c:this.get("eslObj"),a=this.get("container"),d=this.get("shp");b.x=Number(b.x);b.y=Number(b.y);Em.assert('App.ScalarView.override_draw(): value of x in eslObj is not of type "number"',!isNaN(b.x));Em.assert('App.ScalarView.override_draw(): value of y in eslObj is not of type "number"',!isNaN(b.y));Em.assert('App.ScalarView.override_draw(): value of width in eslObj is not of type "number" '+b.width,!isNaN(b.width));Em.assert('App.ScalarView.override_draw(): value of height in eslObj is not of type "number" '+b.height,!isNaN(b.height));d.width=b.width;d.height=b.height;d.x=0.5;a.regX=d.width/2;a.regY=-d.height/2;a.x=Number(b.x);a.y=Number(b.y);return d},override_reDraw:function(){var drawInstructions=this.get("drawInstructions"),shp=this.get("shp"),value=this.get("value"),offset=(drawInstructions.isMirrored)?shp.width/2:0;if(drawInstructions){shp.graphics.beginStroke("#666").setStrokeStyle(1);if(drawInstructions.axis){with(drawInstructions.axis){if(count*step<this.get("value")){if(drawInstructions.isMirrored){shp.graphics.moveTo(offset-(count)*step,0).lineTo(offset-(count+1)*step,0)}shp.graphics.moveTo(offset+(count)*step,0).lineTo(offset+(count+1)*step,0);count++}else{drawInstructions.axis=null}}}if(drawInstructions.smallMarks){with(drawInstructions.smallMarks){if(count*step<this.get("value")){for(var s=0;s<markHeights.length&&count-s>=0;s++){if(drawInstructions.isMirrored){shp.graphics.moveTo(offset-(count-s)*unit,markHeights[s]).lineTo(offset-(count-s)*unit,-markHeights[s])}shp.graphics.moveTo(offset+(count-s)*unit,markHeights[s]).lineTo(offset+(count-s)*unit,-markHeights[s])}count++}else{drawInstructions.smallMarks=null}}}if(drawInstructions.bigMarks){with(drawInstructions.bigMarks){if(count*step<this.get("value")){if(((count*step)%unit)==0){for(var s=0;s<markHeights.length&&(count*step-s*unit)>=0;s++){if(drawInstructions.isMirrored){shp.graphics.moveTo(offset-(count*step-s*unit),markHeights[s]).lineTo(offset-(count*step-s*unit),-markHeights[s])}shp.graphics.moveTo(offset+(count*step-s*unit),markHeights[s]).lineTo(offset+(count*step-s*unit),-markHeights[s])}}count++}else{drawInstructions=null}}}shp.graphics.endStroke()}}});App.ActiveEslStageView=App.EslStageView.extend({tagName:"div",className:"ActiveEslStageView",templateName:"active-esl-stage-view",trails:0,tmpbgColor:null,tmpwinWidth:null,raf:null,isAnimating:false,didInsertElement:function(){this._super();$(window).resize(function(b){return function(){b.resize()}}(this));isAnimating=true;var a=function(c){var b=function(e){var d=(c.get("lastRequestAnimationFrame"))?e-c.get("lastRequestAnimationFrame"):0;c.set("lastRequestAnimationFrame",e);c.reDraw(d);c.set("raf",window.requestAnimationFrame(b))};c.stage.update();return b}(this);this.set("raf",window.requestAnimationFrame(a));this.resize();this.reDraw()},resize:function(){this.tmpwinWidth=$(window).width();with(this){if(tmpwinWidth>App.BREAKPOINT.WIDTH_2){width=App.BREAKPOINT.WIDTH_2;height=App.BREAKPOINT.HEIGHT_2;tmpbgColor="rgba(200, 255, 200, "+(trails?1/trails:1)+")"}else{if(tmpwinWidth>App.BREAKPOINT.WIDTH_1){width=App.BREAKPOINT.WIDTH_1;height=App.BREAKPOINT.HEIGHT_1;tmpbgColor="rgba(200, 200, 255, "+(trails?1/trails:1)+")"}else{width=App.BREAKPOINT.WIDTH_0;height=App.BREAKPOINT.HEIGHT_0;tmpbgColor="rgba(255, 200, 200, "+(trails?1/trails:1)+")"}}$canvas.attr({width:width,height:height});if(App.DEBUG){$canvas.css({"box-shadow":"inset -1px -1px "+tmpbgColor,width:width,height:height})}}},reDraw:function(dur){with(this){for(var i=0;i<eslEntities.length;i++){if(eslEntities[i].override_reDraw){eslEntities[i].override_reDraw(dur)}}stage.x=-1+$canvas.attr("width")/2;stage.update()}},willDestroyElement:function(){this._super();window.cancelAnimationFrame(this.get("raf"))}});App.register("view:active-esl-stage",App.ActiveEslStageView,{singleton:false});App.AshController=App.EslEntityController.extend({className:"AshController",label:"ash"});App.register("controller:ash",App.AshController,{singleton:false});App.CoggedPixelView=App.PixelView.extend({cogView:null,label:"cogged-pixel",className:"CoggedPixelView",init:function(){this._super()},eslObjSettings:{width:30,height:30,x:0,y:0,fromController:["x","y","width","height"]},override_createEsl:function(){this.handle=this._super();var a=App.CogView.create({controller:App.CogController.create()});App.static_eslEntityContainerView.pushObject(a);a.addEventListener("eslObjCreated",(function(b){return function(c){b.addCogEsl(c)}}(this)),false);setTimeout((function(b){return function(){b.doOpen()}}(this)),2000+Math.random()*2000);return this.handle},addCogEsl:function(a){this.e_cog=a.eslObj;this.e_cog.x=this.e_cog.y=0;this.handle.addChildAt(this.e_cog)},override_draw:function(a){this._super(a)},override_reDraw:function(){},doOpen:function(){(function(c){var d={},b={},e=ragh.one(["x","y"]),a=ragh.one([1,-1])*c.shp.width*0.8;d[e]=c.shp[e];b[e]=a;window.createjs.Tween.get(c.shp).to(b,750).wait(2000).to(d,750)}(this));(function(c){var d={},b={},e="rotation",a=ragh.one([1,-1])*20*2*Math.PI;d[e]=c.shp[e];b[e]=a;window.createjs.Tween.get(c.e_cog).to(b,750).wait(2000).to(d,750)}(this))}});App.ClickAndDragScalarController=App.ScalarController.extend({label:"ClickAndDragScalarController",className:"ClickAndDragScalarController"});App.register("controller:click-and-drag-scalar",App.ClickAndDragScalarController,{singleton:false});App.ScalarValueController=App.ScalarController.extend({label:"ScalarValueController",className:"ScalarValueController"});App.register("controller:scalar-value",App.ScalarValueController,{singleton:false});App.World1dController=App.ActiveEslStageController.extend({label:"World1Controller",lineEE:null,className:"World1Controller"});App.register("controller:world1d",App.World1dController,{singleton:false});App.World2dController=App.ActiveEslStageController.extend({label:"World2dController",className:"World2dController",init:function(){App.eventMapper.addEventListener("w2dE_AddCog",this,this.doW2dE_AddCog);App.eventMapper.addEventListener("W2dE_addPixel",this,this.doW2dE_addPixel);return this._super()},doW2dE_AddCog:function(a,b){this.get("view").addCog()},doW2dE_addPixel:function(a,b){this.get("view").addPixel()},view_willDestroyElement:function(){this._super();App.eventMapper.removeEventListener("w2dE_AddCog",this);App.eventMapper.removeEventListener("W2dE_addPixel",this)},addQuestionMark:function(){console.log("C.addQuestionMark");this.get("view").addQuestionMark()}});App.register("controller:world2d",App.World2dController,{singleton:false});App.AshView=App.EslEntityView.extend({eslObj:null,className:"AshView",templateName:"ash",tag:"span",eslObjSettings:{x:0,y:0,fromController:["x","y"]},override_createEsl:function(){var c=new createjs.Shape();var b=new createjs.Bitmap("img//face-ash.png");var a=new createjs.Container();a.addChild(c);a.addChild(b);return a},override_draw:function(b){var a=b?b:this.eslObj;this.eslObj.scaleX=1;this.eslObj.x=a.x;this.eslObj.y=a.y},doMosaicEffect:function(){},override_reDraw:function(dur){var change=30/1000*dur;if(this.eslObj){with(this.eslObj){}}}});App.CoggedPixelController=App.PixelController.extend({label:"cogged-pixel"});App.register("controller:cogged-pixel",App.CoggedPixelController,{singleton:false});App.ClickAndDragScalarView=App.ScalarView.extend({templateName:"click-and-drag-scalar",COLOR:"#ff6666",MOD:2,scaleList:[{val:55,label:"wpm"},{val:67,label:"Kg"},{val:167,label:"cm"},{val:32,label:" years old"}],init:function(){this._super();this.set("eslObjSettings",$.extend(this.get("eslObjSettings"),{width:200,height:320,x:0,y:0,fromController:["x","y","width","height"]}));this.drawInstructions=this.get("drawInstructions");this.drawInstructions.smallMarks.markHeights=[4];this.drawInstructions.isMirrored=false;this.MOD=this.get("MOD");return this},didInsertElement:function(){this._super();return this},override_createEsl:function(){this.container=new createjs.Container();this.shp=new createjs.Shape();this.shp.x=0.5;this.container.addChild(this.shp);this.text=new createjs.Text("","24px Arial",this.get("COLOR"));this.text.textBaseline="alphabetic";this.container.addChild(this.text);var e="#ffffff",c=this.get("scaleList");for(var g=0;g<c.length;g++){var a=c[g],b=new createjs.Container(),d=new createjs.Shape(),f=new createjs.Text(a.val+" "+a.label,"12px Arial",e);b.addChild(d),b.addChild(f);this.container.addChild(b),verticalRise=-a.val;f.x=Math.round(a.val*this.MOD);d.graphics.clear().setStrokeStyle(1).beginStroke(e).moveTo(0,0).lineTo(f.x,0).lineTo(f.x,verticalRise).endStroke();d.x=0.5;f.y=verticalRise-20;b.alpha=0;a.esl=b}return this.container},override_draw:function(a){this._super(a);this.shp.addEventListener("tick",function(b){return function(){b.tryListenMouseMove()}}(this))},tryListenMouseMove:function(){var k=this.shp,j=this.text,i=k.graphics,b=this.drawInstructions,f=b.smallMarks,g=b.bigMarks,h=k.getStage(),c=h.canvas,e=-k.x+(h.canvas.width-k.width)/2,a=this.get("COLOR"),d;if(h){$(h.canvas).mousemove(function(l){return function(q){d=Math.round(h.mouseX-e)/l.MOD;var2d=d*l.MOD,valDir=Math.round(d/Math.abs(d));valAbs=Math.abs(d);j.x=10+var2d;j.y=-15+k.y;i.clear().setStrokeStyle(1).beginStroke(a).moveTo(0,0).lineTo(var2d,0).endStroke();1;markHeight=f.markHeights[f.markHeights.length-1];for(var p=1;p*f.unit<valAbs;p++){i.setStrokeStyle(1).beginStroke(a).moveTo(Math.round(valDir*p*f.unit,markHeight)).lineTo(Math.round(valDir*p*f.unit,-markHeight)).endStroke()}markHeight=g.markHeights[g.markHeights.length-1];for(var p=1;p*g.unit<valAbs;p++){i.beginStroke(a).moveTo(valDir*p*g.unit,markHeight).lineTo(valDir*p*g.unit,-markHeight).endStroke()}var n="",m,o=l.get("scaleList");for(var r=0;r<o.length;r++){if(Math.abs(o[r].val-d)<5){createjs.Tween.get(o[r].esl,{override:true}).to({alpha:1},180).wait(1500).to({alpha:0},700)}}j.text=n}}(this));this.shp.removeAllEventListeners("tick")}},override_reDraw:function(){},drawScale:function(a){}});App.ScalarValueView=App.ScalarView.extend({templateName:"scalar-value",eslObjSettings:{width:800,height:50,x:0,y:0,fromController:["x","y","width","height","value"]},drawInstructions:{},init:function(){this._super();this.set("eslObjSettings",{fromController:["x","y","value"]});this.set("drawInstructions",{isMirrored:false,axis:{step:10,count:0},smallMarks:{unit:5,step:5,count:0,markHeights:[5]},bigMarks:{step:5,unit:50,count:0,markHeights:[10]}});return this},override_createEsl:function(){var a=this.get("eslObjSettings");a.width=Number(this.get("value"));a.height=50;this.container=new createjs.Container();this.shp=new createjs.Shape();this.container.addChild(this.shp);this.text=new createjs.Text(this.get("scaleLabel"),"12px Arial","#666666");this.text.textBaseline="alphabetic";this.container.addChild(this.text);return this.container},override_draw:function(c){var b=c?c:this.eslObj,e=this.shp,a=this.container,d=this.text;b.x=Number(b.x);b.y=Number(b.y);Em.assert('App.ScalarView.override_draw(): value of x in eslObj is not of type "number"',!isNaN(b.x));Em.assert('App.ScalarView.override_draw(): value of y in eslObj is not of type "number"',!isNaN(b.y));Em.assert('App.ScalarView.override_draw(): value of width in eslObj is not of type "number" '+b.width,!isNaN(b.width));Em.assert('App.ScalarView.override_draw(): value of height in eslObj is not of type "number" '+b.height,!isNaN(b.height));e.width=b.width;e.height=b.height;e.x=0.5;a.x=Number(b.x);a.y=Number(b.y);a.regY=-e.height/2;d.x=10+e.width;d.y=0;return e},override_reDraw:function(a){}});App.World1dView=App.ActiveEslStageView.extend({tagName:"div",className:"World1dView",templateName:"world-1d",clickAndDragScale:undefined,didInsertElement:function(){this._super();this.get("$el").mousedown(function(a){return function(){}}(this));this.get("$el").mouseup(function(a){return function(){}}(this))},redraw:function(a){this._super()},resize:function(){var width=2400;this.$canvas.attr({width:width}).css({width:width});this.get("$el").css({width:width,"margin-left":-width/2});this.tmpwinHeight=$(window).height();with(this){if(tmpwinHeight>App.BREAKPOINT.HEIGHT_2){height=App.BREAKPOINT.HEIGHT_2;tmpbgColor="rgba(200, 255, 200, "+(trails?1/trails:1)+")"}else{if(tmpwinHeight>App.BREAKPOINT.HEIGHT_1){height=App.BREAKPOINT.HEIGHT_1;tmpbgColor="rgba(200, 200, 255, "+(trails?1/trails:1)+")"}else{height=App.BREAKPOINT.HEIGHT_0;tmpbgColor="rgba(255, 200, 200, "+(trails?1/trails:1)+")"}}$canvas.attr({height:height}).css({height:height});if(App.DEBUG){$canvas.css("box-shadow","inset -1px -1px "+tmpbgColor)}}}});App.World2dView=App.ActiveEslStageView.extend({tagName:"div",className:"World2dView",templateName:"world-2d",isMosaic:true,multiData:{},src:{},pix:{},min:{},scale:30,isVis:true,multiTween:undefined,didInsertElement:function(scope){with(this){set("multiData",{index:0,roundIndex:0,needsRedraw:false,values:[360,256,128,64,32,24,16,8,4,1]});_super();src.$canvas=$canvas.addClass("src-world-2d");src.canvas=src.$canvas[0];src.context=src.canvas.getContext("2d");src.stage=stage;src.stage.mouseMoveOutside=true;src.stage.snapToPixelEnabled=true;if(get("isVis")){$el.append('<canvas class="min-world-2d">');min.$canvas=$(".min-world-2d",$el);min.canvas=min.$canvas[0];min.context=min.canvas.getContext("2d");$el.append('<canvas class="pix-world-2d">');pix.$canvas=$(".pix-world-2d",$el);pix.context=pix.$canvas[0].getContext("2d");pix.min=min;min.src=src}src.$canvas.css({display:"none"});min.$canvas.css({display:"block"});pix.$canvas.css({display:"none"})}var multiData=this.get("multiData");this.set("multiTween",createjs.Tween.get(multiData,{}).to({index:multiData.values.length},3000,createjs.Ease.getPowIn(4.2)).addEventListener("change",function(e){var multiData=e.target.target;if(Math.round(multiData.index)!=multiData.roundIndex){multiData.needsRedraw=true}multiData.roundIndex=Math.round(multiData.index)}))},addCog:function(){console.log("adding cog");App.static_eslEntityContainerView.pushObject(App.CogView.create({controller:App.CogController.create()}))},addPixel:function(){console.log("adding pixel");var b=App.PixelController.create();var c=$.extend(App.PixelView.create().eslObjSettings,{x:0,y:0});var a=App.PixelView.create({controller:b,eslObjSettings:c});App.static_eslEntityContainerView.pushObject(a)},addQuestionMark:function(){console.log("view.addQuestionMark()")},resize:function(){with(this){_super()}},reDraw:function(dur){with(this){_super(dur);if(this.get("isVis")&&pix.context){var multiData=get("multiData"),multiIndex=Math.round(multiData.index),multiValues=multiData.values;if(multiData.needsRedraw){multiData.needsRedraw=false;if(multiIndex<multiValues.length){var multi=multiValues[multiIndex],invMulti=1/multi,widtht=src.$canvas.attr("width"),height=src.$canvas.attr("height")}else{if(this.get("isMosaic")){src.$canvas.css({display:"block"});min.$canvas.css({display:"none"});pix.$canvas.css({display:"none"});this.set("isMosaic",false);this.get("controller").send("doMosaicFinished")}}}}}},willDestroyElement:function(){createjs.Tween.removeTweens(this.get("multiTween"));this._super()}});