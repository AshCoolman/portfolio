var ragh=ragh?ragh:{};ragh.eventMapper=(function(){return{eventsAndListeners:{},addEventListener:function(b,c,d){if(!b){throw"raaagh.EventMapper: .addEventListener(): first parameter must be type from EmberMapper.createEvent()"}if(!c){throw"raaagh.EventMapper: .addEventListener(): second parameter must be listener"}if(!d){console.log("raaagh.EventMapper:",b,c._debugContainerKey,d);throw"raaagh.EventMapper: .addEventListener(): third parameter must be callback "+b+", "+c}if(!this.eventsAndListeners.hasOwnProperty(b)){this.eventsAndListeners[b]=[]}var a=this.eventsAndListeners[b].filter(function(e){return(e.listener==c)});if(a.length==0){this.eventsAndListeners[b].push({listener:c,callback:d})}return b},removeEventListener:function(a,b){assert(this.eventsAndListeners[a],"raaagh.EventMapper: this.eventsAndListeners["+a+"] is undefined");if(this.eventsAndListeners[a]){this.eventsAndListeners[a]=this.eventsAndListeners[a].filter(function(c){return(c.listener!=b)})}},trigger:function(a,b){var c=ragh.MappedEvent.create(a,b);if(!this.eventsAndListeners.hasOwnProperty(c.type)){this.eventsAndListeners[c.type]=[]}this.eventsAndListeners[c.type].filter(function(d){d.callback.call(d.listener,c.type,c.data);return true})}}}());ragh.MappedEvent=ragh.MEvt=ragh.ME={type:null,data:null,create:function(a,b){if(!a){throw"ragh.MappedEvent.create() expects first parameter to be a String describing event type"}if(typeof a!="string"){throw"ragh.MappedEvent.create() expects first parameter to be String describing event type. Currently "+(typeof a)}this.type=a;this.data=b;return this}};if(!this.assert){"use strict";this.assert=function(c,b,a){if(!c){console.info(b)}else{if(a){console.info(a)}}}}if(!Array.prototype.filter){Array.prototype.filter=function(b){var a=this.length>>>0;if(typeof b!="function"){throw new TypeError()}var e=[];var d=arguments[1];for(var c=0;c<a;c++){if(c in this){var f=this[c];if(b.call(d,f,c,this)){e.push(f)}}}return e}};if(typeof Object.createFromPrototype!=="function"){Object.createFromPrototype=function(d,b){function c(){}c.prototype=new d();var a=new c();if(a.init){a.init(b)}return a}}var CubeGroup=function(){this.isMerge=false;this.rollOver=null;this.SIZE=30;this.materialsDict={};this.group=null;this.isHover=false;this._isInteractive=false;this.hoverMat=new THREE.MeshLambertMaterial({color:14423100});this.linkMat=new THREE.MeshLambertMaterial({color:16737095});this.map=[]};CubeGroup.prototype={init:function(a){this.group=this.createFromMap(a.imgMap);this.group.position.x=a.x||0;this.group.position.y=a.y||0;this.setInteractive(a.isInteractive);this.label=a.label;this.hoverOff()},getInteractive:function(a){return this._isInteractive},setInteractive:function(a){a=a||false;if(a&&!this._isInteractive){this._isInteractive=a;this.withEveryPixel(function(b){return function(c){c.object.material=b.linkMat}}(this))}else{if(!a&&this._isInteractive){this._isInteractive=a;this.withEveryPixel(function(b){return function(c){c.object.material=c.material}}(this))}}},tryAddHere:function(a){},show:function(b){var a=this.getFacePoint(b,this.SIZE);this.rollOverMesh.position.copy(a)},hoverOn:function(){var a=false;if(!this.isHover&&this._isInteractive){this.withEveryPixel(function(b){return function(c){c.object.material=b.hoverMat}}(this));this.isHover=true;a=true}return a},hoverOff:function(){var a=false;if(this.isHover){this.withEveryPixel(function(b){return function(c){c.object.material=(b._isInteractive)?b.linkMat:c.material}}(this));this.isHover=false;a=true}return a},withEveryPixel:function(c){var e=this.map;for(var a=0;a<e.length;a++){if(!e[a]){e[a]=[]}for(var b=0;b<e[a].length;b++){if(!e[a][b]){e[a][b]=[]}for(var d=0;d<e[a][b].length;d++){if(e[a][b][d]){setTimeout(function(j,h,f,g,i){return function(){c(h[f][g][i],h,f,g,i)}}(this,e,a,b,d),30*b)}}}}},getFacePoint:function(b,c){var a=new THREE.Vector3(),d=new THREE.Vector3();a.copy(b.object.position);d.copy(b.face.centroid).normalize();d.multiplyScalar(c);a.add(d);return a},createFromMap:function(j){if(!j){throw'CubeGroup.createFromMap() passed "amap" parameter is falsey'}var i=this.SIZE,b=0,a=0,o=0,k=new THREE.Object3D(),c=(j?j:this.defaultMap),m,g,n,e;if(this.isMerge){m=[];g=new THREE.Geometry()}for(var f=0;f<c.length;f++){if(!c[f]){c[f]=[]}for(var l=0;l<c[f].length;l++){if(!c[f][l]){c[f][l]=[]}for(var h=0;h<c[f][l].length;h++){if(c[f][l][h]){b=Math.max(b,f);a=Math.max(a,l);o=Math.max(o,h)}}}}for(var f=0;f<c.length;f++){if(!c[f]){c[f]=[]}for(var l=0;l<c[f].length;l++){if(!c[f][l]){c[f][l]=[]}for(var h=0;h<c[f][l].length;h++){if(c[f][l][h]){var d=this.createCube(this.SIZE,f*i,-l*i,h*i,c[f][l][h],this.materialsDict,k,g,m,this.isMerge)}}}}if(this.isMerge){n=new THREE.Mesh(this.geo,new THREE.MeshFaceMaterial(this.materials));n.matrixAutoUpdate=false;n.updateMatrix();n.overdraw=false;n.name="cubeGroup";k.add(n)}k.position.set(0,0,0);k.updateMatrix();this.rollOverMesh=this.createRollOver();this.group=k;return k},createRollOver:function(){if(!this.isMerge){var c=new THREE.CubeGeometry(this.SIZE,this.SIZE,this.SIZE,1,1,1),a=new THREE.Mesh(c,new THREE.MeshLambertMaterial({color:255,opacity:0.25,transparent:true})),b=new THREE.PointLight(3355545);a.matrixAutoUpdate=true;a.add(b);b.intensity=2;return a}var b=new THREE.PointLight(3355545);b.intensity=2;return b},createCube:function(h,p,o,l,g,r,j,c,n,a){var k=h,d=r[g.color],q,f=new THREE.CubeGeometry(k,k,k,1,1,1);if(!this.materialsDict[g.color]){this.materialsDict[g.color]=d=new THREE.MeshLambertMaterial({color:g.color})}if(!a){THREE.GeometryUtils.merge(f,new THREE.Geometry());q=new THREE.Mesh(f,d);q.position=new THREE.Vector3(p,o,l);j.add(q)}else{for(var e=0;e<f.vertices.length;e++){f.vertices[e].add(new THREE.Vector3(p,o,l))}THREE.GeometryUtils.merge(c,f,n.length);for(var m=0;m<6;m++){n.push(d)}}this.map=this.getMap(j);return q},doRollOver:function(){},getMap:function(d){var e=[[[]]],b,f=d,a,i,g;for(var h=0;h<=f.children.length;h++,b=f.children[h-1]){if(b&&b!=this.rollOverMesh){a=Math.round(b.position.x/this.SIZE);i=-Math.round(b.position.y/this.SIZE);g=Math.round(b.position.z/this.SIZE);if(!e[a]){e[a]=[]}if(!e[a][i]){e[a][i]=[]}e[a][i][g]={childrenIndex:h,object:b,material:b.material}}}return e},cleanUp:function(){this.materials=null;this.geo=null;this.mesh=null;this.rollOverMesh=null;this.group=null;this.materials=null;this.geo=null;this.mesh=null;this.rollOverMesh=null;this.group=null;this.materialsDict=null}};THREE.TrackballControls=function(z,y){var p=this;var q={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5};this.object=z;this.domElement=(y!==undefined)?y:document;this.enabled=true;this.screen={width:0,height:0,offsetLeft:0,offsetTop:0};this.radius=(this.screen.width+this.screen.height)/4;this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=0.3;this.noRotate=false;this.noZoom=false;this.noPan=false;this.staticMoving=false;this.dynamicDampingFactor=0.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3();var i=new THREE.Vector3();var r=q.NONE,k=q.NONE,a=new THREE.Vector3(),n=new THREE.Vector3(),h=new THREE.Vector3(),j=new THREE.Vector2(),u=new THREE.Vector2(),g=0,b=0,c=new THREE.Vector2(),t=new THREE.Vector2();this.target0=this.target.clone();this.position0=this.object.position.clone();this.up0=this.object.up.clone();var x={type:"change"};this.handleResize=function(){this.screen.width=window.innerWidth;this.screen.height=window.innerHeight;this.screen.offsetLeft=0;this.screen.offsetTop=0;this.radius=(this.screen.width+this.screen.height)/4};this.handleEvent=function(A){if(typeof this[A.type]=="function"){this[A.type](A)}};this.getMouseOnScreen=function(B,A){return new THREE.Vector2((B-p.screen.offsetLeft)/p.radius*0.5,(A-p.screen.offsetTop)/p.radius*0.5)};this.getMouseProjectionOnBall=function(E,C){var B=new THREE.Vector3((E-p.screen.width*0.5-p.screen.offsetLeft)/p.radius,(p.screen.height*0.5+p.screen.offsetTop-C)/p.radius,0);var D=B.length();if(D>1){B.normalize()}else{B.z=Math.sqrt(1-D*D)}a.copy(p.object.position).sub(p.target);var A=p.object.up.clone().setLength(B.y);A.add(p.object.up.clone().cross(a).setLength(B.x));A.add(a.setLength(B.z));return A};this.rotateCamera=function(){var C=Math.acos(n.dot(h)/n.length()/h.length());if(C){var A=(new THREE.Vector3()).crossVectors(n,h).normalize(),B=new THREE.Quaternion();C*=p.rotateSpeed;B.setFromAxisAngle(A,-C);a.applyQuaternion(B);p.object.up.applyQuaternion(B);h.applyQuaternion(B);if(p.staticMoving){n.copy(h)}else{B.setFromAxisAngle(A,C*(p.dynamicDampingFactor-1));n.applyQuaternion(B)}}};this.zoomCamera=function(){if(r===q.TOUCH_ZOOM){var A=g/b;g=b;a.multiplyScalar(A)}else{var A=1+(u.y-j.y)*p.zoomSpeed;if(A!==1&&A>0){a.multiplyScalar(A);if(p.staticMoving){j.copy(u)}else{j.y+=(u.y-j.y)*this.dynamicDampingFactor}}}};this.panCamera=function(){var A=t.clone().sub(c);if(A.lengthSq()){A.multiplyScalar(a.length()*p.panSpeed);var B=a.clone().cross(p.object.up).setLength(A.x);B.add(p.object.up.clone().setLength(A.y));p.object.position.add(B);p.target.add(B);if(p.staticMoving){c=t}else{c.add(A.subVectors(t,c).multiplyScalar(p.dynamicDampingFactor))}}};this.checkDistances=function(){if(!p.noZoom||!p.noPan){if(p.object.position.lengthSq()>p.maxDistance*p.maxDistance){p.object.position.setLength(p.maxDistance)}if(a.lengthSq()<p.minDistance*p.minDistance){p.object.position.addVectors(p.target,a.setLength(p.minDistance))}}};this.update=function(){a.subVectors(p.object.position,p.target);if(!p.noRotate){p.rotateCamera()}if(!p.noZoom){p.zoomCamera()}if(!p.noPan){p.panCamera()}p.object.position.addVectors(p.target,a);p.checkDistances();p.object.lookAt(p.target);if(i.distanceToSquared(p.object.position)>0){p.dispatchEvent(x);i.copy(p.object.position)}};this.reset=function(){r=q.NONE;k=q.NONE;p.target.copy(p.target0);p.object.position.copy(p.position0);p.object.up.copy(p.up0);a.subVectors(p.object.position,p.target);p.object.lookAt(p.target);p.dispatchEvent(x);i.copy(p.object.position)};function f(A){if(p.enabled===false){return}window.removeEventListener("keydown",f);k=r;if(r!==q.NONE){return}else{if(A.keyCode===p.keys[q.ROTATE]&&!p.noRotate){r=q.ROTATE}else{if(A.keyCode===p.keys[q.ZOOM]&&!p.noZoom){r=q.ZOOM}else{if(A.keyCode===p.keys[q.PAN]&&!p.noPan){r=q.PAN}}}}}function d(A){if(p.enabled===false){return}r=k;window.addEventListener("keydown",f,false)}function m(A){if(p.enabled===false){return}A.preventDefault();A.stopPropagation();if(r===q.NONE){r=A.button}if(r===q.ROTATE&&!p.noRotate){n=h=p.getMouseProjectionOnBall(A.clientX,A.clientY)}else{if(r===q.ZOOM&&!p.noZoom){j=u=p.getMouseOnScreen(A.clientX,A.clientY)}else{if(r===q.PAN&&!p.noPan){c=t=p.getMouseOnScreen(A.clientX,A.clientY)}}}document.addEventListener("mousemove",v,false);document.addEventListener("mouseup",o,false)}function v(A){if(p.enabled===false){return}A.preventDefault();A.stopPropagation();if(r===q.ROTATE&&!p.noRotate){h=p.getMouseProjectionOnBall(A.clientX,A.clientY)}else{if(r===q.ZOOM&&!p.noZoom){u=p.getMouseOnScreen(A.clientX,A.clientY)}else{if(r===q.PAN&&!p.noPan){t=p.getMouseOnScreen(A.clientX,A.clientY)}}}}function o(A){if(p.enabled===false){return}A.preventDefault();A.stopPropagation();r=q.NONE;document.removeEventListener("mousemove",v);document.removeEventListener("mouseup",o)}function l(A){if(p.enabled===false){return}A.preventDefault();A.stopPropagation();var B=0;if(A.wheelDelta){B=A.wheelDelta/40}else{if(A.detail){B=-A.detail/3}}j.y+=B*0.01}function s(C){if(p.enabled===false){return}switch(C.touches.length){case 1:r=q.TOUCH_ROTATE;n=h=p.getMouseProjectionOnBall(C.touches[0].pageX,C.touches[0].pageY);break;case 2:r=q.TOUCH_ZOOM;var B=C.touches[0].pageX-C.touches[1].pageX;var A=C.touches[0].pageY-C.touches[1].pageY;b=g=Math.sqrt(B*B+A*A);break;case 3:r=q.TOUCH_PAN;c=t=p.getMouseOnScreen(C.touches[0].pageX,C.touches[0].pageY);break;default:r=q.NONE}}function e(C){if(p.enabled===false){return}C.preventDefault();C.stopPropagation();switch(C.touches.length){case 1:h=p.getMouseProjectionOnBall(C.touches[0].pageX,C.touches[0].pageY);break;case 2:var B=C.touches[0].pageX-C.touches[1].pageX;var A=C.touches[0].pageY-C.touches[1].pageY;b=Math.sqrt(B*B+A*A);break;case 3:t=p.getMouseOnScreen(C.touches[0].pageX,C.touches[0].pageY);break;default:r=q.NONE}}function w(A){if(p.enabled===false){return}switch(A.touches.length){case 1:n=h=p.getMouseProjectionOnBall(A.touches[0].pageX,A.touches[0].pageY);break;case 2:g=b=0;break;case 3:c=t=p.getMouseOnScreen(A.touches[0].pageX,A.touches[0].pageY);break}r=q.NONE}this.domElement.addEventListener("contextmenu",function(A){A.preventDefault()},false);this.domElement.addEventListener("mousedown",m,false);this.domElement.addEventListener("mousewheel",l,false);this.domElement.addEventListener("DOMMouseScroll",l,false);this.domElement.addEventListener("touchstart",s,false);this.domElement.addEventListener("touchend",w,false);this.domElement.addEventListener("touchmove",e,false);window.addEventListener("keydown",f,false);window.addEventListener("keyup",d,false);this.handleResize()};THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype);var ragh=ragh?ragh:{};ragh.chooseOne=ragh.one=function(a){return a[Math.round(a.length*Math.random()-0.5)]};ragh.createJsonMapFromImage=function(v,k,m){$("body").append('<canvas class="tempcreateJsonMapFromImage">');var b=$(".tempcreateJsonMapFromImage",$("body"));this.tcanvas=b[0];if(!this.tcanvas.getContext){setTimeout(function(c){return function(){c.createJsonMapFromImage(v,k,m)}}(this),100)}else{var t=[[[]]],j=v.width,q=v.height,d,s=this.tcanvas,n=s.getContext("2d"),r,l;n.clearRect(0,0,j,q);n.drawImage(v,0,0);r=n.getImageData(0,0,j,q);l=r.data;for(var p=0;p<l.length;p+=4){d=p/4;if(l[p+3]==255){var g=d%j;var f=Math.floor(d/j);if(!t[g]){t[g]=[]}if(!t[g][f]){t[g][f]=[]}var u=(65536*l[p+0]+256*l[p+1]+l[p+2]).toString(16);t[g][f][0]={color:"#"+u}}}maxX=j-1;maxY=q-1;maxZ=0;for(var e=0;e<t.length;e++){if(!t[e]){t[e]=[]}for(var o=0;o<t[e].length;o++){if(!t[e][o]){t[e][o]=[]}for(var a=0;a<t[e][o].length;a++){if(t[e][o][a]){k(e,o,0,t[e][o][0],maxX,maxY,0)}}}}b.remove(".temp-createJsonMapFromImage");this.$tcanvas=this.tcanvas=null;m(t,k,m)}};if(typeof Object.createFromPrototype!=="function"){Object.createFromPrototype=function(d,b){function c(){}c.prototype=new d();var a=new c();if(a.init){a.init(b)}return a}}if(!ragh.THREE){ragh.THREE={}}ragh.THREE.Dragger=function(){this.targetRotation=0;this.targetRotationOnMouseDown=0;this.mouseX=0;this.mouseXOnMouseDown=0;this.windowHalfX=window.innerWidth/2;this.windowHalfY=window.innerHeight/2};ragh.THREE.Dragger.prototype={init:function(a){this.camera=a.camera;this.dragged=a.dragged;this.el=a.el;console.log("Dragged, init",a);this.onWindowResize=function(b){return function(){b.windowHalfX=window.innerWidth/2;b.windowHalfY=window.innerHeight/2;b.camera.updateProjectionMatrix()}}(this);this.onDocumentMouseDown=function(b){return function(c){c.preventDefault();b.el.addEventListener("mousemove",b.onDocumentMouseMove,false);b.el.addEventListener("mouseup",b.onDocumentMouseUp,false);b.el.addEventListener("mouseout",b.onDocumentMouseOut,false);b.mouseXOnMouseDown=c.clientX-b.windowHalfX;b.targetRotationOnMouseDown=b.targetRotation}}(this);this.onDocumentMouseMove=function(b){return function(c){b.mouseX=c.clientX-b.windowHalfX;b.targetRotation=b.targetRotationOnMouseDown+(b.mouseX-b.mouseXOnMouseDown)*0.02}}(this);this.onDocumentMouseUp=function(b){return function(c){b.el.removeEventListener("mousemove",b.onDocumentMouseMove,false);b.el.removeEventListener("mouseup",b.onDocumentMouseUp,false);b.el.removeEventListener("mouseout",b.onDocumentMouseOut,false)}}(this);this.onDocumentMouseOut=function(b){return function(c){b.el.removeEventListener("mousemove",b.onDocumentMouseMove,false);b.el.removeEventListener("mouseup",b.onDocumentMouseUp,false);b.el.removeEventListener("mouseout",b.onDocumentMouseOut,false)}}(this);this.onDocumentTouchStart=function(b){return function(c){if(c.touches.length===1){c.preventDefault();b.mouseXOnMouseDown=c.touches[0].pageX-b.windowHalfX;b.targetRotationOnMouseDown=b.targetRotation}}}(this);this.onDocumentTouchMove=function(b){return function(c){if(c.touches.length===1){c.preventDefault();b.mouseX=c.touches[0].pageX-b.windowHalfX;b.targetRotation=b.targetRotationOnMouseDown+(b.mouseX-b.mouseXOnMouseDown)*0.05}}}(this);this.el.addEventListener("mousedown",this.onDocumentMouseDown,false);this.el.addEventListener("touchstart",this.onDocumentTouchStart,false);this.el.addEventListener("touchmove",this.onDocumentTouchMove,false);window.addEventListener("resize",this.onWindowResize,false)},animate:function(){this.dragged.rotation.y+=(this.targetRotation-this.dragged.rotation.y)*0.05},destroy:function(){this.el.removeEventListener("mousemove",this.onDocumentMouseMove,false);this.el.removeEventListener("mouseup",this.onDocumentMouseUp,false);this.el.removeEventListener("mouseout",this.onDocumentMouseOut,false);this.el.removeEventListener("mousedown",this.onDocumentMouseDown,false);this.el.removeEventListener("touchstart",this.onDocumentTouchStart,false);this.el.removeEventListener("touchmove",this.onDocumentTouchMove,false);window.removeEventListener("resize",this.onWindowResize,false)}};Ember.Handlebars.registerHelper("controlWithVars",function(p,j,q){if(arguments.length===2){q=j;j=undefined}var g;if(j){g=Ember.Handlebars.get(this,j,q)}var h=q.data.keywords.controller,o=q.data.keywords.view,b=Em.get(h,"_childContainers"),e=q.hash.controlID,a,n;if(b.hasOwnProperty(e)){n=b[e]}else{a=h.get("container"),n=a.child();b[e]=n}var c=p.replace(/\//g,".");var i=n.lookup("view:"+c)||n.lookup("view:default"),f=n.lookup("controller:"+c),m=n.lookup("template:"+p);if(!window.controller){window.controller=0}for(var d in q.hash){f[d]=q.hash[d]}Ember.assert("Could not find controller for path: "+c,f);Ember.assert("Could not find view for path: "+c,i);Em.set(f,"target",h);Em.set(f,"model",g);q.hash.template=m;q.hash.controller=f;function l(){var k=Ember.Handlebars.get(this,j,q);set(f,"model",k);i.rerender()}Ember.addObserver(this,j,l);i.one("willDestroyElement",this,function(){Ember.removeObserver(this,j,l)});Ember.Handlebars.helpers.view.call(this,i,q)});Ember.Handlebars.registerHelper("controlWithVarsold",function(p,l,q){var h,b,o,i,f,a,n,c;var d=p.replace(/\//g,".");console.log("controlWithVars",p);console.log(">path",p);console.log(">contextString",l);console.log(">options",q);console.log(">container",q.data.keywords.controller.container);console.log("keywords>",q.data.keywords);if(arguments.length===2){q=l;l=undefined}a=q.data.keywords.controller.container;if(typeof l==="string"){f=q.contexts[1];b=Ember.Handlebars.get(f,l,q);console.log(">(contextString is string) context",b)}else{if(l){b=Ember.Handlebars.get(this,l,q)}}if(i=q.hash.controller){}else{i=Ember.controllerFor(a,d,b)}o=q.data.keywords.view;c=Em.get(i,"_childContainers"),controlID=q.hash.controlID;if(c.hasOwnProperty(controlID)){n=c[controlID]}else{a=Em.get(i,"container"),n=a.child();c[controlID]=n}var j=n.lookup("view:"+d)||n.lookup("view:default"),g=n.lookup("controller:"+d),m=n.lookup("template:"+p);for(var e in q.hash){g.set(e,q.hash[e])}console.log("view?",o);console.log("childView?",j);console.log("childController?",g);Ember.assert("Could not find controller for path: "+d,g);Ember.assert("Could not find view for path: "+d,j);Em.set(g,"target",i);Em.set(g,"context",b);q.hash.template=m;q.hash.controller=i;console.log("adding via view:",j);Ember.Handlebars.helpers.view.call(this,j,q)});Ember.Handlebars.registerHelper("renderWithVars",function(a,e,i){Ember.assert("You must pass a template to render",arguments.length>=2);var b,h,d,g,c;if(arguments.length===2){i=e;e=undefined}if(typeof e==="string"){c=Ember.Handlebars.get(i.contexts[1],e,i)}a=a.replace(/\//g,".");b=i.data.keywords.controller.container;h=b.lookup("router:main");Ember.assert("This view is already rendered",!h||!h._lookupActiveView(a));g=b.lookup("view:"+a)||b.lookup("view:default");$.extend(i.hash.controller,i.hash);if(d=i.hash.controller){d=b.lookup("controller:"+d);console.log("controller")}else{d=Ember.controllerFor(b,a,c)}$.extend(d,i.hash);if(d&&c){d.set("model",c)}var f=i.contexts[1];if(f){g.registerObserver(f,e,function(){d.set("model",Ember.Handlebars.get(f,e,i))})}i.hash.viewName=Ember.String.camelize(a);i.hash.template=b.lookup("template:"+a);i.hash.controller=d;if(h){h._connectActiveView(a,g)}Ember.Handlebars.helpers.view.call(this,g,i)});createjs.CSSPlugin.install();App=Ember.Application.create({DEBUG:false,PRELOADER:{},preloadedImages:{},scriptModel:null,rootElement:$(".app")[0],ready:function(){App.scriptModel=App.ScriptModel.create({});App.Router.map(function(){this.route("index",{path:"/"});this.route("dimension1",{path:"/d1"});this.route("dimension2",{path:"/d2"});this.route("dimension3",{path:"/d3"})})},readyAndLoaded:function(){console.log("readyAndLoaded")},eventMapper:ragh.eventMapper,colors:["#FF0000","#993366","#3399CC","#0099FF","#00CC33","#00FF00"]});App.BREAKPOINT={WIDTH_2:1200,HEIGHT_2:600,WIDTH_1:800,HEIGHT_1:400,WIDTH_0:600,HEIGHT_0:300};App.PIXEL_SIZE=30;App.dictionary=Em.Object.create({copy:{},isReady:false,init:function(){App.eventMapper.addEventListener("preloaderIsLoaded",this,function(a){return function(c,d){var b=d.target.getResult("copy").split("=\n");b=b.splice(1,b.length-1);var e=b.forEach(function(i,h,g){var f=i.split("\n");var j=f.splice(0,1);a.copy[j[0]]=f.join("\n")});a.isReady=true;App.eventMapper.trigger("isDictionaryReady")}}(this))}});Em.Object.reopenClass({create:function(a){return this._super().setProperties(a)}});App.KnobController=Em.ObjectController.extend({callDynamicController:function(){console.log(".callDynamicController()")}});App.KnobView=Em.View.extend({templateName:"knob"});if(App.DEBUG){var stats=new Stats();stats.setMode(1);stats.domElement.style.position="absolute";stats.domElement.style.left="0px";stats.domElement.style.top="0px";document.body.appendChild(stats.domElement);setInterval(function(){stats.begin();stats.end()},1000/60)};App.ApplicationController=Em.Controller.extend({className:"App.ApplicationController",currentRoute:null,notifyChange:function(){previousPath:undefined,Ember.run.schedule("afterRender",this,function(){App.eventMapper.trigger("doRoute",{routePath:this.get("currentPath")})});console.log("currentPath",this.get("currentPath"));if(App.transitionView){switch(this.get("previousPath")+">"+this.get("currentPath")){case"dimension2>dimension3":App.transitionView.show();break;default:App.transitionView.hide();break}}this.set("previousPath",this.get("currentPath"))}.observes("currentPath")});App.Dimension1Controller=Em.ObjectController.extend({className:"Dimension1Controller",wpm:0,interactiveGridData:[],init:function(){this._super();console.log("listening interactiveGridText");App.eventMapper.addEventListener("interactiveGridText",this,function(a){return function(b,c){a.set("interactiveGridData",c)}}(this))}});App.Dimension2Controller=Em.ObjectController.extend({className:"Dimension2Controller"});App.Dimension3Controller=Em.ObjectController.extend({className:"Dimension3Controller",isSubtitle:true,doRemoveSubtitle:function(){this.set("isSubtitle",false)}});App.IndexController=Em.Controller.extend({className:"IndexController",test:"testVariable"});App.NavListController=Em.Controller.extend({className:"NavListController",doIndex:function(){window.location.hash=""},doDimension0:function(){window.location.hash=""},doDimension1:function(){window.location.hash="d1"},doDimension2:function(){window.location.hash="d2"},doDimension3:function(){window.location.hash="d3"}});App.register("controller:nav-list",App.NavListController,{singleton:false});App.NavTabsController=Em.Controller.extend({className:"NavTabsController",doIndex:function(){window.location.hash=""},doDimension1:function(){window.location.hash="d1"},doDimension2:function(){window.location.hash="d2"},doDimension3:function(){window.location.hash="d3"}});App.register("controller:nav-tabs",App.NavTabsController,{singleton:false});App.SmartController=Em.ObjectController.extend({label:"App.SmartController",className:"SmartController",autoMappedEvents:[],isViewInserted:false,view_didSetController:function(){},view_didInsertElement:function(a){if(!a){throw"SmartController.view_didInsertElement() did not recieve aview parameter"}var b,c;this.set("view",a);this.set("isViewInserted",true);for(c=0;c<this.autoMappedEvents.length;c++){b=this.autoMappedEvents[c];App.eventMapper.addEventListener(b.type,b.listener,b.callback)}this.send("SmartController_didInsertElement",this,this.label)},view_willDestroyElement:function(){for(var a=0;a<this.autoMappedEvents.length;a++){App.eventMapper.removeEventListener(this.autoMappedEvents[a].type,this.autoMappedEvents[a].listener)}},addAutoMappedEvent:function(a,b,c){Ember.assert('addAutoMappedEvents: "type" not string',(typeof a=="string"));Ember.assert('addAutoMappedEvents: "listener" not string',(typeof b=="object"));Ember.assert('addAutoMappedEvents: "callback" not string',(typeof c=="function"));this.autoMappedEvents.push({type:a,listener:b,callback:c})}});App.register("controller:smart-controller",App.SmartController,{singleton:false});App.Dimension1Model=Em.Object.extend({title:"The first dimension"});App.Dimension2Model=Em.Object.extend({title:"The second dimension"});App.Dimension3Model=Em.Object.extend({title:"The third dimension"});App.HashBtnModel=Em.Object.extend({urlhash:"Model set",label:"Model"});App.ScriptModel=Em.Object.extend({init:function(){var a=function(b){return function(c,d){b.scriptIndex=App.dictionary.copy.INDEX;b.scriptD1=App.dictionary.copy.D1;b.scriptD2=App.dictionary.copy.D2;b.scriptD3=App.dictionary.copy.D3}}(this);if(App.dictionary.isLoaded){a()}else{App.eventMapper.addEventListener("isDictionaryReady",this,a)}return this._super()},scriptIndex:"",scriptD1:"",wpm:false&&999||280,editDelay:false&&120||600,newLineDelay:false&&80||800,progress:0,subtitleText:function(){console.log("computer prop subtitleText");var a=this.get("script").split(" ");return a[Math.round(a.length*this.get("progress"))]}.property("script"),cpms:function(){var a=this.get("wpm")*7;var c=a/60;var b=c/1000;return b}.property("wpm")});App.AppRoute=Em.Route.extend({});App.SmartRoute=Em.Route.extend({label:"smartRoute",ClassName:"SmartRoute",isStarted:false,isStartedObserver:function(a,b){if(b){this.get("events").doDimensionNavHover(false)}}.observes("isStarted"),init:function(){this._super()},activate:function(){this._super();this.set("isStarted",false)},deactivate:function(){this._super();this.set("isStarted",false)},events:{doDimensionNavHover:function(b){var a;if(b){switch(window.location.hash){case"":a="ANI_X";break;case"#d1":a="ANI_XY";break;case"#d2":a="ANI_XYZ";break;case"#d3":a="ANI_XYZ";break}}else{switch(window.location.hash){case"":a="ANI_0";break;case"#d1":a="ANI_X";break;case"#d2":a="ANI_XY";break;case"#d3":a="ANI_XYZ";break}}App.eventMapper.trigger("setRuler",{posStr:a})}},addEvents:function(b){var a=this.get("events");$.extend(a,b);this.set("events",a)}});App.ApplicationView=Ember.View.extend({templateName:"application",el:null,$el:null,didInsertElement:function(){this._super();this.set("el",this.get("element"));this.set("$el",$(this.el))},willDestroyElement:function(){this._super();$(window).unbind("resize.ApplicationView")}});App.Dimension1View=Ember.View.extend({tagName:"div",name:"dimension1",didInsertElement:function(){this._super()}});App.Dimension2View=Ember.View.extend({tagName:"div",templateName:"dimension2",name:"dimension2"});App.IndexView=Ember.View.extend({tagName:"div",didInsertElement:function(){this._super()}});App.NavListView=Em.View.extend({templateName:"nav-list",selectedBinding:"controller.selected",NavListItemView:Ember.View.extend({tagName:"li",classNameBindings:"isActive:active".w(),isActive:function(){return this.get("item")===this.get("parentView.selected")}.property("item","parentView.selected").cacheable()}),didInsertElement:function(){this._super();Foundation.libs.topbar.init()}});App.NavTabsView=Em.View.extend({templateName:"nav-tabs",selectedBinding:"controller.selected",NavItemView:Ember.View.extend({tagName:"li",classNameBindings:"isActive:active".w(),isActive:function(){return this.get("item")===this.get("parentView.selected")}.property("item","parentView.selected").cacheable()})});App.SmartContainerView=Ember.ContainerView.extend({className:"App.SmartContainerView",mappedEvents:[],smartViewObj:null,el:null,$el:null,init:function(){smartViewObj=this;return this._super()},didInsertElement:function(a){if(!a){a=this}this._super(a);this.set("el",this.get("element"));this.set("$el",$(this.el));a.$().addClass(a.templateName);a.get("controller").send("view_didInsertElement",this)},willDestroyElement:function(){this.get("controller").send("view_willDestroyElement",this)}});App.SmartView=Ember.View.extend({className:"App.SmartView",mappedEvents:[],smartViewObj:null,el:null,$el:null,controllerAdded:function(){this.get("controller").send("view_didSetController",this)}.observes("controller"),init:function(){smartViewObj=this;this._super();return this},didInsertElement:function(a){this._super();if(!a){a=this}this.set("el",this.get("element"));this.set("$el",$(this.get("el")));a.$().addClass(a.templateName);a.get("controller").send("view_didInsertElement",this)},willDestroyElement:function(){this._super();this.get("controller").send("view_willDestroyElement",this);this.destroy()},addEventListener:function(b,c){if(this._listeners===undefined){this._listeners={}}var a=this._listeners;if(a[b]===undefined){a[b]=[]}if(a[b].indexOf(c)===-1){a[b].push(c)}},hasEventListener:function(b,c){if(this._listeners===undefined){return false}var a=this._listeners;if(a[b]!==undefined&&a[b].indexOf(c)!==-1){return true}return false},removeEventListener:function(c,d){if(this._listeners===undefined){return}var b=this._listeners;var a=b[c].indexOf(d);if(a!==-1){b[c].splice(a,1)}},dispatchEvent:function(e){if(this._listeners===undefined){return}var d=this._listeners;var a=d[e.type];if(a!==undefined){e.target=this;for(var c=0,b=a.length;c<b;c++){a[c].call(this,e)}}}});App.AudioController=App.SmartController.extend({content:undefined,init:function(){this._super()}});App.Dimension1NavController=App.SmartController.extend({isShowStart:true,isShowEnd:false,label:"Dimension1NavController",view_didInsertElement:function(a){this._super(a);App.eventMapper.addEventListener("sub_isFinish",this,function(b){return function(){b.isShowStart=false;b.isShowEnd=true}}(this))},view_willDestroyElement:function(){App.eventMapper.removeEventListener("sub_isFinish",this)},doStart:function(){App.eventMapper.trigger("dim1Nav_start")}});App.register("controller:dimension1-nav",App.Dimension1NavController,{singleton:false});App.Dimension2NavController=App.SmartController.extend({isShowStart:false,isShowEnd:false,label:"Dimension2NavController",doEnd:function(){App.eventMapper.trigger("dim1Nav_end")}});App.register("controller:dimension2-nav",App.Dimension2NavController,{singleton:false});App.EslEntityContainerController=App.SmartController.extend({view_didInsertElement:function(a){if(!this.get("view")){this._super(a);App.static_eslEntityContainerView=a}else{}},view_eslEntityCreated:function(a){console.log(" view_eslEntityCreated",a);App.eventMapper.trigger("eslViewAddedEsl",{label:a.label,view:a.get("view"),parentEslObj:a.get("view").parentEslObj})}});App.EslEntityController=App.SmartController.extend({label:"esl-entity",className:"EslEntityController",view_eslEntityCreated:function(a){App.eventMapper.addEventListener("w2dE_GetPlans",a,a.override_doGetPlans);App.eventMapper.trigger("eslViewAddedEsl",{label:a.label,view:a.get("view"),parentEslObj:a.get("view").parentEslObj})},view_willDestroyElement:function(){},override_doGetPlans:function(){throw"EslEntityController.override_doGetPlans() is an abstract stub function. Must be overridden without a this._super() call"}});App.register("esl-entity",App.EslEntityController,{singleton:false});App.EslStageController=App.SmartController.extend({pendingEE:[],className:"EslStageController",init:function(){return this._super()},view_didInsertElement:function(a){this.pendingEE=[];App.eventMapper.addEventListener("eslViewAddedEsl",this,this.doEslViewAddedEsl);App.eventMapper.addEventListener("viewRemovedEsl",this,this.doViewRemovedEsl);this._super(a);this.tryProcessPendingEE()},view_willDestroyElement:function(){this._super();App.eventMapper.removeEventListener("eslViewAddedEsl",this);App.eventMapper.removeEventListener("viewRemovedEsl",this);this.pendingEE=[]},doEslViewAddedEsl:function(a,b){this.pendingEE.push(b);this.tryProcessPendingEE()},doViewRemovedEsl:function(a,b){this.pendingEE.filter(function(c){return(b.view!=c.view)})},tryProcessPendingEE:function(){if(this.view){if(!this.view.addEslEnt){throw"EslStageController._processQ() the view ( subclass ) does not implememnt addEslEnt()"}this.pendingEE.forEach(function(a){return function(b,c,d){a.view.addEslEnt(b.label,b.view,b.parentEslObj)}}(this));this.pendingEE=[]}else{throw"tryProcessPendingEE() view not set"}}});App.register("controller:esl-stage",App.EslStageController,{singleton:false});App.Entity3dController=App.SmartController.extend({label:"entity-3d",className:"Entity3dController",view_didInsertElement:function(){}});App.HashBtnController=App.SmartController.extend({className:"HashBtnController",label:undefined,urlhash:undefined,routePath:undefined,view_didInsertElement:function(a){this._super(a);Em.assert('Variable "label" needs to be set on HashBtnController \ne.g. via Handlebars helper:\n\n\t{{controlWithVars \'hash-btn\' hashBtn urlhash="d1" label="Dimension 1" routePath="dimension1"}}',this.label);Em.assert('Variable "urlhash" needs to be set on HashBtnController \ne.g. via Handlebars helper:\n\n\t{{controlWithVars \'hash-btn\' hashBtn urlhash="d1" label="Dimension 1" routePath="dimension1"}}',this.urlhash);Em.assert('Variable "routePath" needs to be set on HashBtnController \ne.g. via Handlebars helper:\n\n\t{{controlWithVars \'hash-btn\' hashBtn urlhash="d1" label="Dimension 1" routePath="dimension1"}}',this.routePath);this.set("label",this.label);this.set("urlhash",this.urlhash);App.eventMapper.addEventListener("doRoute",this,this.doRoute)},doRoute:function(a,b){if(this.routePath==b.routePath){this.get("view").doHide()}else{this.get("view").doShow()}},doNavigate:function(){this.set("label",this.label);this.set("urlhash",this.urlhash);window.location.hash=this.urlhash},view_willDestroyElement:function(){this._super();App.eventMapper.removeEventListener("doRoute",this)}});App.register("controller:hash-btn",App.HashBtnController,{singleton:false});(function(){App.HeartbeatController=App.SmartController.extend({label:"HeartbeatController",timeout:null,totalHeartbeats:0,MAX_HEARTBEATS:20,myView:null,speedFactors:[],createHeartbeat:function(){var e=1000,a=3000,f=0,g=1,d=1000,c=this.speedFactors;App.eventMapper.trigger("heartbeat",{target:this});for(f=0;f<c.length;f++){var b=c[f]();Ember.assert("App.HeartbeatController.createHeartbeat() speedFactor function does not return 0 - 1:"+b,(0<=b&&1>=b))}g=(c.length==0)?1:totalHeartbeats/c.length;d=e+(g*(a-e));if(this.totalHeartbeats<this.MAX_HEARTBEATS){this.totalHeartbeats++;this.timeout=setTimeout(function(h){return function(){h.createHeartbeat(h)}}(this),d)}},view_didInsertElement:function(a){this._super(a);this.myView=a},view_willDestroyElement:function(){if(typeof this.timeout=="number"){clearTimeout(this.timeout)}}})}());App.HeartbeatFlashController=App.SmartController.extend({label:"HeartbeatFlashController",content:undefined,init:function(){this.autoMappedEvents.push({type:"heartbeat",listener:this,callback:this.doHeartbeat});return this._super()},doHeartbeat:function(a,b){this.get("view").doHeartbeat()}});App.IndexNavController=App.SmartController.extend({isShowStart:true,isShowEnd:false,label:"IndexNavController",view_didInsertElement:function(a){this._super(a);console.log("view IndexNavController_didInsertElement");this.send("IndexNavController_didInsertElement",this)},doStart:function(){App.eventMapper.trigger("indNav_start",{target:this})},doEnd:function(){App.eventMapper.trigger("indNav_end",{target:this})}});App.register("controller:index-nav",App.IndexNavController,{singleton:false});App.InteractiveGridController=App.SmartController.extend({plotText:"",plotNumber:"",plotHeading:"",positionText:"",plotClass:"",isPlotX:false,testColour:"red"});App.NavigationController=App.SmartController.extend({className:"NavigationController",view_willDestroyElement:function(a){this._super(a)}});App.register("controller:navigation",App.NavigationController,{singleton:false});App.PreloaderContentController=App.SmartController.extend({isLoaded:false,templateName:"preloader-content",isLoadedList:[],queue:{},view_didInsertElement:function(a){App.PRELOADER=this;this._super(a);this.queue=new createjs.LoadQueue();this.queue.installPlugin(createjs.Sound);this.queue.addEventListener("complete",(function(b){return function(f,e,h,g){b.isLoadedList.push("All done.");b.set("infoHtml",b.isLoadedList.join(" loaded<br/>"));b.isLoaded=true;App.eventMapper.trigger("preloaderIsLoaded",{target:b.queue})}}(this)));this.queue.addEventListener("fileload",(function(b){return function(e){var d=e.item;var c=d.type;b.isLoadedList.push(d.src);b.set("infoHtml",b.isLoadedList.join(" loaded<br/>"));if(c==createjs.LoadQueue.IMAGE){}App.preloadedImages[d.id]=e.result}}(this)));this.queue.loadManifest([{id:"copy",src:"txt/copy.txt"+(App.DEBUG?"?"+Math.random():"")},{id:"face-ash-pixel",src:"img//face-ash-pixel.png"},{id:"face-ash",src:"img//face-ash.png"},{id:"face-user-pixel",src:"img//face-user-pixel.png"},{id:"face-user-pixel-change01",src:"img//face-user-pixel-change01.png"},{id:"face-user-pixel-change02",src:"img//face-user-pixel-change02.png"},{id:"face-user-pixel-change03",src:"img//face-user-pixel-change03.png"},{id:"face-user-pixel",src:"img//face-user-pixel.png"},{id:"question-pixel",src:"img//question-pixel.png"},{id:"question",src:"img//question.png"},{id:"machine-pixel",src:"img//machine-pixel.png"},{id:"cog",src:"img/cog.png"}])},infoHtml:"1st",isLoadedListObserved:function(){console.log("infoHtmlSet");infoHtml=this.isLoadedList.join(", ")}.observes("isLoadedList")});App.RulerController=App.SmartController.extend({label:"RulerController",className:"RulerController",view_didInsertElement:function(a){this._super(a);App.eventMapper.addEventListener("setRuler",this,function(b){return function(c,d){a.setRuler(d)}}(this))},view_willRemoveElement:function(a){this._super(a);App.eventMapper.removeEventListener("setRuler",this)}});App.register("controller:ruler",App.RulerController,{singleton:false});(function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,e){var d=new Date().getTime();var f=Math.max(0,16-(d-b));var g=window.setTimeout(function(){h(d+f)},f);b=d+f;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());App.SubtitleController=App.SmartController.extend({controllerName:"Script Subtitle Controller",label:"SubtitleController",text:"",cursorChar:"&#0178;",atLine:0,atChar:0,atPrintedLine:0,srcLines:[],editList:[],printedLines:[""],isFreezeOnHover:true,counter:0,isHover:false,hoverEvent:undefined,isEdit:false,tagStart:"<p><span>",tagMid:"</span></p><p><span>",tagEnd:"</span></p>",tagCursor:'<i class="icon-italic></i>',isForceFinish:false,isCursor:true,isLooping:false,isInstant:false,tagPositions:[],pendingClosingTags:[],actionTimeouts:[],pendingWait:0,lastPrinted:null,lastEdit:null,isHoverUnfinished:false,isCursorObserver:function(){if(this.get("isCursor")){this.set("tagCursor",'<img src="img/cursor.gif"/>')}else{this.set("tagCursor","")}var a=this.get("printedLines");if(a){this.setText(this.get("printedLines"),null);this.printText()}}.observes("isCursor"),lines:[],isEnded:false,isRemoved:false,hasRemoveButton:false,thescript:"",isRemoveButton:false,raf:null,lastRequestAnimationFrame:0,durSinceReadChar:0,setup:function(g){if(this.get("thescript")){g=this.get("thescript")}g=g.replace(/(\r\n|\n|\r)/gm,"\n");g=g.split("\r\n").join("\n");g=window.unescape(g);if(g.indexOf("@edits=")!=-1){this.set("isEdit",true)}var i=[""],e=g.split("\n"),a=0,b=0,k=0,c=[];for(var f=0;f<e.length;f++){var j;if(j=e[f].indexOf("@edits=")!=-1){var o=e[f].split("@edits="),n=o[1].split(" "),d=n.reverse().pop();n.reverse();e[f]=o[0].concat(n);d=d.split(",");for(var m in d){m=m.split("")}c.push({linePosition:f,charPosition:o[0].length,currentVal:0,atChar:0,currentDirection:1,editVals:d,printed:"",editPause:false,loops:true});f--}}this.set("tagPositions",[]);this.set("editList",c);for(var f=0;f<e.length;f++){e[f]=e[f].split("");if(e[f].length==0){e[f][0]="&nbsp;&nbsp;"}}if(c.length==0){for(var f=0;f<e.length;f++){var h=line=o0=o1=prevo1=0;if(((line=e[f])[0])!="@"){while((o0=line.indexOf("<"))!=-1&&(o1=line.indexOf(">",o0))!=-1){if(false&&prevo1&&prevo1==o0+1){line.splice(prevo1,1)}else{h=""}h+=line.splice(o0,o1-o0).join("");line.splice((prevo1=o0),0,h)}}}}this.setText([""]);this.set("atLine",a);this.set("atChar",b);this.set("atPrintedLine",k);this.set("printedLines",i);this.set("srcLines",e)},view_didInsertElement:function(a){this._super(a);this.send("SubtitleController_didInsertElement",this);this.set("content",App.scriptModel);this.setup()},view_willDestroyElement:function(){var b=this.get("actionTimeouts");for(var a in b){window.clearTimeout(a.id)}this.set("actionTimeouts",[]);this.set("isLooping",false);this.set("isEnded",true);this.doForceFinish();this.setText([""]);this.set("atLine",0);this.set("atChar",0);this.set("atPrintedLine",0);this.set("printedLines",[""]);this.set("srcLines",[])},readChar:function(dur,me,isEvents){var me=me||this,isEvents=(typeof(isEvents)!="undefined")?isEvents:true,srcLines=me.get("srcLines"),editList=me.get("editList"),printedLines=me.get("printedLines"),atLine=me.get("atLine"),atChar=me.get("atChar"),atPrintedLine=me.get("atPrintedLine"),delayChar=1/me.get("content").get("cpms"),delayLine=me.get("content").get("newLineDelay"),delayEditLine=me.get("content").get("editDelay"),isNewLine=false,delay=delayChar,currentEdit,isLastCharBeforeDisplay=false;if(dur>this.get("pendingWait")){dur-=this.get("pendingWait");this.set("pendingWait",0);for(var e=0;e<editList.length;e++){if(editList[e].linePosition==atLine&&editList[e].charPosition==atChar){currentEdit=editList[e]}}if(atLine<srcLines.length){if(currentEdit){if(currentEdit.editPause){delay=delayEditLine}}else{if(atChar>=srcLines[atLine].length){delay=delayLine}}if(dur>delay){dur-=delay;if(atChar==0&&atLine==0){isNewLine=true}else{if(atChar>=srcLines[atLine].length&&!currentEdit){isNewLine=true;atChar=0;atLine++;atPrintedLine++}}if(currentEdit){with(currentEdit){editPause=false;if(currentDirection==1){printed+=editVals[currentVal][atChar];atChar++;if((atChar+1)>editVals[currentVal].length){currentDirection=-1;editPause=true}}else{printed=printed.substring(0,printed.length-1);if(printed.length==0){currentDirection=1;atChar=0;currentVal++;editPause=true;if(currentVal>=editVals.length){currentVal=0}}}}me.set("editList",editList);me.setText(this.get("printedLines"),currentEdit.printed)}else{if(!isNewLine){printedLines[atPrintedLine]+=srcLines[atLine][atChar];me.setText(printedLines,null,"char");atChar++}else{if(isNewLine){while(isEvents&&srcLines[atLine]&&srcLines[atLine][0]&&srcLines[atLine][0]=="@"){var line=srcLines[atLine].join("");if(line.indexOf("@=")==0){this.doTagRead(line,atPrintedLine)}else{if(line.indexOf("@wait=")==0){var pendingWait=parseInt(line.split("=")[1],10);Em.assert("@wait was given non-number value",!isNaN(parseFloat(pendingWait))&&isFinite(pendingWait));this.set("pendingWait",pendingWait)}else{if(line.indexOf("@actionOnRead=")==0){var words=line.split(" ");var action=words[0].split("=")[1];var delay=(words[1]&&!isNaN(parseFloat(words[1]))&&isFinite(words[1]))?parseFloat(words[1]):0;var actionFunc=function(my,myAction,pos){return function(){var actionTOObjs=my.get("actionTimeouts");window.clearTimeout(actionTOObjs[pos].to);actionTOObjs[pos].to=null;my.send(myAction)}}(this,action,this.get("actionTimeouts").length);var to=setTimeout(actionFunc,delay);this.get("actionTimeouts").push({func:actionFunc,to:to})}else{App.eventMapper.trigger(line.split(" ")[1])}}}atLine++}if(atLine<srcLines.length&&srcLines[atLine].length>0){printedLines[atPrintedLine]="";printedLines[atPrintedLine]+=srcLines[atLine][atChar];me.setText(printedLines,null,"newline");atChar++}}}}}else{}}else{me.set("isEnded",true);window.cancelAnimationFrame(me.get("raf"));if(me.get("hasRemoveButton")){me.set("isRemoveButton",true)}App.eventMapper.trigger("sub_finishedReading",{target:this})}}me.set("srcLines",srcLines);me.set("printedLines",printedLines);me.set("atLine",atLine);me.set("atChar",atChar);me.set("atPrintedLine",atPrintedLine);return dur},doEdit:function(b,a){},getTagCodeFromLine:function(a){var b=unescape(a).split("@=");b.splice(0,1);return b[0]},getClosedVersionOfTag:function(b){var a=(b.split(" ")[0]+">").split("");a=a.replace("\t","");a.splice(1,0,"/");return a.join("").replace(">>",">")},getMostRecentOpenTag:function(b){b.reverse();for(var a=0;a<b.length;a++){if(!b[a].isClosed){b.reverse();return b.length-a-1}}b.reverse();return -1},doTagRead:function(a,b){var g=this.get("pendingClosingTags"),f=this.get("tagPositions"),e=this.getTagCodeFromLine(a);if(e.charAt(1)!="/"){var c=f.length;f.push({lineOpened:b,code:e,expectedClosed:this.getClosedVersionOfTag(e),isClosed:false});g.push(f[c].expectedClosed)}else{var d=this.getMostRecentOpenTag(f);f[d].isClosed=true;f[d].lineClosed=b-1;g.pop()}this.set("pendingClosingTags",g);this.set("tagPositions",f)},createTaggedLines:function(f,i,a){var e=this.get("tagPositions"),i=i||"",c=this.get("pendingClosingTags"),j=f.slice(0),h=j.length-1;for(var d=0;d<j.length;d++){if(d==j.length-1){j[d]=this.tagStart+j[d]+" <i>"+i+"</i>"+this.tagCursor+this.tagEnd}else{j[d]=this.tagStart+j[d]+" "+this.tagEnd}}e.reverse();for(var k=0;k<e.length;k++){var m=e[k],b=Math.min(m.lineOpened,h);if(m.lineOpened<=h){j[b]=m.code+j[b]}else{j[b]=j[b]+m.code}if(m.isClosed){var g=Math.min(m.lineClosed,h);j[g]=j[g]+m.expectedClosed}}e.reverse();j[h]=j[h]+c.join("");this.set("tagPositions",e);this.set("pendingClosingTags",c);return j.join("")},doRemoveClicked:function(){window.cancelAnimationFrame(this.get("raf"));this.set("isEnded",true);this.set("isRemoved",true);this.get("view").doRemove();this.setText("")},setText:function(b,a){this.set("lastPrinted",b);this.set("lastEdit",a)},printText:function(){if($(".text",$(this.get("view").get("element")))[0]){$(".text",$(this.get("view").get("element")))[0].innerHTML=this.createTaggedLines(this.get("lastPrinted"),this.get("lastEdit"))}},startReading:function(){if(this.get("isInstant")){this.get("view").doShow();this.doForceFinish()}else{var a=function(c){var b=function(f){var e=c.get("lastRequestAnimationFrame"),d=c.get("durSinceReadChar");d+=(e?f-e:0);c.set("lastRequestAnimationFrame",f);if(!c.get("isHover")||!c.get("isFreezeOnHover")){d=c.reDraw(d,c)}else{d=0}c.set("durSinceReadChar",d);if(!c.get("isEnded")||c.get("isLooping")){c.set("raf",window.requestAnimationFrame(b))}};return b}(this);this.set("raf",window.requestAnimationFrame(a))}},getLinkEvent:function(){this.send(this.get("linkEvent"))},doClicked:function(){if(this.get("linkEvent")){this.send(this.get("linkEvent"))}this.doForceFinish()},doHover:function(a){if(this.get("hoverEvent")){this.send(this.get("hoverEvent"),a)}},reDraw:function(a,b){var c=a;while(c!=(a=b.readChar(a,b))){c=a}this.printText();return a},doForceFinish:function(){this.set("isHoverUnfinished",false);this.set("editList",[]);window.cancelAnimationFrame(this.get("raf"));while(!this.get("isEnded")){this.readChar(99999,this,true)}this.printText()}});App.register("controller:subtitle",App.SubtitleController,{singleton:false});App.TransitionController=App.SmartController.extend({});App.TransitionsHolderController=App.SmartController.extend({init:function(){App.eventMapper.addEventListener("doTransition",this,function(a){return function(b,c){a.doTransition(c.$canvas)}}(this));return this._super()},doTransition:function(a){this.view.doTransition(a)}});App.World2dEditorController=App.SmartController.extend({addCog:function(){App.eventMapper.trigger("w2dE_AddCog")},addPixel:function(){App.eventMapper.trigger("W2dE_addPixel")},getAddedStaticPlans:function(){App.eventMapper.trigger("w2dE_GetPlans")}});App.World3dController=App.SmartController.extend({className:"World3dController",label:"World3dController",isQuestionMarkRotating:false,isQuestionMarkRotatingHint:false,doQuestionMarkRotate:function(){console.log("controller knows it is rotate time");this.set("isQuestionMarkRotating",true)},doRotateQuestionMarkHint:function(){console.log("doQuestionMarkRotateHint");this.set("isQuestionMarkRotatingHint",true)},view_doQuestionMarkRotateDone:function(){this.set("isQuestionMarkRotating",false);this.send("doQuestionMarkRotateDone")}});App.register("controller:world-3d",App.World3dController,{singleton:false});App.Dimension1Route=App.SmartRoute.extend({subtitleController1:null,subtitleController2:null,dimension1NavController:null,activate:function(){this._super();this.addEvents({SubtitleView_InsertViewDone:function(b,a){},SmartController_didInsertElement:function(a,b){switch(b){case"SubtitleController":switch(a.get("orderRead")){case"0":this.subtitleController0=a;break;case"1":this.subtitleController1=a;break;case"2":this.subtitleController2=a;break;case"3":this.subtitleController3=a;break}break;case"Dimension1NavController":this.dimension1NavController=a;break;case"HeartbeatController":this.heartbeatController=a;break;case"ScalarController":this.scalarController=a;break}this.tryStart()},SubtitleController_didInsertElement:function(a,b){},doGotoDimension2:function(){window.location.hash="d2"},doSubtitle2:function(){this.subtitleController1.set("isCursor",false);this.subtitleController2.startReading()},doSubtitle3:function(){this.subtitleController3.startReading()}})},deactivate:function(){this._super();App.eventMapper.removeEventListener("dim1Nav_start",this);App.eventMapper.removeEventListener("dim1Nav_end",this);App.eventMapper.removeEventListener("sub_finishedReading",this);this.subtitleController0=null;this.subtitleController1=null;this.subtitleController2=null;this.subtitleController3=null;this.heartbeatController=null;this.scalarController=null},doStart:function(a,b){this.subtitleController0.set("content",App.scriptModel);this.subtitleController1.set("content",App.scriptModel);this.subtitleController2.set("content",App.scriptModel);this.subtitleController3.set("content",App.scriptModel);this.subtitleController0.setup();this.subtitleController1.setup();this.subtitleController2.setup();this.subtitleController3.setup();this.subtitleController0.startReading();this.subtitleController1.startReading()},model:function(){return(App.dimension1Model)?App.dimension1Model:App.Dimension1Model.create()},setupController:function(a,b){a.set("content",b)},renderTemplate:function(){if((App.PRELOADER)?(App.PRELOADER.isLoaded):false){this.render("dimension1");this.render("nav-list",{outlet:"nav-list"});this.render("dimension1-background",{outlet:"background"})}else{App.eventMapper.addEventListener("preloaderIsLoaded",this,function(a){return function(){a.renderTemplate()}}(this))}},tryStart:function(){if(!this.get("isStarted")&&this.subtitleController0&&this.subtitleController1&&this.subtitleController2&&this.subtitleController3){this.set("isStarted",true);this.doStart()}}});App.Dimension2Route=App.SmartRoute.extend({questionController:null,model:function(){return(App.dimension2Model)?App.dimension2Model:App.Dimension2Model.create()},activate:function(){this._super();this.addEvents({SmartController_didInsertElement:function(a,b){switch(b){case"World2dController":this.world2dController=a;break;case"QuestionController":this.questionController=a;break;case"MachineController":this.machineController=a;break;case"UserController":this.userController=a;break;case"SubtitleController":switch(a.get("orderRead")){case"1":this.subtitleController1=a;break;case"1a":this.subtitleController1a=a;break;case"2":this.subtitleController2=a;break;case"instructionTurnOn":this.instructionTurnOnController=a;break;case"instructionTurnOff":this.instructionTurnOffController=a;break}break;case"Dimension2NavController":this.dimension2NavController=a;default:break}this.tryStart()},SubtitleController_didInsertElement:function(){},doGotoDimension3:function(){window.location.hash="d3"},doShowUser:function(){this.userController.doShowPixelInChildren(1200)},doHideUser:function(){this.userController.doShowPixelOutChildren(1200)},doShowQuestion:function(){this.questionController.doShowPixelInChildren(300)},doShowMachineCogs:function(){this.questionController.doCogOpenAndFadeOut(1200);this.machineController.setInteractive(false)},doShowMachine:function(){this.machineController.doShowLineInChildren(2000)},doInstructionTurnOnController:function(){this.machineController.setInteractive(true);this.instructionTurnOnController.startReading()},doMachineTurnOn:function(){if(!this.isFirstTurnOn){this.isFirstTurnOn=true;this.instructionTurnOnController.doRemoveClicked();this.instructionTurnOffController.startReading()}},doMachineTurnOff:function(){if(!this.isFirstTurnOff){this.isFirstTurnOff=true;this.instructionTurnOffController.doRemoveClicked();this.subtitleController1.set("isCursor",false);this.subtitleController1a.startReading()}},doSubtitle2:function(){this.subtitleController1a.set("isCursor",false);this.subtitleController2.startReading()},doMosaicFinished:function(){}})},deactivate:function(){this._super();this.questionController=null;this.world2dController=null;this.subtitleController1=null;this.subtitleController1a=null;this.subtitleController2=null;this.machineController=null;this.userController=null;this.instructionTurnOnController=null;this.instructionTurnOffController=null},renderTemplate:function(){if(App.PRELOADER.isLoaded){this.render("dimension2");this.render("nav-list",{outlet:"nav-list"})}else{App.eventMapper.addEventListener("preloaderIsLoaded",this,function(a){return function(){a.renderTemplate()}}(this))}},tryStart:function(){if(!this.get("isStarted")&&this.questionController&&this.world2dController&&this.subtitleController1&&this.subtitleController1a&&this.subtitleController2&&this.machineController&&this.userController&&this.instructionTurnOnController&&this.instructionTurnOffController){this.machineController.setTarget(this.userController);this.set("isStarted",true);this.doStart()}},doStart:function(a,b){this.subtitleController1.set("content",App.scriptModel);this.subtitleController1.setup();this.subtitleController1.startReading()}});App.Dimension3Route=App.SmartRoute.extend({activate:function(){this._super();this.addEvents({SmartController_didInsertElement:function(a,b){switch(b){case"World3dController":this.world3dController=a;break;case"SubtitleController":switch(a.get("orderRead")){case"instruction":this.subtitleInstructionController=a;break;case"1":this.subtitle1Controller=a;break;case"2":this.subtitle2Controller=a;break}break;default:break}this.tryStart()},SubtitleController_didInsertElement:function(a,b){},doRotateQuestionMarkHint:function(){this.world3dController.doRotateQuestionMarkHint()},doRotateQuestionMarkInstruction:function(){this.subtitleInstructionController.startReading()},doRotateQuestionMark:function(){this.world3dController.doQuestionMarkRotate()},doQuestionMarkRotateDone:function(){this.subtitleInstructionController.doRemoveClicked();this.subtitle2Controller.startReading()}})},model:function(){return(App.dimension3Model)?App.dimension3Model:App.Dimension3Model.create()},deactivate:function(){this._super();this.world3dController=null;this.subtitle1Controller=null},renderTemplate:function(){if(App.PRELOADER.isLoaded){this.render("dimension3");this.render("nav-list",{outlet:"nav-list"})}else{App.eventMapper.addEventListener("preloaderIsLoaded",this,function(a){return function(){a.renderTemplate()}}(this))}},tryStart:function(){if(!this.get("isStarted")&&this.subtitle1Controller&&this.subtitleInstructionController&&this.subtitle2Controller){this.set("isStarted",true);this.doStart()}},doStart:function(a,b){this.subtitle1Controller.startReading()}});App.IndexRoute=App.SmartRoute.extend({indexNavController:null,subtitleController:null,activate:function(){this._super();this.addEvents({SubtitleController_didInsertElement:function(a,b){if(a.get("readOrder")=="1"){this.subtitleController1=a}if(a.get("readOrder")=="2"){this.subtitleController2=a}if(a.get("readOrder")=="3"){this.subtitleController3=a}if(a.get("readOrder")=="4"){this.subtitleController4=a}this.tryStart()},IndexNavController_didInsertElement:function(a,b){this.indexNavController=a;this.tryStart()},SmartController_didInsertElement:function(a,b){},doGotoDimension1:function(){window.location.hash="d1"},doInstruction:function(){},doSecondSubtitle:function(){this.subtitleController1.set("isCursor",false);this.subtitleController2.startReading();this.subtitleController3.set("isCursor",false);this.subtitleController3.startReading()},doThirdSubtitle:function(){this.subtitleController2.set("isCursor",false);this.subtitleController3.startReading()},doFourthSubtitle:function(){this.subtitleController4.startReading()}});return this},deactivate:function(){App.eventMapper.removeEventListener("indNav_end",this);this.subtitleController1=null;this.subtitleController2=null;this.subtitleController3=null;this.subtitleController4=null},doStart:function(a,b){this.subtitleController1.startReading()},doEnd:function(a,b){if(this.indexNavController){this.indexNavController.set("isShowEnd",false);window.location.hash="d1"}},renderTemplate:function(){if(App.PRELOADER?App.PRELOADER.isLoaded:false){this.render("index");this.render("nav-list",{outlet:"nav-list"})}else{App.eventMapper.addEventListener("preloaderIsLoaded",this,function(a){return function(){a.renderTemplate()}}(this))}},tryStart:function(){if(!this.get("isStarted")&&this.subtitleController1&&this.subtitleController2&&this.subtitleController3&&this.subtitleController4){this.get("isStarted",true);this.doStart()}}});App.AudioView=App.SmartView.extend({tagName:"audio",className:"audio-view",attributeBindings:["src"],autoplay:false,preload:false,src:undefined,isSrcObservedPending:false,didInsertElement:function(){var a=this.get("element");a.addEventListener("canplaythrough",function(){a.removeEventListener("canplaythrough");a.audioLoaded=true},false);if(isSrcObservedPending){this.srcObserved()}},srcObserved:function(){isSrcObservedPending=false;var a=this.get("element");if(a){a.play();setTimeout(function(){a.pause()},0)}else{isSrcObservedPending=true}}.observes("src"),play:function(){this.get("element").play()}});App.Dimension1NavView=App.SmartView.extend({templateName:"dimension1-nav"});App.Dimension2NavView=App.SmartView.extend({templateName:"dimension2-nav"});App.EslEntityContainerView=App.SmartContainerView.extend({templateName:"esl-entity-container"});App.EslEntityView=App.SmartView.extend({eslObj:null,tag:"span",className:"EslEntityView",parentEslObj:null,eslObjSettings:{x:0,y:0,fromController:["x","y"]},override_createEsl:function(){throw"EslEntityView.override_createEsl() is a stub function. Must be overridden without a this._super() call";return null},override_draw:function(a){throw"EslEntityView.override_draw() is a stub function. Must be overridden without a this._super() call"},override_update:function(){throw"EslEntityView.override_update() is a stub function. Must be overridden without a this._super() call"},didInsertElement:function(){this._super();this.initialDraw();this.get("controller").send("view_eslEntityCreated",this.get("controller"));this.dispatchEvent($.extend(new Event("eslObjCreated"),{view:this,eslObj:this.get("eslObj"),parentEslObj:this.parentEslObj}))},initialDraw:function(){var e={},g=this.get("eslObjSettings"),a=this.get("controller"),f=g.fromController,b;for(var c=0,d=f[c];c<f.length;c++){d=f[c];if(typeof a[d]!="undefined"){e[d]=a[d]}}b=$.extend({},g,e);this.set("eslObj",this.override_createEsl(b));if(this.get("parentView").eslObj){this.parentEslObj=this.get("parentView").eslObj}this.override_draw(b)},willDestroyElement:function(){},snap:function(a){return Math.round(a/5)*5}});App.EslStageView=App.SmartView.extend({tagName:"div",className:"EslStageView",test:["t0"],testgs:["gs0"],eslEntities:[],canvas:null,$canvas:null,stage:null,init:function(){this.eslEntities.splice(0,this.eslEntities.length);return this._super()},didInsertElement:function(scope){this.eslEntities=[];with(this){_super();set("$canvasHeroHolder",$(".canvas-hero-holder",get("$el")));get("$canvasHeroHolder").append('<canvas class="esl-stage-canvas canvas-hero">');$canvas=$(".esl-stage-canvas",$el);stage=new createjs.Stage($canvas[0]);stage.enableMouseOver(8);stage.x=0.5;stage.y=0}},addEslEnt:function(b,c,a){if(!a){a=this.stage}this.eslEntities.push(c);a.addChild(c.get("eslObj"))},willDestroyElement:function(){this._super();this.stage.removeAllChildren();this.stage.removeAllEventListeners();this.eslEntities.splice(0,this.eslEntities.length)}});App.Entity3dView=App.SmartView.extend({templateName:"entity-3d",didInsertElement:function(){this._super();this.override_3dCreate()},override_3dCreate:function(){var y=["__XXXXXX","_XXX____","_XX_____","X_______"];for(var m=0;m<y.length;m++){y[m]=y[m].split("")}for(var l=0;l<y.length;l++){}var k=30,z=rows=12,o=k,c=[],A=this.data={},a=App.world3d,h=this.grp=new THREE.Object3D(),q=a.textures.face,w=a.textures.brain=THREE.ImageUtils.loadTexture("img/brain.jpg"),s=a.materials.brain=new THREE.MeshBasicMaterial({map:w}),e=new THREE.MeshLambertMaterial({map:w,transparent:true}),j;for(var x=0;x<5;x++){c.push(s)}for(var t=0;t<(z*z);t++){var q=THREE.ImageUtils.loadTexture("img/face-ash.png");q.offset.x=(t%z)/(z);q.offset.y=(t-(t%z))/(z*z);q.repeat.x=q.repeat.y=1/z;j=new THREE.MeshLambertMaterial({map:q,transparent:true});var n=c.slice();n.splice(4,0,j);var v=new THREE.CubeGeometry(k,k,k,1,1,1);var u=A["cubeBrain"+t]=new THREE.Mesh(v,new THREE.MeshFaceMaterial(n));u.overdraw=false;var g=Math.floor(t/z);u.position.set((o*(t%z))-(o*(z-1)/2),o*(g-(rows-1)/2),0);h.add(u)}var d=new THREE.PointLight(16777215);var f=100;d.position.set(0,0,f);createjs.Tween.get(h.rotation).to({y:Math.PI},1500).wait(1500).to({y:0},1500);h.position.set(k*z/2,k*-z/2,0)},override_3dUpdate:function(){},willDestroyElement:function(){this._super();window.cancelAnimationFrame(this.get("raf"))}});App.HashBtnView=App.SmartView.extend({name:"HashBtn",templateName:"hash-btn",doHide:function(){$("button",this.get("$el")).attr("disabled",true)},doShow:function(){$("button",this.get("$el")).attr("disabled",false)}});App.HeartbeatFlashView=App.SmartView.extend({className:"HeartbeatFlashView",templateName:"heartbeat-flash",doHeartbeat:function(){this.$().removeClass("heartbeat-off");this.$().addClass("heartbeat-on");var a=this;(function(){setTimeout((function(){a.$().removeClass("heartbeat-on");a.$().addClass("heartbeat-off")}),1000)}())}});App.HeartbeatView=App.SmartView.extend({className:"HeartbeatView",templateName:"heartbeat",didInsertElement:function(){this.get("controller").send("view_didInsertElement",this)},doStart:function(){this.$().find(".nav-btn").css("display","none")}});App.IndexNavView=App.SmartView.extend({templateName:"index-nav",init:function(){return this._super()}});App.IGVC={LEGEND:[{colour:"#99CC99",fill:"#669966",cssClass:"graph-plot-tech-portfolio"},{colour:"#CC9999",fill:"#996666",cssClass:"graph-plot-tech-general"},{colour:"#9999CC",fill:"#666699",cssClass:"graph-plot-general"}],TECH_PORTFOLIO:0,TECH_GENERAL:1,GENERAL:2};App.InteractiveGridView=App.SmartView.extend({name:"InteractiveGridView",templateName:"interactive-grid",tagName:"div",grid:[[]],testColor:"#99CC99",LEGEND:[{colour:"#99CC99",fill:"#669966",cssClass:"graph-plot-tech-portfolio",label:"about this site"},{colour:"#CC9999",fill:"#996666",cssClass:"graph-plot-tech-general",label:"about my tech knowledge"},{colour:"#9999CC",fill:"#666699",cssClass:"graph-plot-general",label:"other"}],isDrawGrid:false,plotsPlainText:"",pixW:0,pixH:0,shownPlotIndex:null,didInsertElement:function(){this._super();$(".graph-plot",this.get("$el")).css({opacity:0});this.set("$legend",$(".graph-legend",this.get("$el")));this.set("$graphPosition",$(".graph-position",this.get("$el")));this.set("plots",s=this.setPlotsFromPlainText($(".interactive-grid-values").text()));var b,m=App.BREAKPOINT.WIDTH_2,v=2000,t=this.get("controller").get("pixW")||v,c=this.get("controller").get("pixH")||m,e=m/(2+s.maxX),d=20,k,j,a=this.get("grid"),s=this.get("plots"),r=["#669966","#99CC99"],B=Raphael.animation({}),i,n=$(".position-text",this.get("$el")).css({position:"absolute"}),q=$(".plot-text",this.get("$el")).css({position:"absolute"}),l=this.set("$svgRaphaeljs",$("#svg-raphaeljs",this.get("$el")));this.set("raphaeljs",b=new Raphael("svg-raphaeljs","100%","100%"));$("svg",this.get("$el")).attr({"text-antialiasing":true,width:"100%",xmlns:"http: //www.w3.org/2000/svg",version:"1.1"});b.setViewBox(0,0,m,v,false);var u=function(x,w,h){h=Math.abs(h);if(x>=(w-h)&&x<=(w+h)){return true}return false};var p=b.rect(0,0,300,v).attr({fill:"#666666","stroke-width":0,opacity:0});var g=b.rect(0,0,m,v).attr({"stroke-width":0,fill:"#001133",opacity:0});$(g.node).addClass("grid-zone");this.set("$mouseZone",$(g.node));var A=$("svg",this.get("$el"))[0].createSVGPoint();var z=function(x,h){var w=h.get("$mouseZone");var y=w.parent().offset();A.x=x.pageX-y.left;A.y=x.pageY-y.top;if(!w.parent()[0].getScreenCTM){return A}return A.matrixTransform(w.parent()[0].getScreenCTM().inverse())};var f=b.rect(0,0,3,v).attr({fill:"#595959","stroke-width":0});$(this.get("$el"),g).mousedown(function(h){return function(w){console.log("click",w,w.target)}}(this));var o=function(x,h,w,y){return function(W){var E=z(W,x),Q=E.x,P=E.y,J=Math.floor(Q/t),H=Math.floor(P/c),K,I,X=x.get("prevPlotArea")||[[],[]];x.set("prevPlotArea",X);if(x.get("controller").get("isPlotX")){var G=Math.round(Q/e),F=Math.round(P/d),O=G,Y=[],T="",M="Anything",Z,V,U,D=x.get("shownPlotIndex"),R=m,N=[];for(var S=0;S<s.length;S++){Z=Math.abs(s[S].x-G);if(u(Q,s[S].x*e,15)){N.push(s[S])}}if(N.length>0){var C=N[0],L=C.x,R=C.x*e;if(w.animateWidthTarget!=R){w.animateWidthTarget=R;App.eventMapper.trigger("interactiveGridText",N);$(".graph-info").css({display:"block"});$(".graph-info h3").addClass("highlight");$(".graph-plot",x.get("$el")).css({opacity:1});w.stop().animate({fill:C.type.fill,width:R,opacity:1},300);h.attr({fill:"#FF6347"})}}else{if(w.animateWidthTarget!=-1){$(".graph-info h3").removeClass("highlight");h.attr({fill:"#595959"});w.animateWidthTarget=-1;$(".graph-plot",x.get("$el")).css({opacity:0})}}h.attr({x:Q-h.attr("width")});x.get("controller").set("positionText",O);x.set("positionText",O)}}};$(document).bind("mousemove.InteractiveGridView",o(this,f,p,r));o(this,f,p,r);this.doResize()},setPlotsFromPlainText:function(g){var b=g.split("## "),c=[],a=function(i,h){if(i.x<h.x){return -1}if(i.x>h.x){return 1}return 0},f=0;for(var e=0;e<b.length;e++){var d={};d.xList=b[e].split("\n");d.text=d.xList.splice(0,1)[0];d.x=d.xList.splice(0,1)[0];d.type=App.IGVC.LEGEND[App.IGVC.TECH_PORTFOLIO];while(d.xList.indexOf("")>=0){d.xList.splice(d.xList.indexOf(""),1)}if(d.x==""){d.x=d.xList.length}else{d.x=parseInt(d.x,10)}f=Math.max(d.x,f);c.push(d)}c.maxX=f;return c.sort(a)},willDestroyElement:function(){this._super();$(document).unbind("mousemove.InteractiveGridView");$(window).unbind("resize.InteractiveGridView")},doResize:function(g){var c=App.BREAKPOINT.WIDTH_2;var f=2000;var b=this.get("$svgRaphaeljs").width();var a=d(f,c,b);this.get("$svgRaphaeljs").height(a);function d(i,h,e){return(i/h*e)}}});App.NavigationView=App.SmartView.extend({templateName:"navigation"});App.PreloaderContentView=App.SmartView.extend({templateName:"preloader-content"});App.RulerView=App.SmartView.extend({tagName:"span",className:"ruler-view",ANI_0:0,ANI_X:0.25,ANI_XY:0.5,ANI_XYZ:0.75,didInsertElement:function(){this._super();var j=this.get("$element"),g=$(".x-ruler")[0],d=$(".y-ruler")[0],f=$(".x-ruler-minor")[0],b=$(".y-ruler-minor")[0],e=[g,f],h=[d,b],i=new TimelineMax(),c=$(".x-ruler").css("left"),a=$(".y-ruler").css("bottom");i.add(TweenLite.set(e,{bottom:"-"+a,ease:Strong.easeOut}));i.add(TweenLite.set(h,{left:"-"+c,ease:Strong.easeOut}));i.add(TweenLite.to(e,0.25,{bottom:0,ease:Strong.easeOut}));i.add(TweenLite.to(h,0.25,{left:0,ease:Strong.easeOut}));i.add(TweenLite.to(h,0.25,{left:0,ease:Strong.easeOut}));i.pause();this.set("timeline",i)},setRuler:function(b){var a=this.get("timeline"),c=a.time();a.tweenTo(this[b.posStr])}});App.SubtitleView=App.SmartView.extend({name:"Subtitle",templateName:"subtitle",subtitleText:"Lorum ipsum",tagName:"div",didInsertElement:function(e,d,f){this._super();$(".text",this.get("$el")).hover(function(a){return function(){a.get("controller").set("isHover",true);if(!a.get("controller").get("isEnded")&&!a.get("controller").get("isEdit")){a.get("controller").set("isHoverUnfinished",true)}a.get("controller").send("doHover",true)}}(this),function(a){return function(){a.get("controller").set("isHover",false);a.get("controller").set("isHoverUnfinished",false);a.get("controller").send("doHover",false)}}(this));$(".text",this.get("$el")).on("click","span",function(a){return function(){a.get("controller").send("doClicked")}}(this));if(this.get("controller").get("isInstant")){$(".text",this.get("$el")).addClass("fader fade-out")}return this._super()},doShow:function(){$(".text",this.get("$el")).removeClass("fade-out").addClass("fade-in")},willDestroyElement:function(){this._super();$(".text",this.get("$el")).unbind("mouseenter");$(".text",this.get("$el")).unbind("mouseleave");$(".text",this.get("$el")).unbind("click")},doRemove:function(){this.get("$el").css("display","none")}});App.TransitionView=App.SmartView.extend({className:"TransitionView",templateName:"transition",tagName:"div",$dst:undefined,didInsertElement:function(){this._super();this.$dst=$("canvas.transition-canvas",this.get("$el"));$(window).bind("resize.TransitionView",function(a){return function(){a.doResize()}}(this));this.get("$el").bind("click.TransitionView",function(a){return function(){a.doClick()}}(this));App.transitionView=this;this.doResize()},draw:function(a){var b=this.$dst;var c={width:a.css("width"),height:a.css("height")};b.css(c).attr(c);b[0].getContext("2d").clearRect(0,0,b[0].width,b[0].height);b[0].getContext("2d").drawImage(a[0],0,0)},show:function(){this.get("$el").fadeIn(0)},hide:function(){this.get("$el").fadeOut(1400)},clear:function(){this.$dst[0].getContext("2d").clearRect(0,0,this.$dst[0].width,this.$dst[0].height)},willDestroyElement:function(){this._super();$(window).unbind("resize.TransitionView")},doClick:function(b){var a=this.get("parentView");a.removeObject(this)},doResize:function(f){var a,c,d,b=$(window).width();if(b>App.BREAKPOINT.WIDTH_2){a=App.BREAKPOINT.WIDTH_2;c=App.BREAKPOINT.HEIGHT_2;d="rgba(0, 255, 200, 0.2)"}else{if(b>App.BREAKPOINT.WIDTH_1){a=App.BREAKPOINT.WIDTH_1;c=App.BREAKPOINT.HEIGHT_1;d="rgba(0, 200, 255, 0.2)"}else{a=App.BREAKPOINT.WIDTH_0;c=App.BREAKPOINT.HEIGHT_0;d="rgba(0, 200, 200, 0.2)"}}$(".transition-canvas",this.get("$el")).css({width:a+"px",height:c+"px"})},redraw:function(){}});App.TransitionsHolderView=App.SmartContainerView.extend({className:"TransitionsHolderView",templateName:"transitions-holder",tagName:"div",didInsertElement:function(){this._super()},doTransition:function(a){console.log("doTransition",a);this.pushObject(App.TransitionView.create({controller:App.TransitionController.create(),$canvasSrc:a}))}});App.World2dEditorView=App.SmartView.extend({tagName:"div",didInsertElement:function(){with(this){_super()}}});App.World3dView=App.SmartView.extend({templateName:"world-3d",className:"World3dView",label:"world-3d-view",tag:"canvas",materials:{},textures:{},VS:10,FACE_ASH:"face-ash",FACE_ASH_X:-540,FACE_ASH_Y:270,QUESTION_MARK:"question-mark",QUESTION_MARK_X:-90,QUESTION_MARK_Y:210,is3dCreated:false,isQuestionMarkRotate:false,instanceVarNameArr:["renderer","camera","isControls","controls","cursor3D","mouse2D","pickProjector","ray","rayCaster","scene","lastRequestAnimationFrame","voxelPosition","tmpVec","normalMatrix","tcanvas","ignoreList","pixelObjectList"],instanceVarObj:{},init:function(){this._super();this.set("isControls",false);this.set("scene",null);this.set("renderer",null);this.set("rendererStats",null);this.set("camera",null);this.set("controls",null);this.set("cursor3D",null);this.set("mouse2D",null);this.set("pickProjector",null);this.set("voxelPosition",null);this.set("normalMatrix",null);this.set("tmpVec",null);this.set("ignoreList",[]);this.set("pixelObjectList",{});var b=this.get("instanceVarNameArr"),a=this.get("instanceVarObj");for(var c=0;c<b.length;c++){a[b[c]]=this.get(b[c])}this.set("instanceVarObj",a);return this},observingIsQuestionMarkRotateHint:function(){var d=this.get("instanceVarObj").pixelObjectList[this.QUESTION_MARK];if(this.get("controller.isQuestionMarkRotatingHint")){var a=this.get("instanceVarObj"),c=a.pixelObjectList,b=a.camera,e=c[this.QUESTION_MARK].group.rotation;createjs.Tween.get(e).to({y:Math.PI*0.125},600).call(function(f,g){return function(){console.log("questionMark",g);g.setInteractive(true)}}(this,c[this.QUESTION_MARK]))}}.observes("controller.isQuestionMarkRotatingHint"),observingIsQuestionMarkRotate:function(){var d=this.get("controller.isQuestionMarkRotating"),a=this.get("instanceVarObj"),c=a.pixelObjectList,b=a.camera;if(d&&!this.isQuestionMarkRotate&&b&&c[this.QUESTION_MARK]&&this.el){this.isQuestionMarkRotate=Object.createFromPrototype(ragh.THREE.Dragger,{camera:b,dragged:c[this.QUESTION_MARK].group,el:this.el})}else{if(!d&&this.isQuestionMarkRotate){c[this.QUESTION_MARK]&&c[this.QUESTION_MARK].setInteractive(false);this.isQuestionMarkRotate.destroy();this.isQuestionMarkRotate=false}}}.observes("controller.isQuestionMarkRotating"),observingIs3dCreated:function(a,b){if(b){$(".background-2d-to-3d-ash",this.get("$el")).css("display","none");$(".background-2d-to-3d-question-mark",this.get("$el")).css("display","none")}}.observes("is3dCreated"),didInsertElement:function(){this._super();var instanceVarObj=this.get("instanceVarObj");WIDTH=App.BREAKPOINT.WIDTH_2,HEIGHT=App.BREAKPOINT.HEIGHT_2,VIEW_ANGLE=45,ASPECT=WIDTH/HEIGHT,NEAR=0.1,FAR=10000;App.world3d=this;with(instanceVarObj){this._super();this.set("$canvasHeroHolder",$(".canvas-hero-holder",this.get("$el")));scene=new THREE.Scene();renderer=new THREE.WebGLRenderer({antialias:true,preserveDrawingBuffer:true});this.get("$canvasHeroHolder").append(renderer.domElement);var $canvas=$(renderer.domElement).addClass("world-3d-renderer canvas-hero");this.set("$canvas",$canvas);camera=new THREE.OrthographicCamera(-WIDTH/2,WIDTH/2,HEIGHT/2,-HEIGHT/2,1,5000);camera.position.set(0,0,1000);scene.add(camera);scene.add(new THREE.AmbientLight(3355443).position.copy(new THREE.Vector3(0,0,50)));var directionalLight=new THREE.DirectionalLight(16777215,1);directionalLight.position.set(0,0,1);scene.add(directionalLight);cursor3D=new THREE.Object3D();cursor3D.overdraw=true;ignoreList.push(cursor3D);scene.add(cursor3D);mouse2D=new THREE.Vector3(0,10000,0.5);pickProjector=new THREE.Projector();voxelPosition=new THREE.Vector3();normalMatrix=new THREE.Matrix3();tmpVec=new THREE.Vector3()}setTimeout(function(me,ainstanceVarObj){return function(){var plans=[{imgMap:me.createFromImage(App.PRELOADER.queue.getResult("face-ash-pixel")),x:me.FACE_ASH_X+15,y:me.FACE_ASH_Y+15,label:me.FACE_ASH},{imgMap:me.createFromImage(App.PRELOADER.queue.getResult("question-pixel")),x:me.QUESTION_MARK_X+15,y:me.QUESTION_MARK_Y+15,label:me.QUESTION_MARK}];for(var p=0;p<plans.length;p++){var pixelatedObj=Object.createFromPrototype(CubeGroup,plans[p]),pixelatedObjGroup=pixelatedObj.group;ainstanceVarObj.ignoreList.push(pixelatedObj.rollOverMesh);ainstanceVarObj.scene.add(pixelatedObjGroup);ainstanceVarObj.pixelObjectList[plans[p].label]=pixelatedObj}me.tryStart(ainstanceVarObj)}}(this,instanceVarObj),0);this.get("$canvasHeroHolder").append('<div class="canvas-hero background-2d-to-3d-ash"><div class="bg-ash"></div></div>');this.get("$canvasHeroHolder").append('<div class="canvas-hero background-2d-to-3d-question-mark"><div class="bg-question-mark"></div></div>');this.set("$bg2dto3dAsh",$(".background-2d-to-3d-ash",this.get("$canvasHeroHolder")));this.set("$bg2dto3dAshBg",$(".bg-ash",this.get("$canvasHeroHolder")));this.set("$bg2dto3dQuestionMark",$(".background-2d-to-3d-question-mark",this.get("$canvasHeroHolder")));this.set("$bg2dto3dQuestionMarkBg",$(".bg-question-mark",this.get("$canvasHeroHolder")));this.resize();$canvas.mouseleave(function(me){return function(e){var pixels=me.get("instanceVarObj").pixelObjectList;for(var p=0;p<pixels.length;p++){if(pixels[p].hoverOff()){$canvas.removeClass("interactive")}}}}(this))},tryCreateRenderStats:function(){if(!App.DEBUG){return null}var a=new THREEx.RendererStats();a.domElement.style.position="absolute";a.domElement.style.left="0px";a.domElement.style.bottom="0px";document.body.appendChild(a.domElement);return a},createControls:function(b){var a=new THREE.TrackballControls(b);a.target.set(0,0,0);a.rotateSpeed=1;a.zoomSpeed=1.2;a.panSpeed=0.8;a.noZoom=false;a.noPan=false;a.staticMoving=true;a.dynamicDampingFactor=0;a.keys=[65,83,68];a.addEventListener("change.world3d",function(c){return function(){this.redraw}}(this));return a},tryStart:function(b){if(b.pixelObjectList[this.FACE_ASH]&&b.pixelObjectList[this.QUESTION_MARK]){var a=function(d){var c=function(f){var e=(this.lastRequestAnimationFrame)?f-this.lastRequestAnimationFrame:0;this.lastRequestAnimationFrame=f;d.redraw(e);d.set("raf",window.requestAnimationFrame(c))};return c}(this);this.set("raf",window.requestAnimationFrame(a));this.get("$el").on("mousemove",function(c){return function(d){c.onDocumentMouseMove(d)}}(this));$(window).bind("resize.world3d",function(c){return function(){c.resize()}}(this));this.set("is3dCreated",true);this.resize()}},createFromImage:function(u,j,d,l){var b=new THREE.Object3D(),n=this.get("instanceVarObj");this.get("$el").append('<canvas class="temp">');this.$tcanvas=$("canvas.temp",this.get("$el")).css("display","none");this.tcanvas=this.$tcanvas[0];if(!this.tcanvas.getContext){setTimeout(function(c){return function(){c.createFromImage(u)}}(this),1000)}else{var s=[[[]]],g=u.width,p=u.height,a,r=this.tcanvas,m=r.getContext("2d"),q,k;m.drawImage(u,0,0);q=m.getImageData(0,0,g,p);k=q.data;for(var o=0;o<k.length;o+=4){a=o/4;if(k[o+3]==255){var f=a%g;var e=Math.floor(a/g);if(!s[f]){s[f]=[]}if(!s[f][e]){s[f][e]=[]}var t=(65536*k[o+0]+256*k[o+1]+k[o+2]).toString(16);s[f][e][0]={color:"#"+t}}}this.$tcanvas=this.tcanvas=null;$("canvas",this.get("$el")).remove(".temp");return s}},onDocumentMouseMove:function(d){var b=this.get("instanceVarObj");var i=$("body").offset().left;var g=$("body").offset().top;mouseX=d.pageX-i;mouseY=d.pageY-g;var c=App.BREAKPOINT.WIDTH_2/this.w;var f=$(".world-3d-renderer",this.get("$el")).offset();var a=mouseX-f.left;var h=mouseY-f.top;b.mouse2D.x=c*(a-this.w/2);b.mouse2D.y=c*(-h+this.h/2)},onDocumentMouseDown:function(event){with(this){event.preventDefault();var intersects=ray.intersectObjects(questionGroup.children,true);console.log("intersects",intersects);if(intersects.length>0){intersector=testIsIgnored(intersects);if(false){if(intersector.object!=plane){scene.remove(intersector.object)}}else{intersector=testIsIgnored(intersects);if(intersector){this.questionVoxelGroup.tryAddHere(intersector)}}}}},resize:function(){var $canvas=$(this.get("instanceVarObj").renderer.domElement),w,h,bp=App.BREAKPOINT,W=bp.WIDTH_2,H=bp.HEIGHT_2,canvasHeroClass,canvasHeroHolderClass,tmpwinWidth=this.tmpwinWidth=$(window).width(),tmpwinHeight=this.tmpwinHeight=$(window).height();if(tmpwinWidth>bp.WIDTH_2&&tmpwinHeight>bp.HEIGHT_2){w=bp.WIDTH_2;h=bp.HEIGHT_2;canvasHeroClass="canvas-hero";canvasHeroHolderClass="canvas-hero-holder"}else{if(tmpwinWidth>bp.WIDTH_1&&tmpwinHeight>bp.HEIGHT_1){w=bp.WIDTH_1;h=bp.HEIGHT_1;canvasHeroClass="canvas-hero-med";canvasHeroHolderClass="canvas-hero-holder-med"}else{w=bp.WIDTH_0;h=bp.HEIGHT_0;canvasHeroClass="canvas-hero-small";canvasHeroHolderClass="canvas-hero-holder-small"}}this.w=w;this.h=h;if(this.get("is3dCreated")){$canvas.removeClass("canvas-hero canvas-hero-med canvas-hero-small");$canvas.addClass(canvasHeroClass);$canvas.parent().removeClass("canvas-hero-holder canvas-hero-holder-med canvas-hero-holder-small");$canvas.parent().addClass(canvasHeroHolderClass);with(this.get("instanceVarObj")){renderer.setSize(w,h);camera.left=-W/2;camera.right=W/2;camera.top=H/2;camera.bottom=-H/2;camera.position.set(0,0,1000);camera.updateProjectionMatrix();if(isControls){controls.handleResize()}}}else{this.get("$bg2dto3dAsh").css({"margin-left":Math.round(this.FACE_ASH_X*(w/W))+"px ","margin-top":Math.round((270-this.FACE_ASH_Y)*(h/H))+"px"});this.get("$bg2dto3dAshBg").css({"background-size":Math.round(100*w/W)+"%"});this.get("$bg2dto3dQuestionMark").css({"margin-left":Math.round(this.QUESTION_MARK_X*(w/W))+"px ","margin-top":Math.round((270-this.QUESTION_MARK_Y)*(h/H))+"px"});this.get("$bg2dto3dQuestionMarkBg").css({"background-size":Math.round(100*w/W)+"%"})}},redraw:function(dur){var instanceVarObj=this.get("instanceVarObj");if(this.isQuestionMarkRotate&&this.isQuestionMarkRotate.dragged&&this.isQuestionMarkRotate.dragged.rotation){var a180=1*Math.PI,a360=2*Math.PI,tolerance=0.01,targetRot=2*Math.PI*0.75,targetDif=this.isQuestionMarkRotate.dragged.rotation.y-targetRot;while(targetDif<-a180){targetDif+=a360}while(targetDif>a180){targetDif-=a360}targetDif=Math.round(1000*targetDif)/1000;if(Math.min(tolerance,targetDif)==tolerance){this.isQuestionMarkRotate.animate()}else{this.isQuestionMarkRotate.dragged.rotation.y=targetRot;this.get("controller").send("view_doQuestionMarkRotateDone")}}with(instanceVarObj){cursor3D.position.x=mouse2D.x;cursor3D.position.y=mouse2D.y;var rayTouches,touched,pixelGroup;var amouse2D=mouse2D.clone();amouse2D.x=2*amouse2D.x/App.BREAKPOINT.WIDTH_2;amouse2D.y=2*amouse2D.y/App.BREAKPOINT.HEIGHT_2;ray=pickProjector.pickingRay(amouse2D.clone(),camera);var isAtLeastOneHover=false;for(var i in pixelObjectList){pixelGroup=pixelObjectList[i];rayTouches=ray.intersectObjects(pixelGroup.group.children,true,[]);if(touched=this.testIsIgnored(rayTouches)){pixelGroup.show(touched);pixelGroup.hoverOn();isAtLeastOneHover=pixelGroup.getInteractive()}else{pixelGroup.hoverOff();if(i==0){console.log("didnt touch")}}}if(isAtLeastOneHover&&!this.get("$el").hasClass("interactive")){this.get("$el").addClass("interactive")}else{if(!isAtLeastOneHover&&this.get("$el").hasClass("interactive")){this.get("$el").removeClass("interactive")}}renderer.render(scene,camera);if(isControls){controls.update()}if(App.DEBUG){rendererStats.update(renderer)}}},testIsIgnored:function(c){var b=false,a;for(var d=0;d<c.length;d++){a=c[d];if(this.ignoreList.indexOf(a.object)==-1){return a}}return null},setVoxelPosition:function(ime,aintersector){with(ime){normalMatrix.getNormalMatrix(aintersector.object.matrixWorld);tmpVec.copy(aintersector.face.normal);tmpVec.applyMatrix3(normalMatrix).normalize();voxelPosition.addVectors(aintersector.point,tmpVec);voxelPosition.x=Math.floor(voxelPosition.x/this.VS)*this.VS+this.VS/2;voxelPosition.y=Math.floor(voxelPosition.y/this.VS)*this.VS+this.VS/2;voxelPosition.z=Math.floor(voxelPosition.z/this.VS)*this.VS+this.VS/2;return voxelPosition}},addE3d:function(a){this.scene.add(a)},willDestroyElement:function(){console.log("willDestroyElement 1",this.get("instanceVarObj"));var instanceVarObj=this.get("instanceVarObj");App.world3d=null;console.log("willDestroyElement 2");with(instanceVarObj){console.log("scene",scene);for(var pg=0;pg<pixelObjectList.length;pg++){pixelObjectList[pg].cleanUp();scene.remove(pixelObjectList[pg].group)}for(var sc=0;sc<scene.__objects.length;sc++){var obj=scene.__objects.length;scene.remove(obj);if(obj.geometry){obj.geometry.dispose()}if(obj.material){if(obj.material instanceof THREE.MeshFaceMaterial){$.each(obj.material.materials,function(idx,obj){obj.dispose()})}else{obj.material.dispose()}}if(obj.dispose){obj.dispose()}}}for(var i=0;i<instanceVarObj.length;i++){this.set(instanceVarObj[i],null)}this.set("instanceVarObj",null);window.cancelAnimationFrame(this.get("raf"));this.set("raf",null);this.get("$el").unbind("mousemove");$(window).unbind("resize.world3d")}});App.HeartbeatSoundController=App.AudioController.extend({label:"HeartbeatSoundController",content:undefined,init:function(){this._super();this.addAutoMappedEvent("heartbeat",this,this.doHeartbeat)},destroy:function(){App.eventMapper.removeEventListener("heartbeat",this);return this._super().destroy()},view_didInsertElement:function(a){this.set("view",a)},doHeartbeat:function(a,b){this.get("view").doHeartbeat()}});App.CogController=App.EslEntityController.extend({label:"cog",className:"CogController",view_didInsertElement:function(a){this._super(a);App.eventMapper.addEventListener("w2dE_GetPlans",this,this.doGetPlans)},doGetPlans:function(){console.log('{{ renderWithVars "'+this.label+'" "'+this.label.camelize()+'" x="'+this.get("view").eslObj.x+'" y="'+this.get("view").eslObj.y+'"}}')}});App.PersonController=App.EslEntityController.extend({className:"PersonController"});App.PixelController=App.EslEntityController.extend({label:"pixel",className:"PixelController",override_doGetPlans:function(){var a=this.get("view").handle;var b=this.get("view").shp;console.log('{{ controlWithVars "'+this.label+'" '+this.label.split("-").join("")+" x="+a.x+" y="+a.y+" width="+b.width+" height="+b.height+"}}")}});App.register("controller:pixel",App.PixelController,{singleton:false});App.ScalarController=App.EslEntityController.extend({label:"ScalarController",className:"ScalarController",startDrawing:function(){this.view.startDrawing()}});App.register("controller:scalar",App.ScalarController,{singleton:false});App.TemplatedPixelGroupController=App.EslEntityController.extend({className:"TemplatedPixelGroupController",label:"TemplatedPixelGroupController",pixels:[],view_didInsertElement:function(a){this._super(a);this.set("pixels",[])},view_willDestroyElement:function(a){this._super(a);this.set("pixels",null)},CoggedPixelControllerCreated:function(a){var b=this.get("pixels");b.push(a);this.set("pixels",b);this.get("view").addPixel(a)},CoggedPixelControllerDestroyed:function(a){var b=this.get("pixels");b.splice(b.indexOf(a),1);this.set("pixels",b);this.get("view").removePixel(a)},setVisible:function(a){this.get("view").doShowPixelInChildren()},doShowPixelInChildren:function(a){this.get("view").doShowPixelChildrenTo(true,a)},doShowPixelOutChildren:function(a){this.get("view").doShowPixelChildrenTo(false,a)},doShowLineInChildren:function(a){this.get("view").doShowLineInChildren(a)},createPixel:function(){},doCogOpen:function(a){var e=[],g=this.get("pixels"),d=a/g.length;for(var b=0;b<g.length;b++){e.push(b)}e.sort(function(){return 0.5-Math.random()});for(var f=0;f<g.length;f++){var b=e[f];setTimeout(function(h,c){return function(){g[c].doOpen()}}(this,b),d*f)}},doCogOpenAndFadeOut:function(a){var e=[],g=this.get("pixels"),d=a/g.length;for(var b=0;b<g.length;b++){e.push(b)}e.sort(function(){return 0.5-Math.random()});for(var f=0;f<g.length;f++){var b=e[f];setTimeout(function(h,c){return function(){g[c].doOpenAndFadeOut()}}(this,b),d*f)}}});App.register("controller:templated-pixel-group",App.TemplatedPixelGroupController,{singleton:false});App.ActiveEslStageController=App.EslStageController.extend({className:"ActiveEslStageController",view_willDestroyElement:function(){this._super()}});App.register("controller:active-esl-stage",App.ActiveEslStageController,{singleton:false});App.HeartbeatSoundView=App.AudioView.extend({name:"Heartbeat Sound View",templateName:"heartbeat-sound",src:"sound/heartbeat.wav",didInsertElement:function(){this.get("controller").set("view",this)},doHeartbeat:function(){this.play();k}});App.CogView=App.EslEntityView.extend({templateName:"cog",className:"CogView",cog:null,dragger:null,override_createEsl:function(){this.cog=new createjs.Bitmap("img/cog.png");this.cog.image.onload=(function(a){return function(){a.cog.isImgLoaded=true;a.override_draw()}}(this));this.dragger=new createjs.Container();this.dragger.addChild(this.cog);this.dragger.addEventListener("mousedown",(function(a){return function(b){var c={x:b.target.x-b.stageX,y:b.target.y-b.stageY};b.addEventListener("mousemove",function(d){d.target.x=a.snap(d.stageX+c.x);d.target.y=a.snap(d.stageY+c.y)})}}(this)));return this.dragger},override_draw:function(b){var a=b?b:this.get("eslObj");Em.assert("CogView.override_draw(): function called before eslObj was created ",this.get("eslObj"));if(this.cog.isImgLoaded){this.cog.regX=this.cog.image.width/2;this.cog.regY=this.cog.image.height/2}this.cog.scaleX=this.cog.scaleY=0.08;if(a.x){this.dragger.x=Number(a.x)}if(a.y){this.dragger.y=Number(a.y)}return this.dragger},override_reDraw:function(){},willDestroyElement:function(){this._super();this.cog=this.dragger=null}});App.PersonView=App.EslEntityView.extend({});App.PixelView=App.EslEntityView.extend({label:"pixel",shp:null,handle:null,eslObjSettings:{width:30,height:30,x:0,y:0,fromController:["x","y","width","height","col"]},override_createEsl:function(){var b,a;this.set("shp",b=new createjs.Shape());this.set("handle",a=new createjs.Container());a.addChild(b);a.addEventListener("mousedown",(function(c){return function(d){var e={x:d.target.x-d.stageX,y:d.target.y-d.stageY};d.addEventListener("mousemove",function(f){f.target.x=c.snap(f.stageX+e.x);f.target.y=c.snap(f.stageY+e.y)})}}(this)));return a},override_draw:function(c){Em.assert("App.PixelView.draw(): method can't run without eslObj being created. eslObj = "+this.get("eslObj"),this.get("eslObj"));Em.assert("App.PixelView.draw(): method can't run without handle being created. handle = "+this.handle,this.handle);Em.assert("App.PixelView.draw(): method can't run without shp being created. shp = "+this.shp,this.shp);var b=c?c:this.get("eslObj"),e=this.get("shp"),d=this.get("handle"),a=c.col||"#FFFFFF";b.x=Number(b.x);b.y=Number(b.y);Em.assert('App.PixelView.draw(): value of x in eslObj is not of type "number"',!isNaN(b.x));Em.assert('App.PixelView.draw(): value of y in eslObj is not of type "number"',!isNaN(b.y));Em.assert('App.PixelView.draw(): value of width in eslObj is not of type "number" '+b.width,!isNaN(b.width));Em.assert('App.PixelView.draw(): value of height in eslObj is not of type "number" '+b.height,!isNaN(b.height));e.regX=b.width/2;e.regY=b.height/2;e.width=b.width;e.height=b.height;e.graphics.clear();e.graphics.beginFill(a);e.graphics.drawRect(0,0,e.width,e.height);d.x=Number(b.x);d.y=Number(b.y);this.set("handle",d);this.set("shp",e)},override_reDraw:function(){}});App.ScalarView=App.EslEntityView.extend({tagName:"span",templateName:"scalar",eslObjSettings:null,drawInstructions:null,eslObjSettings:{},drawInstructions:{},init:function(){this.set("drawInstructions",{isMirrored:true,axis:{step:10,count:0},smallMarks:{step:5,unit:5,count:0,markHeights:[1,1,2,2,3,3,4]},bigMarks:{step:5,unit:50,count:0,markHeights:[5,6,8,10]}});this.set("eslObjSettings",{width:2400,height:320,x:0,y:0,fromController:["x","y","width","height"]});this.set("value",Number(this.get("eslObjSettings").width)/2);return this._super()},startDrawing:function(){},override_createEsl:function(){this.set("container",this.container=new createjs.Container());this.set("shp",this.shp=new createjs.Shape());this.container.addChild(this.shp);return this.container},resize:function(){},override_draw:function(c){var b=c?c:this.get("eslObj"),a=this.get("container"),d=this.get("shp");b.x=Number(b.x);b.y=Number(b.y);Em.assert('App.ScalarView.override_draw(): value of x in eslObj is not of type "number"',!isNaN(b.x));Em.assert('App.ScalarView.override_draw(): value of y in eslObj is not of type "number"',!isNaN(b.y));Em.assert('App.ScalarView.override_draw(): value of width in eslObj is not of type "number" '+b.width,!isNaN(b.width));Em.assert('App.ScalarView.override_draw(): value of height in eslObj is not of type "number" '+b.height,!isNaN(b.height));d.width=b.width;d.height=b.height;d.x=0.5;a.regX=d.width/2;a.regY=-d.height/2;a.x=Number(b.x);a.y=Number(b.y);return d},override_reDraw:function(){var drawInstructions=this.get("drawInstructions"),shp=this.get("shp"),value=this.get("value"),offset=(drawInstructions.isMirrored)?shp.width/2:0;if(drawInstructions){shp.graphics.beginStroke("#666").setStrokeStyle(1);if(drawInstructions.axis){with(drawInstructions.axis){if(count*step<this.get("value")){if(drawInstructions.isMirrored){shp.graphics.moveTo(offset-(count)*step,0).lineTo(offset-(count+1)*step,0)}shp.graphics.moveTo(offset+(count)*step,0).lineTo(offset+(count+1)*step,0);count++}else{drawInstructions.axis=null}}}if(drawInstructions.smallMarks){with(drawInstructions.smallMarks){if(count*step<this.get("value")){for(var s=0;s<markHeights.length&&count-s>=0;s++){if(drawInstructions.isMirrored){shp.graphics.moveTo(offset-(count-s)*unit,markHeights[s]).lineTo(offset-(count-s)*unit,-markHeights[s])}shp.graphics.moveTo(offset+(count-s)*unit,markHeights[s]).lineTo(offset+(count-s)*unit,-markHeights[s])}count++}else{drawInstructions.smallMarks=null}}}if(drawInstructions.bigMarks){with(drawInstructions.bigMarks){if(count*step<this.get("value")){if(((count*step)%unit)==0){for(var s=0;s<markHeights.length&&(count*step-s*unit)>=0;s++){if(drawInstructions.isMirrored){shp.graphics.moveTo(offset-(count*step-s*unit),markHeights[s]).lineTo(offset-(count*step-s*unit),-markHeights[s])}shp.graphics.moveTo(offset+(count*step-s*unit),markHeights[s]).lineTo(offset+(count*step-s*unit),-markHeights[s])}}count++}else{drawInstructions=null}}}shp.graphics.endStroke()}}});App.TemplatedPixelGroupView=App.EslEntityView.extend({templateName:"templated-pixel-group",className:"TemplatedPixelGroupView",label:"templated-pixel-group",pixelHash:{},addPixel:function(c){var d=this.get("pixelHash"),b=String(c.x),a=String(c.y);if(!d[b]){d[b]={}}d[b][a]=c;this.set("pixelhash",d)},removePixel:function(c){var d=this.get("pixelHash"),b=String(c.x),a=String(c.y);coordArr=d[b][a];coordArr.splice(coordArr.indexOf(c),1);this.set("pixelhash",d)},shp:null,handle:null,imgPreloadId:"question-pixel",eslObjSettings:{width:App.PIXEL_SIZE,height:App.PIXEL_SIZE,x:0,y:0,fromController:["x","y","width","height","visible"]},didInsertElement:function(){this._super();var b=App.preloadedImages[this.get("imgPreloadId")],d="\n"+this.get("imgPreloadId")+"\n";if(b){var a=function(e){return function(m,l,k,h,g,f,n){var i=(-15+(m+2)*App.PIXEL_SIZE),j=(240+(0.5-f+l)*App.PIXEL_SIZE);d+='{{controlWithVars "cogged-pixel" cogged-pixel x='+i+" y="+j+" height="+App.PIXEL_SIZE+" width="+App.PIXEL_SIZE+' col="'+h.color+'"}}\n';h.x2d=i;h.y2d=j}}(this),c=function(e){return function(f){}}(this);ragh.createJsonMapFromImage(b,a,c)}},doShowPixelChildrenTo:function(a,b){var f=this.get("handle");f.visible=true;var g=[],i=f.children,e=b/i.length;for(var d=0;d<i.length;d++){g.push(d)}g.sort(function(){return 0.5-Math.random()});for(var h=0;h<f.children.length;h++){var d=g[h];f.children[d].visible=!a;setTimeout(function(k,c,j){return function(){k.handle.children[c].visible=j}}(this,d,a),e*h)}},doShowLineInChildren:function(b){var i=this.get("eslObj"),l=this.get("shp"),h=[],f=this.handle.children,a=0,e=0,g,d;i.visible=true;for(var k=0;k<f.length;k++){a=Math.max(f[k].y,a);e=Math.min(f[k].y,e)}a=a/App.PIXEL_SIZE;e=e/App.PIXEL_SIZE;g=Math.abs(a-e);d=b/g;for(var k=0;k<f.length;k++){var j=f[k];j.visible=false;setTimeout(function(c,m){return function(){m.visible=true}}(this,j),d*Math.abs(a-j.y/App.PIXEL_SIZE))}},override_createEsl:function(){var b,a;this.set("shp",b=new createjs.Shape());this.set("handle",a=new createjs.Container());a.addChild(b);a.addEventListener("mousedown",(function(c){return function(d){var e={x:d.target.x-d.stageX,y:d.target.y-d.stageY};d.addEventListener("mousemove",function(f){f.target.x=c.snap(f.stageX+e.x);f.target.y=c.snap(f.stageY+e.y)})}}(this)));return a},override_draw:function(b){Em.assert("App.PixelView.draw(): method can't run without eslObj being created. eslObj = "+this.get("eslObj"),this.get("eslObj"));Em.assert("App.PixelView.draw(): method can't run without handle being created. handle = "+this.handle,this.handle);Em.assert("App.PixelView.draw(): method can't run without shp being created. shp = "+this.shp,this.shp);var a=b?b:this.get("eslObj"),d=this.get("shp"),c=this.get("handle");a.x=Number(a.x);a.y=Number(a.y);Em.assert('App.PixelView.draw(): value of x in eslObj is not of type "number"',!isNaN(a.x));Em.assert('App.PixelView.draw(): value of y in eslObj is not of type "number"',!isNaN(a.y));Em.assert('App.PixelView.draw(): value of width in eslObj is not of type "number" '+a.width,!isNaN(a.width));Em.assert('App.PixelView.draw(): value of height in eslObj is not of type "number" '+a.height,!isNaN(a.height));d.regX=a.width/2;d.regY=a.height/2;d.width=a.width;d.height=a.height;d.graphics.clear();if(App.DEBUG){d.graphics.beginFill("#FF0000");d.graphics.drawRect(0,0,d.width,d.height)}c.x=Number(a.x);c.y=Number(a.y);c.visible=a.visible;this.set("handle",c);this.set("shp",d)},override_reDraw:function(){}});App.ActiveEslStageView=App.EslStageView.extend({tagName:"div",className:"ActiveEslStageView",templateName:"active-esl-stage-view",trails:0,tmpbgColor:null,tmpwinWidth:null,raf:null,isAnimating:false,didInsertElement:function(){this._super();$(window).resize(function(b){return function(){b.resize()}}(this));isAnimating=true;var a=function(c){var b=function(e){var d=(c.get("lastRequestAnimationFrame"))?e-c.get("lastRequestAnimationFrame"):0;c.set("lastRequestAnimationFrame",e);c.reDraw(d);c.set("raf",window.requestAnimationFrame(b))};c.stage.update();return b}(this);this.set("raf",window.requestAnimationFrame(a));this.reDraw()},resize:function(){this.tmpwinWidth=$(window).width();with(this){}},reDraw:function(dur){with(this){for(var i=0;i<eslEntities.length;i++){if(eslEntities[i].override_reDraw){eslEntities[i].override_reDraw(dur)}}stage.x=-1+$canvas.attr("width")/2;stage.update()}},willDestroyElement:function(){this._super();window.cancelAnimationFrame(this.get("raf"))}});App.register("view:active-esl-stage",App.ActiveEslStageView,{singleton:false});App.AshController=App.EslEntityController.extend({className:"AshController",label:"ash"});App.register("controller:ash",App.AshController,{singleton:false});App.CoggedPixelView=App.PixelView.extend({cogView:null,label:"cogged-pixel",className:"CoggedPixelView",init:function(){this._super()},eslObjSettings:{width:30,height:30,x:0,y:0,fromController:["x","y","width","height","col"]},override_createEsl:function(){this.handle=this._super();var a=App.CogView.create({controller:App.CogController.create()});App.static_eslEntityContainerView.pushObject(a);a.addEventListener("eslObjCreated",(function(b){return function(c){b.addCogEsl(c)}}(this)),false);return this.handle},addCogEsl:function(a){this.e_cog=a.eslObj;this.e_cog.x=this.e_cog.y=0;this.handle.addChildAt(this.e_cog)},override_draw:function(a){this._super(a)},override_reDraw:function(){},doOpen:function(){(function(c){var d={},b={},e=ragh.one(["x","y"]),a=ragh.one([1,-1])*c.shp.width*0.8;d[e]=c.shp[e];b[e]=a;window.createjs.Tween.get(c.shp).to(b,750).wait(2000).to(d,750)}(this));(function(c){var d={},b={},e="rotation",a=ragh.one([1,-1])*20*2*Math.PI;d[e]=c.shp[e];b[e]=a;window.createjs.Tween.get(c.e_cog).to(b,750).wait(2000).to(d,750)}(this))},doOpenAndFadeOut:function(){(function(c){var d={},b={},e=ragh.one(["x","y"]),a=ragh.one([1,-1])*c.shp.width*0.8;d[e]=c.shp[e];b[e]=a;d.alpha=1;b.alpha=0;window.createjs.Tween.get(c.shp).to(b,750).wait(2000)}(this));(function(d){var e={},c={},b={},f="rotation",a=ragh.one([1,-1])*20*2*Math.PI;e[f]=d.shp[f];c[f]=a;b.alpha=0;b[f]=a*2;window.createjs.Tween.get(d.e_cog).to(c,1500).to(b,1500)}(this))}});App.ClickAndDragScalarController=App.ScalarController.extend({label:"ClickAndDragScalarController",className:"ClickAndDragScalarController"});App.register("controller:click-and-drag-scalar",App.ClickAndDragScalarController,{singleton:false});App.ScalarValueController=App.ScalarController.extend({label:"ScalarValueController",className:"ScalarValueController"});App.register("controller:scalar-value",App.ScalarValueController,{singleton:false});App.MachineController=App.TemplatedPixelGroupController.extend({className:"MachineController",label:"MachineController",targetController:null,isOn:false,isInteractive:false,coggedPixelCreatedFunc:null,CoggedPixelControllerCreated:function(b){this._super(b);var c=b.get("view"),a=this.get("coggedPixelCreatedFunc");if(!a){a=function(d){return function(f){d.get("view").trySetPowerLed(f.eslObj,f.view.get("shp"));d.get("view").trySetActivityLed(f.eslObj,f.view.get("shp"))}}(this);this.set("coggedPixelCreatedFunc",a)}c.addEventListener("eslObjCreated",a,false);this.set("coggedPixelCreatedFunc",a)},view_willDestroyElement:function(){this._super();var c=this.get("pixels"),a=this.get("coggedPixelCreatedFunc");for(var b=0;b<c.length;b++){c[b].removeEventListener("eslObjCreated",a)}this.set("isOn",false);this.set("isInteractive",false);this.set("targetController",null)},setTarget:function(a){this.set("targetController",a)},setInteractive:function(a){if(!a){this.set("isOn",false)}if(a!=this.get("isInteractive")){this.set("isInteractive",a)}},togglePower:function(){this.set("isOn",!this.get("isOn"));if(this.get("isOn")){this.send("doMachineTurnOn")}else{this.send("doMachineTurnOff")}},doActivateTarget:function(){var a=this.get("targetController");a&&a.doActivate&&a.doActivate()}});App.register("controller:machine",App.MachineController,{singleton:false});App.QuestionController=App.TemplatedPixelGroupController.extend({className:"QuestionController",label:"QuestionController"});App.register("controller:question",App.QuestionController,{singleton:false});App.UserController=App.TemplatedPixelGroupController.extend({className:"UserController",label:"UserController",doActivate:function(){this.get("view").doActivate()}});App.register("controller:user",App.UserController,{singleton:false});App.World1dController=App.ActiveEslStageController.extend({label:"World1Controller",lineEE:null,className:"World1Controller"});App.register("controller:world1d",App.World1dController,{singleton:false});App.World2dController=App.ActiveEslStageController.extend({label:"World2dController",className:"World2dController",init:function(){App.eventMapper.addEventListener("w2dE_AddCog",this,this.doW2dE_AddCog);App.eventMapper.addEventListener("W2dE_addPixel",this,this.doW2dE_addPixel);return this._super()},doW2dE_AddCog:function(a,b){this.get("view").addCog()},doW2dE_addPixel:function(a,b){this.get("view").addPixel()},view_willDestroyElement:function(){this._super();App.eventMapper.removeEventListener("w2dE_AddCog",this);App.eventMapper.removeEventListener("W2dE_addPixel",this)},addQuestionMark:function(){this.get("view").addQuestionMark()}});App.register("controller:world2d",App.World2dController,{singleton:false});App.AshView=App.EslEntityView.extend({eslObj:null,className:"AshView",templateName:"ash",tag:"span",eslObjSettings:{x:0,y:0,fromController:["x","y","img","scaleX"]},override_createEsl:function(c){var d=new createjs.Shape();var b=new createjs.Bitmap(c.img);var a=new createjs.Container();a.addChild(d);a.addChild(b);return a},override_draw:function(b){var a=b?b:this.get("eslObj");this.get("eslObj").scaleX=a.scaleX||1;this.get("eslObj").x=a.x;this.get("eslObj").y=a.y},doMosaicEffect:function(){},override_reDraw:function(dur){var change=30/1000*dur;if(this.get("eslObj")){with(this.get("eslObj")){}}}});App.CoggedPixelController=App.PixelController.extend({label:"CoggedPixelController",view_didInsertElement:function(a){this._super(a);this.send("CoggedPixelControllerCreated",this)},view_willDestroyElement:function(a){this._super(a);this.send("CoggedPixelControllerDestroyed",this)},doOpen:function(){this.get("view").doOpen()},doOpenAndFadeOut:function(){this.get("view").doOpenAndFadeOut()}});App.register("controller:cogged-pixel",App.CoggedPixelController,{singleton:false});App.ClickAndDragScalarView=App.ScalarView.extend({templateName:"click-and-drag-scalar",COLOR:"#ff6666",MOD:2,scaleList:[{val:55,label:"wpm"},{val:67,label:"Kg"},{val:167,label:"cm"},{val:32,label:" years old"}],init:function(){this._super();this.set("eslObjSettings",$.extend(this.get("eslObjSettings"),{width:200,height:320,x:0,y:0,fromController:["x","y","width","height"]}));this.drawInstructions=this.get("drawInstructions");this.drawInstructions.smallMarks.markHeights=[4];this.drawInstructions.isMirrored=false;this.MOD=this.get("MOD");return this},didInsertElement:function(){this._super();return this},override_createEsl:function(){this.container=new createjs.Container();this.shp=new createjs.Shape();this.shp.x=0.5;this.container.addChild(this.shp);this.text=new createjs.Text("","24px Arial",this.get("COLOR"));this.text.textBaseline="alphabetic";this.container.addChild(this.text);var e="#ffffff",c=this.get("scaleList");for(var g=0;g<c.length;g++){var a=c[g],b=new createjs.Container(),d=new createjs.Shape(),f=new createjs.Text(a.val+" "+a.label,"12px Arial",e);b.addChild(d),b.addChild(f);this.container.addChild(b),verticalRise=-a.val;f.x=Math.round(a.val*this.MOD);d.graphics.clear().setStrokeStyle(1).beginStroke(e).moveTo(0,0).lineTo(f.x,0).lineTo(f.x,verticalRise).endStroke();d.x=0.5;f.y=verticalRise-20;b.alpha=0;a.esl=b}return this.container},override_draw:function(a){this._super(a);this.shp.addEventListener("tick",function(b){return function(){b.tryListenMouseMove()}}(this))},tryListenMouseMove:function(){var k=this.shp,j=this.text,i=k.graphics,b=this.drawInstructions,f=b.smallMarks,g=b.bigMarks,h=k.getStage(),c=h.canvas,e=-k.x+(h.canvas.width-k.width)/2,a=this.get("COLOR"),d;if(h){$(h.canvas).mousemove(function(l){return function(q){d=Math.round(h.mouseX-e)/l.MOD;var2d=d*l.MOD,valDir=Math.round(d/Math.abs(d));valAbs=Math.abs(d);j.x=10+var2d;j.y=-15+k.y;i.clear().setStrokeStyle(1).beginStroke(a).moveTo(0,0).lineTo(var2d,0).endStroke();1;markHeight=f.markHeights[f.markHeights.length-1];for(var p=1;p*f.unit<valAbs;p++){i.setStrokeStyle(1).beginStroke(a).moveTo(Math.round(valDir*p*f.unit,markHeight)).lineTo(Math.round(valDir*p*f.unit,-markHeight)).endStroke()}markHeight=g.markHeights[g.markHeights.length-1];for(var p=1;p*g.unit<valAbs;p++){i.beginStroke(a).moveTo(valDir*p*g.unit,markHeight).lineTo(valDir*p*g.unit,-markHeight).endStroke()}var n="",m,o=l.get("scaleList");for(var r=0;r<o.length;r++){if(Math.abs(o[r].val-d)<5){createjs.Tween.get(o[r].esl,{override:true}).to({alpha:1},180).wait(1500).to({alpha:0},700)}}j.text=n}}(this));this.shp.removeAllEventListeners("tick")}},override_reDraw:function(){},drawScale:function(a){}});App.ScalarValueView=App.ScalarView.extend({templateName:"scalar-value",eslObjSettings:{width:800,height:50,x:0,y:0,fromController:["x","y","width","height","value"]},drawInstructions:{},init:function(){this._super();this.set("eslObjSettings",{fromController:["x","y","value"]});this.set("drawInstructions",{isMirrored:false,axis:{step:10,count:0},smallMarks:{unit:5,step:5,count:0,markHeights:[5]},bigMarks:{step:5,unit:50,count:0,markHeights:[10]}});return this},override_createEsl:function(){var a=this.get("eslObjSettings");a.width=Number(this.get("value"));a.height=50;this.container=new createjs.Container();this.shp=new createjs.Shape();this.container.addChild(this.shp);this.text=new createjs.Text(this.get("scaleLabel"),"12px Arial","#666666");this.text.textBaseline="alphabetic";this.container.addChild(this.text);return this.container},override_draw:function(c){var b=c?c:this.get("eslObj"),e=this.shp,a=this.container,d=this.text;b.x=Number(b.x);b.y=Number(b.y);Em.assert('App.ScalarView.override_draw(): value of x in eslObj is not of type "number"',!isNaN(b.x));Em.assert('App.ScalarView.override_draw(): value of y in eslObj is not of type "number"',!isNaN(b.y));Em.assert('App.ScalarView.override_draw(): value of width in eslObj is not of type "number" '+b.width,!isNaN(b.width));Em.assert('App.ScalarView.override_draw(): value of height in eslObj is not of type "number" '+b.height,!isNaN(b.height));e.width=b.width;e.height=b.height;e.x=0.5;a.x=Number(b.x);a.y=Number(b.y);a.regY=-e.height/2;d.x=10+e.width;d.y=0;return e},override_reDraw:function(a){}});var MachineViewLed=function(){this.COL_POWER_OFF="#005500";this.COL_POWER_ON="#33CC33";this.COL_ACTIVITY_OFF="#557777";this.COL_POWER_ON="#5555CC";this.colOn="#33CC33";this.colStandBy="#33CC33";this.colOff="#005500";this.shp=null;this.clickFunc=null};MachineViewLed.prototype={init:function(a){this.colOn=a.colOn||this.colOn;this.colOff=a.colOff||this.colOff;this.colStandBy=a.colStandBy||this.colStandBy;this.shp=a.shp||this.shp;this.clickFunc=a.clickFunc||null;if(this.clickFunc){this.shp.cursor="pointer";this.shp.addEventListener("click",this.clickFunc,false)}},showOn:function(){this._show(this.colOn)},showStandBy:function(){this._show(this.colStandBy)},showOff:function(){this._show(this.colOff)},_show:function(a){if(this.shp){this.shp.graphics.clear();this.shp.graphics.beginFill(a);this.shp.graphics.drawRect(0,0,this.shp.width,this.shp.height)}},cleanUp:function(){if(this.clickFunc){this.shp.removeEventListener("click",this.clickFunc)}this.colOn=null;this.colOff=null;this.colStandBy=null;this.shp=null}};var MachineViewRayParticle=function(){this.COL_LIST=["#40FF00","#FFEA00","#FF00CB","#00FFEF","#008FFF"];this.col=null;this.shp=null;this.eslObj=null;this.tween=null};MachineViewRayParticle.prototype={init:function(c){var a,b;c.w=c.w||App.PIXEL_SIZE*6;c.h=c.h||App.PIXEL_SIZE;c.x=c.x||0;c.y=c.y||0;c.col=c.col||this.COL_LIST[Math.floor(Math.random()*this.COL_LIST.length)];this.eslObj=new createjs.Container();this.eslObj.addChild(this.shp=this.createShape(c));this.eslObj.x=this.eslObj.proxyX=c.x;this.eslObj.y=this.eslObj.proxyY=c.y;this.eslObj.alpha=0.8;a=function(g,f,d,e){return function(){f.x=f.proxyX-(f.proxyX%App.PIXEL_SIZE);f.y=f.proxyY-(f.proxyY%App.PIXEL_SIZE)}}(this,this.eslObj,c.w,c.h);a();b=function(d){return function(){d.eslObj.removeAllChildren();if(d.eslObj.parent){d.eslObj.parent.removeChild(d.eslObj);d.eslObj=d.shp=d.COL_LIST=d.col=null}d.cleanUp()}}(this);this.tween=TweenMax.to(this.eslObj,0.1,{alpha:0.2,repeat:8,yoyo:true,onComplete:b})},createShape:function(b){var c=new createjs.Shape(),a=b.col;c.width=b.w;c.height=b.h;c.graphics.clear();c.graphics.beginFill(a);c.graphics.drawRect(0,0,c.width,c.height);return c},cleanUp:function(){this.COL_LIST=null;this.col=null;this.shp=null;this.eslObj=null;this.tween&&this.tween.kill&&this.tween.kill();this.tween=null}};App.MachineView=App.TemplatedPixelGroupView.extend({templateName:"machine",className:"MachineView",label:"machine",imgPreloadId:"machine-pixel",ledHash:{},isOnObserver:function(b,d){var c=this.get("ledHash");if(this.get(d)){var a=setInterval(function(e){return function(){e.set("isActivity",!e.get("isActivity"))}}(this),1000);this.set("toggleActivityInterval",a);c.power&&c.power.showOn()}else{clearInterval(this.get("toggleActivityInterval"));this.set("toggleActivityInterval",null);this.set("isActivity",false);c.power&&c.power.showOff()}}.observes("controller.isOn"),toggleActivityInterval:null,isActivity:false,isActivityObserver:function(b,d){var c=this.get("ledHash");if(this.get(d)&&this.get("controller.isOn")){c.activity&&c.activity.showOn();var a=this.shootRay();this.get("controller").doActivateTarget({ray:a})}else{c.activity&&c.activity.showOff()}}.observes("isActivity"),activateOn:function(){},didInsertElement:function(){this._super();console.log("creating machine view")},willDestroyElement:function(){this._super();console.log("destroying machine view");clearInterval(this.get("toggleActivityInterval"));this.set("toggleActivityInterval",null);var a=this.get("ledHash");if(a){a.power&&a.power.cleanUp();a.activity&&a.activity.cleanUp();a.power=a.activity=null}this.set("ledHash",a=null)},trySetPowerLed:function(b,d){var c=this.get("ledHash"),a;if(!c.power){a=function(e){return function(f){if(e.get("controller").isInteractive){e.get("controller").togglePower()}}}(this);c.power=Object.createFromPrototype(MachineViewLed,{clickFunc:a,shp:d});c.power.showOff()}else{console.log("already this.get ledHash.power")}},trySetActivityLed:function(a,c){var b=this.get("ledHash");if(b.power&&!b.activity&&b.power.shp!=c){b.activity=Object.createFromPrototype(MachineViewLed,{});b.activity.shp=c;b.activity.colOn="#0040FF";b.activity.colOff="#d2691e";b.activity.colStandBy="#EB9946";b.activity.showOff()}},shootRay:function(){var f=this.get("eslObj"),c=[],d,i=this.get("controller.pixels"),b;console.log("shoot ray",i.length,i);for(var h=0;h<i.length;h++){b=i[h].get("view.eslObj");if(!d||b.x>d){d=b.x;c=[b]}else{if(b.x==d){c.push(b)}}}for(var g=0;g<c.length;g++){var a=Object.createFromPrototype(MachineViewRayParticle,{x:f.x+c[g].x+App.PIXEL_SIZE,y:f.y+c[g].y});f.parent.addChild(a.eslObj)}}});App.QuestionView=App.TemplatedPixelGroupView.extend({templateName:"question",className:"QuestionView",label:"question",imgPreloadId:"question-pixel"});App.UserView=App.TemplatedPixelGroupView.extend({templateName:"user",className:"UserView",label:"user",imgPreloadId:"face-user-pixel",faceChangeMaps:[],faceChangeImgPreloadIds:["face-user-pixel-change01","face-user-pixel-change02","face-user-pixel-change03"],didInsertElement:function(){this._super();console.log("USER VIEW INSERTED",this);var a=this.get("faceChangeImgPreloadIds");for(var b=0;b<a.length;b++){this.setFaceChangeMap(a[b])}},willDestroyElement:function(){this._super();this.set("faceChangeMaps",null);this.set("faceChangeImgPreloadIds",null)},doActivate:function(){console.log("UserView.doActivate() child views",this.get("childViews").length);this.clearFace();this.makeFaceChange()},clearFace:function(){var d=this.get("childViews"),a=pixelH=App.PIXEL_SIZE;for(var b=0;b<d.length;b++){pixelShp=d[b].get("shp");pixelShp.graphics.clear();pixelShp.graphics.beginFill("#FFFFFF");pixelShp.graphics.drawRect(0,0,a,pixelH)}},makeFaceChange:function(o){var f=this.get("faceChangeMaps"),d=f[0],b=this.get("childViews"),k,g=pixelH=App.PIXEL_SIZE,a=o||"#666666";f.splice(0,1);f.push(d);for(var n=0;n<d.length;n++){for(var m=0;m<d[n].length;m++){var i=d[n][m][0];if(i){var e=i.x2d,h=i.y2d;var j;for(var l=0;l<b.length;l++){j=b[l].get("eslObj");if(j.x==e&&j.y==h&&i.color){k=b[l].get("shp");k.graphics.clear();k.graphics.beginFill(a);k.graphics.drawRect(0,0,g,pixelH)}}}}}},setFaceChangeMap:function(c){var b=App.preloadedImages[c];if(b){var a=function(e){return function(f,l,k,g,j,i,h){g.x2d=(-15+(f+2)*App.PIXEL_SIZE);g.y2d=(240+(0.5-i+l)*App.PIXEL_SIZE)}}(this),d=function(e){return function(f){e.get("faceChangeMaps").push(f)}}(this);ragh.createJsonMapFromImage(b,a,d)}}});App.World1dView=App.ActiveEslStageView.extend({tagName:"div",className:"World1dView",templateName:"world-1d",clickAndDragScale:undefined,didInsertElement:function(){this._super();this.get("$el").mousedown(function(a){return function(){}}(this));this.get("$el").mouseup(function(a){return function(){}}(this))},redraw:function(a){this._super()},resize:function(){var width=2400;this.$canvas.attr({width:width}).css({width:width});this.get("$el").css({width:width,"margin-left":-width/2});this.tmpwinHeight=$(window).height();with(this){if(tmpwinHeight>App.BREAKPOINT.HEIGHT_2){height=App.BREAKPOINT.HEIGHT_2;tmpbgColor="rgba(200, 255, 200, "+(trails?1/trails:1)+")"}else{if(tmpwinHeight>App.BREAKPOINT.HEIGHT_1){height=App.BREAKPOINT.HEIGHT_1;tmpbgColor="rgba(200, 200, 255, "+(trails?1/trails:1)+")"}else{height=App.BREAKPOINT.HEIGHT_0;tmpbgColor="rgba(255, 200, 200, "+(trails?1/trails:1)+")"}}$canvas.attr({height:height}).css({height:height});if(App.DEBUG){$canvas.css("box-shadow","inset -1px -1px "+tmpbgColor)}}}});App.World2dView=App.ActiveEslStageView.extend({tagName:"div",className:"World2dView",templateName:"world-2d",isMosaic:true,multiData:{},src:{},pix:{},min:{},scale:30,isVis:true,multiTween:undefined,didInsertElement:function(scope){with(this){set("multiData",{index:0,roundIndex:0,needsRedraw:true,values:[256,128,64,32,24,8,1]});_super();src.$canvas=$(".esl-stage-canvas",$el).addClass("src-world-2d");src.$canvas.attr({width:App.BREAKPOINT.WIDTH_2,height:App.BREAKPOINT.HEIGHT_2});src.canvas=src.$canvas[0];src.context=src.canvas.getContext("2d");src.stage=stage;src.stage.mouseMoveOutside=true;src.stage.snapToPixelEnabled=true;if(get("isVis")){src.$canvas.parent().append('<canvas class="min-world-2d canvas-hero">');min.$canvas=$(".min-world-2d",$el);min.canvas=min.$canvas[0];min.context=min.canvas.getContext("2d");src.$canvas.parent().append('<canvas class="pix-world-2d canvas-hero">');pix.$canvas=$(".pix-world-2d",$el);pix.context=pix.$canvas[0].getContext("2d");pix.min=min;min.src=src}src.$canvas.css({display:"none"});min.$canvas.css({display:"none"});pix.$canvas.css({display:"block"})}var multiData=this.get("multiData");this.set("multiTween",createjs.Tween.get(multiData,{}).to({index:multiData.values.length},1000,createjs.Ease.getPowIn(2.2)).addEventListener("change",function(e){var multiData=e.target.target;if(Math.round(multiData.index)!=multiData.roundIndex){multiData.needsRedraw=true}multiData.roundIndex=Math.round(multiData.index)}));this.resize()},addCog:function(){console.log("adding cog");App.static_eslEntityContainerView.pushObject(App.CogView.create({controller:App.CogController.create()}))},addPixel:function(){console.log("adding pixel");var b=App.PixelController.create();var c=$.extend(App.PixelView.create().eslObjSettings,{x:0,y:0});var a=App.PixelView.create({controller:b,eslObjSettings:c});App.static_eslEntityContainerView.pushObject(a)},addQuestionMark:function(){console.log("view.addQuestionMark()")},reDraw:function(dur){with(this){_super(dur);if(this.get("isVis")&&pix.context){var multiData=get("multiData"),multiIndex=Math.round(multiData.index),multiValues=multiData.values;if(multiData.needsRedraw){multiData.needsRedraw=false;if(multiIndex<multiValues.length){var multi=multiValues[multiIndex],invMulti=1/multi,width=src.$canvas.attr("width"),height=src.$canvas.attr("height");with(min){context.webkitImageSmoothingEnabled=context.mozImageSmoothingEnabled=context.imageSmoothingEnabled=false;$canvas.attr({width:width/multi,height:height/multi});context.setTransform(invMulti,0,0,invMulti,0,0);context.drawImage(src.canvas,0,0);$canvas.css({width:width,height:height});src.$canvas.css({display:"none"});min.$canvas.css({display:"block"});pix.$canvas.css({display:"none"})}var is_chrome=navigator.userAgent.indexOf("Chrome")>-1;var is_explorer=navigator.userAgent.indexOf("MSIE")>-1;var is_firefox=navigator.userAgent.indexOf("Firefox")>-1;var is_safari=navigator.userAgent.indexOf("Safari")>-1;var is_Opera=navigator.userAgent.indexOf("Presto")>-1;if((is_chrome)&&(is_safari)){is_safari=false}if(!is_safari){with(pix){$canvas.attr({width:width,height:height});context.webkitImageSmoothingEnabled=context.mozImageSmoothingEnabled=context.imageSmoothingEnabled=false;context.setTransform(multi,0,0,multi,0,0);context.drawImage(min.canvas,0,0);src.$canvas.css({display:"none"});min.$canvas.css({display:"none"});pix.$canvas.css({display:"block"})}}}else{if(this.get("isMosaic")){src.$canvas.css({display:"block"});min.$canvas.css({display:"none"});pix.$canvas.css({display:"none"});this.set("isMosaic",false);this.get("controller").send("doMosaicFinished")}}}}}},resize:function(){this._super();var e=$("canvas",this.get("$el")),d=App.BREAKPOINT,c,b,a=this.tmpwinWidth=$(window).width(),f=this.tmpwinHeight=$(window).height();if(a>d.WIDTH_2&&f>d.HEIGHT_2){c="canvas-hero";b="canvas-hero-holder"}else{if(a>d.WIDTH_1&&f>d.HEIGHT_1){c="canvas-hero-med";b="canvas-hero-holder-med"}else{c="canvas-hero-small";b="canvas-hero-holder-small"}}e.removeClass("canvas-hero canvas-hero-med canvas-hero-small");e.addClass(c);e.parent().removeClass("canvas-hero-holder canvas-hero-holder-med canvas-hero-holder-small");e.parent().addClass(b)},willDestroyElement:function(){createjs.Tween.removeTweens(this.get("multiTween"));this._super()}});