(function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,e){var d=new Date().getTime();var f=Math.max(0,16-(d-b));var g=window.setTimeout(function(){h(d+f)},f);b=d+f;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());App.SubtitleController=App.SmartController.extend({controllerName:"Script Subtitle Controller",text:"",cursorChar:"âˆ†",read:{},lines:[],isEnded:false,tOut:undefined,ARF:undefined,ARF_last:undefined,ARF_drawStart:undefined,ARF_startTime:undefined,ARF_diff:undefined,init:function(){return this._super()},setup:function(b){this.read.lines=b.split(".");for(var a=0;a<this.read.lines.length;a++){this.read.lines[a]=(this.read.lines[a]).split("")}this.read.currentLine=0;this.read.currentChar=0;this.set("text","")},readChar:function(d){var e=this.read,a=this.read.lines,c=false,b;if(e.currentLine<a.length){if(e.currentChar<a[e.currentLine].length){b=1/this.get("content").get("cpms")}else{b=200;c=true}if(d>b){d-=b;if(!c){this.set("text",this.get("text")+""+a[e.currentLine][e.currentChar]);e.currentChar++}else{e.currentChar=0;e.currentLine++;if(e.currentLine<a.length){this.set("text",this.get("text")+"<br/>")}}}}else{this.isEnded=true;console.log("isEnded");App.eventMapper.triggerEvent(ragh.MEvt.create("sub_finishedReading",{target:this}))}return d},doSetupDraw:function(){this.ARF_startTime=window.mozAnimationStartTime||Date.now();this.ARF_diff=0;this.ARF_last=Date.now();this.ARF=window.requestAnimationFrame(this.doDraw.bind(this))},doDraw:function(atime){with(this){ARF_startTime=Date.now();ARF_diff+=(ARF_startTime-ARF_last);var prevDif=ARF_diff;while(prevDif!=(ARF_diff=readChar(ARF_diff))){prevDif=ARF_diff}ARF_last=ARF_startTime;if(ARF){window.cancelAnimationFrame(ARF)}if(!isEnded){ARF=window.requestAnimationFrame(doDraw.bind(this))}}},SubtitleView_Clicked:function(){console.log("clicked subtitle view")},forceEnd:function(){}});App.register("controller:subtitle",App.SubtitleController,{singleton:false});