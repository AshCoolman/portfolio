App.UserView=App.TemplatedPixelGroupView.extend({templateName:"user",className:"UserView",label:"user",imgPreloadId:"face-user-pixel",faceChangeMaps:[],faceChangeImgPreloadIds:["face-user-pixel-change01","face-user-pixel-change02","face-user-pixel-change03"],didInsertElement:function(){this._super();console.log("USER VIEW INSERTED",this);var a=this.get("faceChangeImgPreloadIds");for(var b=0;b<a.length;b++){this.setFaceChangeMap(a[b])}},willDestroyElement:function(){this._super();this.set("faceChangeMaps",null);this.set("faceChangeImgPreloadIds",null)},doActivate:function(){console.log("UserView.doActivate() child views",this.get("childViews").length);this.clearFace();this.makeFaceChange()},clearFace:function(){var d=this.get("childViews"),a=pixelH=App.PIXEL_SIZE;for(var b=0;b<d.length;b++){pixelShp=d[b].get("shp");pixelShp.graphics.clear();pixelShp.graphics.beginFill("#FFFFFF");pixelShp.graphics.drawRect(0,0,a,pixelH)}},makeFaceChange:function(o){var f=this.get("faceChangeMaps"),d=f[0],b=this.get("childViews"),k,g=pixelH=App.PIXEL_SIZE,a=o||"#666666";f.splice(0,1);f.push(d);this.set("faceChangeMaps",f);var p=[];console.log("makeFaceChange",d);for(var n=0;n<d.length;n++){for(var m=0;m<d[n].length;m++){var i=d[n][m][0];if(i){var e=i.x2d,h=i.y2d;var j;for(var l=0;l<b.length;l++){j=b[l].get("eslObj");if(j.x==e&&j.y==h&&i.color){k=b[l].get("shp");k.graphics.clear();k.graphics.beginFill(a);k.graphics.drawRect(0,0,g,pixelH);console.log("yes",k,a);p.push(k)}else{}}}}}Em.assert("UserView: No pixels changed in face",p.length>0)},setFaceChangeMap:function(c){var b=App.preloadedImages[c];if(b){var a=function(e){return function(f,l,k,g,j,i,h){g.x2d=(App.USER_X+(f+2)*App.PIXEL_SIZE);g.y2d=(App.USER_Y+(0.5-i+l)*App.PIXEL_SIZE)}}(this),d=function(e){return function(f){e.get("faceChangeMaps").push(f)}}(this);ragh.createJsonMapFromImage(b,a,d)}}});