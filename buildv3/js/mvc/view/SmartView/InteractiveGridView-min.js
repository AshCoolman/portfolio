App.IGVC={LEGEND:[{colour:"#99CC99",fill:"#669966",cssClass:"graph-plot-tech-portfolio"},{colour:"#CC9999",fill:"#996666",cssClass:"graph-plot-tech-general"},{colour:"#9999CC",fill:"#666699",cssClass:"graph-plot-general"}],TECH_PORTFOLIO:0,TECH_GENERAL:1,GENERAL:2};App.InteractiveGridView=App.SmartView.extend({name:"InteractiveGridView",templateName:"interactive-grid",tagName:"div",grid:[[]],testColor:"#99CC99",LEGEND:[{colour:"#99CC99",fill:"#669966",cssClass:"graph-plot-tech-portfolio",label:"about this site"},{colour:"#CC9999",fill:"#996666",cssClass:"graph-plot-tech-general",label:"about my tech knowledge"},{colour:"#9999CC",fill:"#666699",cssClass:"graph-plot-general",label:"other"}],isDrawGrid:false,plotsPlainText:"",pixW:0,pixH:0,shownPlotIndex:null,didInsertElement:function(){this._super();$(".graph-plot",this.get("$el")).css({opacity:0});this.set("$legend",$(".graph-legend",this.get("$el")));this.set("$graphPosition",$(".graph-position",this.get("$el")));this.set("plots",B=this.setPlotsFromPlainText($(".interactive-grid-values").text()));var b,o=App.BREAKPOINT.WIDTH_2,E=2000,C=this.get("controller").get("pixW")||E,c=this.get("controller").get("pixH")||o,e=o/(2+B.maxX),d=20,m,l,a=this.get("grid"),B=this.get("plots"),z=["#669966","#99CC99"],I=Raphael.animation({}),j,q=$(".position-text",this.get("$el")).css({position:"absolute"}),u=$(".plot-text",this.get("$el")).css({position:"absolute"}),n=this.set("$svgRaphaeljs",$("#svg-raphaeljs",this.get("$el")));this.set("raphaeljs",b=new Raphael("svg-raphaeljs","100%","100%"));$("svg",this.get("$el")).attr({"text-antialiasing":true,width:"100%",xmlns:"http: //www.w3.org/2000/svg",version:"1.1"});b.setViewBox(0,0,o,E,false);var D=function(w,p,h){h=Math.abs(h);if(w>=(p-h)&&w<=(p+h)){return true}return false};var i=[],k={},F;for(var A=0;A<B.length;A++){if(!k[B[A].x]){F=b.rect(0,0,3,30).attr({fill:"#999999","stroke-width":0,opacity:1});F.attr({x:e*B[A].x-3});i.push(F);k[B[A].x]=F}B[A].marker=k[B[A].x]}this.set("plotMarkers",i);var s=b.rect(0,0,300,10).attr({fill:"#666666","stroke-width":0,opacity:0});this.set("xPlot",s);var t=b.text(0,0,"");t.attr({"font-size":28,"font-family":"Arial, Helvetica, sans-serif",fill:"#99CC99",x:14});this.set("xPlotNumber",t);var v=b.text(0,0,"");v.attr({"font-size":28,"font-family":"Arial, Helvetica, sans-serif",fill:"#333333",x:App.BREAKPOINT.WIDTH_2-28});this.set("xPosNumber",v);var g=b.rect(0,0,o,E).attr({"stroke-width":0,fill:"#001133",opacity:0});$(g.node).addClass("grid-zone");this.set("$mouseZone",$(g.node));var H=$("svg",this.get("$el"))[0].createSVGPoint();var G=function(w,h){var p=h.get("$mouseZone");var x=p.parent().offset();H.x=w.pageX-x.left;H.y=w.pageY-x.top;if(!p.parent()[0].getScreenCTM){return H}return H.matrixTransform(p.parent()[0].getScreenCTM().inverse())};var f=b.rect(0,0,3,E).attr({fill:"#595959","stroke-width":0});$(this.get("$el"),g).mousedown(function(h){return function(p){console.log("click",p,p.target)}}(this));var r=function(x,h,w,J,p,y){return function(ae){var M=G(ae,x),Y=M.x,X=M.y,R=Math.floor(Y/C),P=Math.floor(X/c),S,Q,af=x.get("prevPlotArea")||[[],[]];x.set("prevPlotArea",af);if(x.get("controller").get("isPlotX")){var O=Math.round(Y/e),N=Math.round(X/d),W=O,ag=[],ab="",U="Anything",ah,ad,ac,L=x.get("shownPlotIndex"),Z=o,V=[];for(var aa=0;aa<B.length;aa++){ah=Math.abs(B[aa].x-O);if(D(Y,B[aa].x*e,15)){V.push(B[aa])}}if(V.length>0){var K=V[0],T=K.x,Z=K.x*e;if(w.animateWidthTarget!=Z){w.animateWidthTarget=Z;App.eventMapper.trigger("interactiveGridText",V);$(".graph-info").css({display:"block"});$(".graph-info h3").addClass("highlight");$(".d1-content").addClass("graph-highlight");$(".graph-plot",x.get("$el")).css({opacity:1});w.stop().animate({fill:"#FF6347",width:Z,opacity:1},100);K.marker.attr({fill:"#FF6347"})}}else{App.eventMapper.trigger("interactiveGridText",[{x:O}]);if(w.animateWidthTarget!=-1){$(".graph-info h3").removeClass("highlight");$(".d1-content").removeClass("graph-highlight");h.attr({fill:"#595959"});w.animateWidthTarget=-1;$(".graph-plot",x.get("$el")).css({opacity:0});w.animate({fill:"#CCCCCC"},100);x.get("plotMarkers").forEach(function(ak,aj,ai){ak.animate({fill:"#CCCCCC"},100)})}}h.attr({x:Y-h.attr("width")});x.get("controller").set("positionText",W);x.set("positionText",W)}}};$(document).bind("mousemove.InteractiveGridView",r(this,f,s,t,z));r(this,f,s,z);this.doResize();$(window).on("resize.InteractiveGridView",function(h){return function(p){h.doResize(p)}}(this))},setPlotsFromPlainText:function(g){var b=g.split("## "),c=[],a=function(i,h){if(i.x<h.x){return -1}if(i.x>h.x){return 1}return 0},f=0;for(var e=0;e<b.length;e++){var d={};d.xList=b[e].split("\n");d.text=d.xList.splice(0,1)[0];d.x=d.xList.splice(0,1)[0];d.type=App.IGVC.LEGEND[App.IGVC.TECH_PORTFOLIO];while(d.xList.indexOf("")>=0){d.xList.splice(d.xList.indexOf(""),1)}if(d.x==""){d.x=d.xList.length}else{d.x=parseInt(d.x,10)}f=Math.max(d.x,f);c.push(d)}c.maxX=f;return c.sort(a)},willDestroyElement:function(){this._super();$(document).unbind("mousemove.InteractiveGridView");$(window).unbind("resize.InteractiveGridView")},doResize:function(g){var f=App.BREAKPOINT.WIDTH_2;var b=2000;var a=this.get("$svgRaphaeljs").width();var h=c(b,f,a);this.get("$svgRaphaeljs").height(h);function c(l,k,e){return(l/k*e)}var i=$(document).height();var j=i/h;var d=1*j*b;this.get("xPlot").attr({y:d});this.get("xPlotNumber").attr({y:d-18});this.get("xPosNumber").attr({y:d-18});this.get("plotMarkers").forEach(function(k,e){return function(n,m,l){n.attr({y:e-10})}}(this,d))}});