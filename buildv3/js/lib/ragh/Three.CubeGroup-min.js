if(typeof Object.createFromPrototype!=="function"){Object.createFromPrototype=function(d,b){function c(){}c.prototype=new d();var a=new c();if(a.init){a.init(b)}return a}}var CubeGroup=function(){this.isMerge=false;this.rollOver=null;this.SIZE=30;this.materialsDict={};this.group=null;this.isHover=false;this._isInteractive=false;this.hoverMat=new THREE.MeshLambertMaterial({color:14423100});this.linkMat=new THREE.MeshLambertMaterial({color:16737095});this.map=[]};CubeGroup.prototype={init:function(a){this.group=this.createFromMap(a.imgMap);this.group.position.x=a.x||0;this.group.position.y=a.y||0;this.setInteractive(a.isInteractive);this.label=a.label;this.hoverOff()},getInteractive:function(a){return this._isInteractive},setInteractive:function(a){a=a||false;if(a&&!this._isInteractive){this._isInteractive=a;this.withEveryPixel(function(b){return function(c){c.object.material=b.linkMat}}(this))}else{if(!a&&this._isInteractive){this._isInteractive=a;this.withEveryPixel(function(b){return function(c){c.object.material=c.material}}(this))}}},tryAddHere:function(a){},show:function(b){var a=this.getFacePoint(b,this.SIZE);this.rollOverMesh.position.copy(a)},hoverOn:function(){$(".world-3d-renderer").addClass("rotate-hint");var a=false;if(!this.isHover&&this._isInteractive){this.withEveryPixel(function(b){return function(c){c.object.material=b.hoverMat}}(this));this.isHover=true;a=true}return a},hoverOff:function(){$(".world-3d-renderer").removeClass("rotate-hint");var a=false;if(this.isHover){this.withEveryPixel(function(b){return function(c){c.object.material=(b._isInteractive)?b.linkMat:c.material}}(this));this.isHover=false;a=true}return a},withEveryPixel:function(c){var e=this.map;for(var a=0;a<e.length;a++){if(!e[a]){e[a]=[]}for(var b=0;b<e[a].length;b++){if(!e[a][b]){e[a][b]=[]}for(var d=0;d<e[a][b].length;d++){if(e[a][b][d]){setTimeout(function(j,h,f,g,i){return function(){c(h[f][g][i],h,f,g,i)}}(this,e,a,b,d),30*b)}}}}},getFacePoint:function(b,c){var a=new THREE.Vector3(),d=new THREE.Vector3();a.copy(b.object.position);d.copy(b.face.centroid).normalize();d.multiplyScalar(c);a.add(d);return a},createFromMap:function(m){if(!m){throw'CubeGroup.createFromMap() passed "amap" parameter is falsey'}var l=this.SIZE,c=0,a=0,q=0,h=new THREE.Object3D(),j=new THREE.Object3D(),g=new THREE.Object3D(),b=(m?m:this.defaultMap),o,i,p,e;if(this.isMerge){o=[];i=new THREE.Geometry()}for(var f=0;f<b.length;f++){if(!b[f]){b[f]=[]}for(var n=0;n<b[f].length;n++){if(!b[f][n]){b[f][n]=[]}for(var k=0;k<b[f][n].length;k++){if(b[f][n][k]){c=Math.max(c,f);a=Math.max(a,n);q=Math.max(q,k)}}}}for(var f=0;f<b.length;f++){if(!b[f]){b[f]=[]}for(var n=0;n<b[f].length;n++){if(!b[f][n]){b[f][n]=[]}for(var k=0;k<b[f][n].length;k++){if(b[f][n][k]){var d=this.createCube(this.SIZE,f*l,-n*l,k*l,b[f][n][k],this.materialsDict,h,i,o,this.isMerge)}}}}if(this.isMerge){p=new THREE.Mesh(this.geo,new THREE.MeshFaceMaterial(this.materials));p.matrixAutoUpdate=false;p.updateMatrix();p.overdraw=false;p.name="cubeGroup";h.add(p)}h.position.set(0,0,0);h.updateMatrix();this.rollOverMesh=this.createRollOver();h.position.x=-c*l*0.5;j.add(h);j.position.x=c*l*0.5;g.add(j);this.group=g;return g},createRollOver:function(){if(!this.isMerge){var c=new THREE.CubeGeometry(this.SIZE,this.SIZE,this.SIZE,1,1,1),a=new THREE.Mesh(c,new THREE.MeshLambertMaterial({color:255,opacity:0.25,transparent:true})),b=new THREE.PointLight(3355545);a.matrixAutoUpdate=true;a.add(b);b.intensity=2;return a}var b=new THREE.PointLight(3355545);b.intensity=2;return b},createCube:function(h,p,o,l,g,r,j,c,n,a){var k=h,d=r[g.color],q,f=new THREE.CubeGeometry(k,k,k,1,1,1);if(!this.materialsDict[g.color]){this.materialsDict[g.color]=d=new THREE.MeshLambertMaterial({color:g.color})}if(!a){THREE.GeometryUtils.merge(f,new THREE.Geometry());q=new THREE.Mesh(f,d);q.position=new THREE.Vector3(p,o,l);j.add(q)}else{for(var e=0;e<f.vertices.length;e++){f.vertices[e].add(new THREE.Vector3(p,o,l))}THREE.GeometryUtils.merge(c,f,n.length);for(var m=0;m<6;m++){n.push(d)}}this.map=this.getMap(j);return q},doRollOver:function(){},getMap:function(d){var e=[[[]]],b,f=d,a,i,g;for(var h=0;h<=f.children.length;h++,b=f.children[h-1]){if(b&&b!=this.rollOverMesh){a=Math.round(b.position.x/this.SIZE);i=-Math.round(b.position.y/this.SIZE);g=Math.round(b.position.z/this.SIZE);if(!e[a]){e[a]=[]}if(!e[a][i]){e[a][i]=[]}e[a][i][g]={childrenIndex:h,object:b,material:b.material}}}return e},cleanUp:function(){this.materials=null;this.geo=null;this.mesh=null;this.rollOverMesh=null;this.group=null;this.materials=null;this.geo=null;this.mesh=null;this.rollOverMesh=null;this.group=null;this.materialsDict=null}};